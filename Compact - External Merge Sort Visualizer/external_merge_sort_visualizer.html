<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>External Sorting Visualizer</title>
	<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='155.5' height='179.9' viewBox='0 0 155.5 179.9'%3E%3Ctitle%3Efavicon%3C/title%3E%3Cpath d='M960.6,490.4a189.2,189.2,0,0,1-20.1-1c-12.6-1.3-27.2-3.4-41-9.9-4.8-2.3-8.2-4.6-10.8-7.5a13.1,13.1,0,0,1-3.4-8.9c.1-3.1.2-6.8,0-10.4a13.6,13.6,0,0,1,5-11c5.8-5,12.6-7.7,18.5-9.6a169.9,169.9,0,0,1,36-6.5l8.1-.5h16.3l8.1.5a164.3,164.3,0,0,1,36,6.5c5.8,1.9,12.4,4.4,18.2,9.4,3.8,3.2,5.5,7,5.2,11.5a76.3,76.3,0,0,0,.1,8.5c.4,5.5-1.9,9.9-7,13.7s-14.2,7.5-20,9.1c-11.7,3.3-24.6,5.2-39.5,5.9Z' transform='translate(-883.3 -423)' style='fill:%23f42f3f'/%3E%3Cpath d='M961,427h8.1l8.1.5a170.7,170.7,0,0,1,35.5,6.4c6.3,2.1,12.4,4.6,17.5,9,3,2.6,4.8,5.8,4.6,9.9a51.7,51.7,0,0,0,0,8.8c.4,5.3-2.1,8.9-6.1,11.9-5.9,4.3-12.6,6.8-19.5,8.8-12.7,3.6-25.8,5.2-39,5.8l-9.6.2a188.1,188.1,0,0,1-19.9-1c-13.9-1.4-27.6-3.7-40.4-9.7a30.9,30.9,0,0,1-10.1-7.1,10.6,10.6,0,0,1-2.9-7.4c.1-3.5.2-7.1,0-10.6a11.8,11.8,0,0,1,4.4-9.4c5.1-4.5,11.3-7.1,17.7-9.2a170.3,170.3,0,0,1,35.5-6.4l8.1-.5h8m0-4h-8.2l-8.2.5a170,170,0,0,0-36.4,6.6c-6.1,2-13.2,4.7-19.2,10-3.9,3.5-5.9,7.7-5.7,12.6s.1,7.1,0,10.3a15.2,15.2,0,0,0,3.9,10.2c2.8,3.2,6.3,5.6,11.4,8,14.1,6.6,29,8.8,41.7,10.1a193,193,0,0,0,20.3,1l9.8-.2c15-.7,28.1-2.6,39.9-6,6-1.7,13.8-4.3,20.7-9.4s8.3-9.3,7.7-15.5c-.1-2.3-.1-4.8,0-8.1.3-5.2-1.7-9.6-5.9-13.2-6.1-5.2-13.3-8-18.9-9.8a170,170,0,0,0-36.4-6.6l-8.3-.5Z' transform='translate(-883.3 -423)'/%3E%3Cpath d='M960.6,600.9h-6.8c-.1,0-4.6-.1-9-.4a168.5,168.5,0,0,1-36-6.6c-5.8-1.8-12.5-4.4-18.2-9.3a14.2,14.2,0,0,1-5.3-11.6c.1-3.3.1-6.6.1-9.9v-5.2l.5-.6a2.7,2.7,0,0,1,1.8-.7,3.3,3.3,0,0,1,1.6.5c10,6.7,21.3,9.6,30.1,11.4a198.7,198.7,0,0,0,40.8,4.1h5.6c20-.5,36-2.9,50.5-7.5a65.8,65.8,0,0,0,16.2-7.7l.7-.4.7-.4h.7a2.1,2.1,0,0,1,2.1,2.1V567a41.7,41.7,0,0,0,0,5c.5,5.6-1.8,10.2-7.1,14-7.3,5.3-17.7,8.4-20.7,9.2a180.1,180.1,0,0,1-36.4,5.5H960.6Z' transform='translate(-883.3 -423)' style='fill:%232f43f4'/%3E%3Cpath d='M1034.6,558.4a.1.1,0,0,1,.1.1v6.1a64.3,64.3,0,0,0,.1,7.6c.4,5.4-2.2,9.1-6.3,12.1-7.5,5.5-18.6,8.5-20.1,8.9,0,0-17.9,4.9-36,5.5H953.8s-4.5-.1-8.9-.4a167.4,167.4,0,0,1-35.5-6.5c-6.3-2-12.4-4.5-17.5-8.9a12.2,12.2,0,0,1-4.6-10c.2-4.8.1-9.6.1-14.3.1-.2.2-.2.3-.2l.5.2c9.3,6.2,19.9,9.4,30.7,11.7a205.1,205.1,0,0,0,41.3,4.1h5.6c17.3-.4,34.5-2.3,51.1-7.6a73,73,0,0,0,16.7-7.9l.9-.5h.1m0-4a4.6,4.6,0,0,0-2.1.5h-.2l-.9.5a62.6,62.6,0,0,1-15.8,7.5c-14.2,4.6-30,6.9-49.9,7.4h-5.5a202,202,0,0,1-40.4-4c-8.6-1.8-19.7-4.7-29.4-11.1a4.1,4.1,0,0,0-2.7-.9,4.8,4.8,0,0,0-3.2,1.3l-1.1,1.2v6c0,3.3,0,6.6-.1,9.9a15.8,15.8,0,0,0,6,13.1c6,5.2,13.3,7.9,18.9,9.7a170.7,170.7,0,0,0,36.4,6.7c4.5.3,8.9.4,9.1.4h18.8a181.9,181.9,0,0,0,36.9-5.6c3.1-.8,13.8-4,21.4-9.5,5.9-4.3,8.5-9.4,7.9-15.8a36.8,36.8,0,0,1,0-4.7v-8.6a4.1,4.1,0,0,0-4.1-4.1Z' transform='translate(-883.3 -423)'/%3E%3Cpath d='M961.6,564.1h-6.2c-19.8-.5-35.6-3.1-49.8-8.2a45.8,45.8,0,0,1-13.6-7.1c-2.4-1.8-5.2-4.3-6.3-8.4h0a8.6,8.6,0,0,1-.3-1.7V521.6a2.1,2.1,0,0,1,2.1-2.1h.6l.6.3a68.3,68.3,0,0,0,11.3,6.1,122.5,122.5,0,0,0,26.1,6.9,198.9,198.9,0,0,0,34.4,2.8h6.2c19-.5,34.6-2.8,49-7.3a64.4,64.4,0,0,0,17.5-8.3l.5-.3h1.4l.5.4a2.9,2.9,0,0,1,1.1,2.9h0v4.4c0,2.8-.1,5.7.1,8.6.2,4.6-1.6,8.4-5.4,11.7s-8.3,5.7-14.8,8.1c-8.7,3.2-18.5,5.4-30.9,6.9a185,185,0,0,1-24.1,1.4Z' transform='translate(-883.3 -423)' style='fill:%232ff446'/%3E%3Cpath d='M887.5,521.5h.1a65.9,65.9,0,0,0,11.7,6.2,121.2,121.2,0,0,0,26.4,7.1,214.9,214.9,0,0,0,34.8,2.8h6.2c16.8-.4,33.4-2.3,49.6-7.4a66,66,0,0,0,18-8.5h.1c.5.4.3.9.3,1.3,0,4.4-.1,8.8.1,13.1a12.4,12.4,0,0,1-4.7,10.2,44.5,44.5,0,0,1-14.2,7.7,132.4,132.4,0,0,1-30.4,6.8,191.6,191.6,0,0,1-23.9,1.4h-6.1c-16.8-.4-33.4-2.4-49.3-8a48.9,48.9,0,0,1-13-6.8c-2.5-2-4.7-4.2-5.5-7.4a6.1,6.1,0,0,1-.3-1.3V521.6a.1.1,0,0,1,.1-.1m0-4a4.1,4.1,0,0,0-4.1,4.1v16.9a6.2,6.2,0,0,0,.4,2.2h0c1.2,4.6,4.4,7.5,7,9.5a48,48,0,0,0,14.1,7.4c14.4,5.2,30.5,7.8,50.5,8.3h6.2a207.9,207.9,0,0,0,24.3-1.4,139.7,139.7,0,0,0,31.4-7c6.7-2.5,11.4-5.1,15.4-8.5s6.3-8.1,6.1-13.3c-.2-2.8-.1-5.6-.1-8.5v-4.3a4.9,4.9,0,0,0-1.8-4.7,4.4,4.4,0,0,0-2.5-.8h-1.3l-1,.7a66.8,66.8,0,0,1-17,8c-14.2,4.4-29.6,6.7-48.5,7.2h-6.1a206.7,206.7,0,0,1-34.1-2.7,121.5,121.5,0,0,1-25.6-6.9,58.3,58.3,0,0,1-11-5.9,4.6,4.6,0,0,0-2.3-.6Z' transform='translate(-883.3 -423)'/%3E%3Cpath d='M961.4,527.2h-5.8c-16.5-.3-30.9-2.3-44-6.1-5.8-1.7-13.2-4.2-19.6-9.1-2.3-1.8-5.1-4.3-6.3-8.4a10.1,10.1,0,0,1-.3-2.5V485.9a2.8,2.8,0,0,1,.7-2.4,2,2,0,0,1,1.6-.7,3.6,3.6,0,0,1,1.9.7c10,6.5,21.2,9.4,30.8,11.4a195.8,195.8,0,0,0,39.9,3.8l11.2-.2c19.3-.9,34.6-3.6,48.1-8.6a56.9,56.9,0,0,0,12.6-6.2l.9-.5.9-.6h.6a2,2,0,0,1,2,2c0,1.8.1,3.5.1,5.3,0,4.2.1,8.1-.1,12.2s-3.5,7.5-6.5,9.8c-7,5.3-15,7.9-21.9,9.7-14,3.8-29.3,5.6-46.8,5.6Z' transform='translate(-883.3 -423)' style='fill:%23f4c32f'/%3E%3Cpath d='M1034.6,484.6h0c.1,6,.3,11.7,0,17.4-.2,3.7-2.9,6.2-5.7,8.3-6.4,4.8-13.7,7.3-21.2,9.4a181,181,0,0,1-46.3,5.5h-5.7c-14.8-.3-29.3-1.9-43.6-6.1-6.7-1.9-13.2-4.4-18.9-8.7-2.5-1.9-4.7-4.1-5.5-7.3a6.9,6.9,0,0,1-.3-2V485.9c0-.7,0-1.1.3-1.1s.4.1.8.4c9.6,6.3,20.4,9.4,31.5,11.7a202.3,202.3,0,0,0,40.3,3.8l11.3-.2c16.6-.8,33-2.9,48.7-8.7a65.4,65.4,0,0,0,13-6.4,4.9,4.9,0,0,1,1.3-.8h0m0-4h-1.1l-1,.6-.5.2a4.7,4.7,0,0,1-.9.6,57.9,57.9,0,0,1-12.2,6.1c-13.3,4.8-28.4,7.5-47.5,8.4l-11.1.2a191.9,191.9,0,0,1-39.5-3.8c-9.4-1.9-20.4-4.7-30.1-11.1a5.9,5.9,0,0,0-3-1,4.3,4.3,0,0,0-3,1.3,4.7,4.7,0,0,0-1.3,3.8V501a10.3,10.3,0,0,0,.4,3,18.1,18.1,0,0,0,7,9.5c6.7,5,14.3,7.7,20.2,9.4a172.1,172.1,0,0,0,44.6,6.2h5.8c17.6,0,33.1-1.8,47.4-5.7,7-1.9,15.2-4.5,22.5-10,3.4-2.6,7-6,7.3-11.3s.1-8.1.1-12.3c0-1.8-.1-3.5-.1-5.3a4,4,0,0,0-4-4Z' transform='translate(-883.3 -423)'/%3E%3C/svg%3E" />
	<!-- Document CSS -->
	<style id="style-css">
		* {
				font-family: "Tahoma", sans-serif;
				margin: 0;
				padding: 0;
				/* color: var(--white); */
			}
			:root {
				--white: #ffffff;
				--black: #000000;
				--gray-b5: #333333;
				--gray-b4: #3f3f3f;
				--gray-b3: #4b4b4b;
				--gray-b2: #585858;
				--gray-b1: #636363;
				--gray: #6d6d6d;
				--gray-t1: #808080;
				--gray-t2: #919191;
				--gray-t3: #b3b3b3;
				--gray-t4: #cccccc;
				--gray-t5: #d3d3d3;
				--box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
			}
			html,
			body {
				zoom: normal;
				margin: 0;
				padding: 0;
				background-color: black;
				position: relative;
			}
			body {
				font-size: 15px;
				overflow-x: hidden;
				background: var(--black);
				height: 100vh;
			}
			/* Style for presentation ================================================================ */
			/* html {
				display: block;
				position: relative;
			}
			body {
				display: block;
				max-height: 750px;
				position: relative;
			} */
			/* --------------------------------------------------------------------------------------------------- */
			#page {
				width: 100vw;
				height: 100%;
				flex-direction: row;
				display: inline-flex;
				justify-content: flex-start;
				overflow-y: scroll;
				overflow-x: hidden;
				position: relative;
			}
			/* set #page scroll bar width */
			#page::-webkit-scrollbar {
				width: var(--scrollbar-width);
				z-index: 99999;
			}
			/* Track */
			#page::-webkit-scrollbar-track {
				background: var(--gray);
			}
			/* Handle */
			#page::-webkit-scrollbar-thumb {
				background: var(--gray-b3);
			}
			/* Handle on hover */
			#page::-webkit-scrollbar-thumb:hover {
				background: var(--gray-b4);
			}
			/* --------------------------------------------------------------------------------------------------- */
			#algorithm-selector {
				display: inline-flex;
				justify-content: right;
				flex-direction: row;
				align-items: flex-start;
				background-color: var(--gray-t3);
				color: var(--black);
				height: 48px;
				z-index: 10;
				font-weight: normal;
				padding: 0 0 0 30px;
				white-space: nowrap;
				width: 505px;
				user-select: none;
			}
			#algorithm-selector > div:hover {
				text-decoration: underline;
				position: relative;
			}
			#algorithm-selector > div {
				display: flex;
				align-items: center;
				height: 100%;
				padding: 0 20px;
				cursor: pointer;
				position: relative;
			}
			#algorithm-selector .selected {
				background-color: var(--gray-t5);
				color: var(--black);
				font-weight: bold;
				z-index: 27;
			}
			#algorithm-selector .selected::after {
				content: "";
				position: absolute;
				bottom: 0px;
				left: -10px;
				width: 10px;
				height: 20px;
				background-color: var(--gray-t3);
				border-radius: 0 0 10px 0;
				box-shadow: 0 10px 0 0 var(--gray-t5);
			}
			#algorithm-selector .selected:not(:nth-child(4))::before {
				content: "";
				position: absolute;
				bottom: 0px;
				right: -10px;
				width: 10px;
				height: 20px;
				background-color: var(--gray-t3);
				border-radius: 0 0 0 10px;
				box-shadow: 0 10px 0 0 var(--gray-t5);
			}
			#algorithm-selector .selected:not(:nth-child(4)) {
				border-radius: 10px 10px 0 0;
			}
			#algorithm-selector .selected:nth-child(4) {
				border-radius: 10px 0 0 0;
			}
			/* --------------------------------------------------------------------------------------------------- */
			#algorithm-section {
				position: sticky;
				width: 535px;
				transition: width 200ms;
				z-index: 1;
				position: relative;
				display: inline-flex;
				flex-direction: column;
				background: transparent;
				z-index: 20;
				background-color: var(--gray-t3);
				position: sticky;
				top: 0;
			}
			#algorithm {
				position: relative;
				width: 100%;
				height: 100%;
				background-color: var(--gray-t5);
				box-shadow: var(--box-shadow);
				overflow: hidden;
				z-index: 0;
				border-top-right-radius: 10px;
			}
			#collapse-arrow {
				position: absolute;
				height: 47px;
				background-color: var(--gray-t2);
				left: 0px;
				z-index: 0;
				border-radius: 0px 5px 5px 0px;
				cursor: pointer;
				color: var(--gray-t5);
				font-weight: bold;
				line-height: 47px;
				padding-left: 57px;
				padding-right: 20px;
				box-shadow: 0 0 15px rgba(0, 0, 0, 0.0);
			}
			#collapse-arrow::before {
				content: "";
				display: block;
				position: absolute;
				top: 50%;
				left: 25%;
				width: 0;
				height: 0;
				border-top: 10px solid transparent;
				border-bottom: 10px solid transparent;
				border-left: 10px solid var(--gray-t5);
			}
			#algorithm-section #collapse-arrow::after {
				content: "COLLAPSE";
			}
			#algorithm-section #collapse-arrow::before {
				transform: translate(-75%, -50%) rotate(180deg);
				transition: transform 0.2s;
			}
			#algorithm-section.collapsed #collapse-arrow::after {
				content: "EXPAND";
			}
			#algorithm-section.collapsed #collapse-arrow::before {
				transform: translate(-50%, -50%) rotate(0deg);
				transition: transform 0.2s;
			}
			#algorithm-section.collapsed {
				width: 0px;
				transition: 0.2s;
			}
			#algorithm .algorithm-name {
				font-size: 27.75px;
				font-weight: bold;
				margin: 35px 0 20px 0;
				white-space: nowrap;
			}
			#input-values {
				display: grid;
				grid-template-columns: 1fr 1fr;
				grid-template-rows: 1fr 1fr;
				align-items: center;
				width: 100%;
			}
			#input-values input[type="number"] {
				border: 0.13vw solid var(--white);
				background-color: transparent;
				color: var(--white);
				border-radius: 0.19vw;
				text-align: left;
				width: 3.32vw;
				max-width: 3.32vw;
				padding-left: 0.32vw;
				font-size: 0.87vw;
				line-height: 1.4em;
				font-weight: bold;
			}
			#input-values .input-group {
				display: inline-flex;
				flex-direction: row;
				justify-content: space-between;
				padding: 0.13vw 0.39vw;
				margin: 0.13vw 0.26vw;
				border-radius: 0.32vw;
				background-color: #00000040;
			}
			#input-values .input-group > div {
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				align-items: center;
			}
			.code-container {
				padding-left: 30px;
				width: calc(100% - 40px);
				height: calc(100% - var(--controls-section-height) - 48px + 2.5vw - 1.65vw);
			}
			.code {
				all: unset;
				display: inline-block;
				width: 100%;
				align-self: center;
				color: var(--black);
				tab-size: 30px;
				position: relative;
				z-index: 0;
				line-height: 20.5px;
				max-height: calc(100% - var(--controls-section-height));
				overflow-y: auto;
				overflow-x: hidden;
				overflow-block: visible;
				padding-bottom: 0.75vw;
			}
			/* set scroll bar width */
			.code::-webkit-scrollbar {
				width: calc(var(--scrollbar-width) * 0.9);
				z-index: 99999;
			}
			/* Track */
			.code::-webkit-scrollbar-track {
				background: var(--gray-t3);
			}
			/* Handle */
			.code::-webkit-scrollbar-thumb {
				background: var(--gray-t1);
			}
			/* Handle on hover */
			.code::-webkit-scrollbar-thumb:hover {
				background: var(--gray);
			}
			.code .instructions {
				color: #bb5098;
				font-weight: bold;
				white-space: nowrap;
			}
			.code .comments {
				color: #24972b;
				font-weight: bold;
				white-space: nowrap;
			}
			.code .parenthesis {
				color: var(--black);
				font-weight: bold;
				white-space: nowrap;
			}
			.code > div {
				all: unset;
				display: inline-block;
				width: 100%;
				white-space: pre;
			}
			.code {
				counter-reset: codeline;
			}
			.code > div:not(:last-child)::before {
				content: counter(codeline)' | ';
				counter-increment: codeline;
				width: 35px;
				color: var(--gray-t3);
				text-align: right;
				display: inline-block;
			}
			.code .highlight {
				background-color: #ffffff;
				height: 0px;
				width: calc(100%);
				left: 0;
				position: absolute;
				z-index: -1;
				/* NOTE: This vaule is animated by changing the last multiplier number 
				(representing the line number) */
				top: calc(-3px - 20.5px + 20.5px * 1);
				border-radius: 5px;
			}
			@keyframes highlightAnimation {
				0% {
					top: calc(-3px - 20.5px + 20.5px * 1);
				}
				100% {
					top: calc(-3px - 20.5px + 20.5px * 25);
				}
			}
			#algorithm .code-container.k-way .algorithm-name::before {
				content: "K-way External Sorting";
				font-size: 1em;
			}
			#algorithm .code-container.two-way .algorithm-name::before {
				content: "2-way External Sorting";
				font-size: 1em;
			}
			#algorithm .code-container.double-buffering .algorithm-name::before {
				content: "Double Buffering External Sorting";
				font-size: 0.98em;
			}
			#algorithm .code-container.replacement-selection .algorithm-name::before {
				content: "Replacement Selection External Sorting";
				font-size: 0.85em;
			}
			/* --------------------------------------------------------------------------------------------------- */
			:root {
				--secondary-storage-section-width: 53%;
				--page-dim: 90px;
				--frame-margin-top: 8px;
				--frame-margin-left: 23px;
				--border-thickness: 1.6px;
				--frames-per-row: 2;
				--controls-section-height: 7.16vw;
				--scrollbar-width: 1vw;
			}
			#visualizer {
				width: 100%;
				display: flex;
				height: fit-content;
				align-items: stretch;
				min-height: 100%;
				overflow-x: hidden;
				background-color: var(--gray-t3);
			}
			#visualizer > div {
				margin: 0;
				padding: 0;
			}
			#visualizer .section-title {
				width: 100%;
				text-align: center;
				vertical-align: center;
				line-height: 48px;
				box-shadow: var(--box-shadow);
				font-size: 19px;
				height: 47px;
				font-weight: bold;
			}
			/* --------------------------------------------------------------------------------------------------- */
			#main-memory-container {
				display: flex;
				flex-direction: column;
				justify-content: flex-start;
				align-items: center;
				width: calc(100% - var(--secondary-storage-section-width));
				background-color: var(--gray-t3);
				height: fit-content;
				flex: flex;
			}
			#visualizer #main-memory-container .section-title {
				background-color: var(--gray-t3);
				z-index: 10;
				color: var(--gray-t1);
			}
			#visualizer .blocks-wrapper {
				display: inline-flex;
				flex-direction: row;
				align-content: center;
				justify-content: center;
				align-items: center;
				width: calc(var(--page-dim) * var(--frames-per-row) + var(--frame-margin-left) * 2 * var(--frames-per-row) + var(--border-thickness) * 2 * var(--frames-per-row));
				height: fit-content;
				margin: 35px 0;
				padding: 55px 20px 25px 20px;
				color: var(--black);
				position: relative;
			}
			#frame-buffer {
				position: relative;
			}
			#frame-buffer.blocks-wrapper {
				background-color: var(--gray-t2);
				border: var(--border-thickness) solid var(--black);
			}
			#visualizer .blocks-container {
				width: fit-content;
				margin: 0 auto;
				display: inline-flex;
				flex-direction: row;
				flex-wrap: wrap;
				align-content: flex-start;
				justify-content: center;
				align-items: flex-start;
			}
			#visualizer .blocks-container-name {
				top: 19px;
				left: 30px;
				width: calc(100% - 30px * 2);
				text-align: center;
				position: absolute;
				font-weight: bold;
				font-size: 18px;
			}
			#visualizer .block {
				width: var(--page-dim);
				height: var(--page-dim);
				border: var(--border-thickness) solid var(--black);
				margin: var(--frame-margin-top) var(--frame-margin-left);
				background-color: var(--gray-t2);
				position: relative;
				counter-reset: record;
			}
			#visualizer .block .block-name {
				position: absolute;
				top: 2.5px;
				left: 3px;
				font-size: 14px;
				font-weight: bold;
				display: block;
				color: var(--black);
				text-shadow: 0 0 15px var(--gray-t2);
				z-index: 20;
				background-color: #b9b9b9cc;
				border-radius: 3px;
				padding: 1px 3px;
			}
			#visualizer .block .record,
			#copies-container .record-copy {
				display: block;
				margin: 0;
				padding-right: 5px;
				border: var(--border-thickness) solid var(--black);
				width: calc(var(--page-dim) - 5px);
				align-self: center;
				position: relative;
				top: 0;
				left: 0;
				text-overflow: ellipsis;
				white-space: nowrap;
				word-wrap: break-word;
				text-align: right;
				font-size: 14px;
				font-weight: bold;
				z-index: 12;
				user-select: none;
				text-shadow: 0 0 5px #ffffff30;
				transition: transform 0.1s, opacity 0.1s;
			}
			#frame-buffer.blocks-wrapper.single-column {
				width: calc(var(--page-dim) * 1 + var(--frame-margin-left) * 2 * 1 + var(--border-thickness) * 2 * 1);
				padding-left: calc(var(--page-dim) * 1.21 + var(--frame-margin-left) * 2 * 1 + var(--border-thickness) * 2 * 1);
				min-height: calc(var(--page-dim) * 2 + var(--frame-margin-top) * 2 * 2 + var(--border-thickness) * 2 * 2);
				align-items: flex-start;
			}
			#frame-buffer.blocks-wrapper.single-column .block:last-child {
				position: absolute;
				top: calc(55px + var(--frame-margin-top) * 2 + var(--page-dim) + var(--border-thickness) * 2);
				left: 20px;
			}
			#frame-buffer.blocks-wrapper.single-column .block:nth-child(1) {
				position: absolute;
				top: 55px;
				left: 20px;
			}
			#frame-buffer.single-column .blocks-container-name {
				width: 120%;
				left: -10%;
			}
			/* Class for inactive records */
			.block .record.inactive {
				background: linear-gradient(#00000080 0%, #00000080 100%);
			}
			.block .record:not(.first-active)::after,
			.block .record:not(.first-active)::after,
			#frame-buffer.replacement-selection:not(.pass-zero) .block::before {
				content: '';
				opacity: 0;
				transition: opacity 0.1s;
			}
			.block .record.first-active::after,
			.block .record.first-inactive::after,
			#frame-buffer.replacement-selection.pass-zero .block::before {
				height: 50px;
				padding-top: 5%;
				text-align: left;
				left: -24px;
				width: 19px;
				font-size: 12.5px;
				line-height: 10px;
				top: calc(-1 * var(--border-thickness));
				position: absolute;
				background-repeat: no-repeat;
				background-position: 35% 20px;
				border-top: var(--border-thickness) dashed var(--black);
				color: var(--black);
				opacity: 0.5;
				font-weight: bold;
				padding-right: 3px;
				transition: opacity 0.1s;
				text-align: right;
			}
			.block .record.first-active::after {
				content: "Q1";
			}
			.block .record.first-inactive::after {
				content: "Q2";
			}
			#frame-buffer.replacement-selection.pass-zero .block:last-child::before {
				content: 'OUT';
				margin-left: -7px;
				width: 24px;
			}
			#frame-buffer.replacement-selection.pass-zero .block:nth-child(1)::before {
				content: 'IN';
				margin-left: -7px;
				width: 24px;
			}
			/* --------------------------------------------------------------------------------------------------- */
			#copies-container .record-copy {
				z-index: 11;
			}
			#visualizer .block .record .record-value,
			#copies-container .record-copy .record-value {
				position: absolute;
				text-align: left;
				width: 50px;
				display: block;
				right: -55px;
			}
			.record-value.hidden-value {
				visibility: hidden;
			}
			#frame-buffer .blocks-container {
				counter-reset: frame;
			}
			#frame-buffer .block .block-name {
				counter-increment: frame;
			}
			#frame-buffer .block .block-name::before {
				content: 'F' counter(frame);
			}
			#frame-buffer .block:last-child {
				background-color: var(--gray-t1);
			}
			#frame-buffer .block:last-child .block-name::before {
				content: 'F' counter(frame);
			}
			#frame-buffer .block:last-child::after,
			#frame-buffer.replacement-selection.pass-zero .block:nth-child(1)::after {
				line-height: 18px;
				font-size: 0.8em;
				position: absolute;
				bottom: 3px;
				left: 3px;
				text-align: center;
				font-weight: bold;
				background-color: #979797b7;
				text-shadow: 0 0 15px var(--gray-t2);
				border-radius: 3px;
				padding: 1px 3px;
				position: absolute;
				z-index: 20;
			}
			#frame-buffer .block:last-child::after {
				content: 'OUT';
			}
			#frame-buffer.replacement-selection.pass-zero .block:nth-child(1)::after {
				content: 'IN';
			}
			#frame-buffer.replacement-selection.single-column .block:nth-child(1) {
				background-color: var(--gray-t1);
			}
			/* --------------------------------------------------------------------------------------------------- */
			#secondary-storage-container {
				display: inline-flex;
				flex-direction: column;
				justify-content: flex-start;
				justify-self: stretch;
				align-items: center;
				align-content: center;
				width: var(--secondary-storage-section-width);
				background-color: var(--gray-t2);
				box-shadow: inset 0 25px 15px rgba(0, 0, 0, 0.2);
				min-height: 100%;
				flex: flex;
				position: relative;
			}
			#visualizer .blocks-container-name-v2 {
				top: 9px;
				width: 100%;
				text-align: center;
				position: absolute;
				font-weight: bold;
				font-size: 18px;
				overflow: hidden;
				white-space: nowrap;
			}
			#runs-container:not(:has(.transform-to-file)) #run .blocks-container-name-v2::before,
			#runs-container-next:not(:has(.transform-to-file)) #run .blocks-container-name-v2::before {
				content: 'RUN ' counter(runc);
				display: inline-block;
				font-weight: bold;
			}
			#runs-container.transform-to-file #run .blocks-container-name-v2::before,
			#runs-container-next.transform-to-file #run .blocks-container-name-v2::before {
				content: 'RUN 1';
			}
			/* Animate content text to make name appear */
			#runs-container.transform-to-file #run .blocks-container-name-v2::before,
			#runs-container-next.transform-to-file #run .blocks-container-name-v2::before {
				animation: animateFinalName 1.5s 1s linear forwards;
			}
			@keyframes animateFinalName {
				0% {
					content: 'RUN 1'
				}
				8% {
					content: 'RUN '
				}
				16% {
					content: 'RU'
				}
				24% {
					content: 'R'
				}
				32% {
					content: ''
				}
				40% {
					content: 'F'
				}
				48% {
					content: 'FI'
				}
				56% {
					content: 'FIL'
				}
				64% {
					content: 'FILE'
				}
				72% {
					content: 'FILE F'
				}
				80% {
					content: 'FILE FO'
				}
				88% {
					content: 'FILE FOR'
				}
				96% {
					content: 'FILE FOR R'
				}
				100% {
					content: 'FILE FOR R'
				}
			}
			#secondary-storage-container .content {
				width: 100%;
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				align-items: flex-start;
				height: fit-content;
				flex: flex;
				padding-bottom: 100px;
			}
			#visualizer #secondary-storage-container .section-title {
				background-color: var(--gray-t2);
				color: var(--gray-b1);
				z-index: 9;
			}
			#runs-container,
			#runs-container-next {
				display: inline-flex;
				flex-wrap: wrap;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				margin-top: 25px;
				width: fit-content;
				max-width: 50%;
				padding-left: 0 15px;
				position: relative;
			}
			#runs-container .blocks-wrapper,
			#runs-container-next .blocks-wrapper {
				display: inline-flex;
				flex-direction: row;
				align-content: center;
				justify-content: center;
				align-items: center;
				width: calc(var(--page-dim) * 1 + var(--frame-margin-left) * 2 * 1 + var(--border-thickness) * 2 * 1);
				height: fit-content;
				margin: 0 0 5px 0;
				padding: 10px 10px 0px 10px;
			}
			#runs.blocks-wrapper {
				padding-top: 30px;
				padding-bottom: 50px;
			}
			#run.blocks-wrapper {
				padding-top: 32px;
				padding-bottom: 12px;
				margin-bottom: 25px;
				border: 2px var(--gray-b1);
				border-style: dashed;
			}
			#file.blocks-wrapper {
				padding-top: 32px;
				padding-bottom: 15px;
				margin-top: 25px;
				width: calc(var(--page-dim) * 1 + var(--frame-margin-left) * 2 * 1 + var(--border-thickness) * 2 * 1);
			}
			#file .blocks-container {
				counter-reset: pagec;
			}
			#file .block .block-name {
				counter-increment: pagec;
			}
			#file .block .block-name::before {
				content: 'P' counter(pagec);
			}
			#runs-container,
			#runs-container-next {
				overflow: hidden;
				width: 0%;
				counter-reset: runc;
			}
			#runs-container #run,
			#runs-container-next #run {
				overflow: hidden;
				counter-increment: runc;
			}
			#runs-container-next {
				margin-left: 20px;
			}
			#run .blocks-container {
				counter-reset: runepagec;
			}
			#run .block .block-name {
				counter-increment: runepagec;
			}
			*:not(:has(.transform-to-file)) #run .block .block-name::before {
				content: 'R' counter(runc)'-P' counter(runepagec);
			}
			*.transform-to-file #run .block .block-name::before {
				content: 'R' counter(runc)'-P' counter(runepagec);
				animation: pageNumberFinalAnimation 0.5s 2.5s linear forwards;
			}
			@keyframes pageNumberFinalAnimation {
				0% {
					content: 'R' counter(runc)'-P' counter(runepagec);
				}
				25% {
					content: counter(runc)'-P' counter(runepagec);
				}
				50% {
					content: '-P' counter(runepagec);
				}
				75% {
					content: 'P' counter(runepagec);
				}
				100% {
					content: 'P' counter(runepagec);
				}
			}
			/* --------------------------------------------------------------------------------------------------- */
			#copies-container {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
			}
			/* --------------------------------------------------------------------------------------------------- */
			#file .block .pointed {
				border-color: var(--white);
				color: var(--white);
				box-shadow: var(--box-shadow);
				text-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
				transform: scale(1.1);
				transform-origin: center;
				z-index: 15;
			}
			#visualizer .block.invisible {
				border: var(--border-thickness) solid transparent;
				background-color: transparent;
			}
			#visualizer .block.invisible .block-name {
				visibility: hidden;
			}
			.pointed .hidden-value {
				visibility: visible;
			}
			.transform-to-file #run.blocks-wrapper {
				border-color: #00000000;
				transition: border-color 0.5s 0.5s;
			}
			#canvas {
				background: transparent;
				top: 0;
				left: 0;
				z-index: 99999;
				overflow: hidden;
				pointer-events: none;
				position: absolute;
				width: 100%;
				height: 100%;
			}
			#canvas-container {
				overflow: hidden;
				width: 100%;
				height: 100%;
				position: absolute;
				pointer-events: none;
			}
			/* --------------------------------------------------------------------------------------------------- */
			#controls {
				height: var(--controls-section-height);
				position: absolute;
				bottom: 0;
				left: 0;
				background: linear-gradient(to top, #4b4b4bff 0%, 20%, #4b4b4b00 100%);
				z-index: 9999;
				display: inline-flex;
				flex-direction: row;
				justify-content: space-between;
				align-items: center;
				align-content: center;
				padding: 0 0.65vw;
				width: calc(100% - 2 * 0.65vw - var(--scrollbar-width));
				pointer-events: none;
			}
			#controls .controls-section {
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				align-items: center;
				height: 100%;
				width: 33%;
				padding: 0 0.65vw;
				overflow: visible;
				position: relative;
				pointer-events: all;
			}
			#controls .button {
				margin: 0.39vw;
				border-radius: 1000px;
				border: 0.19vw solid var(--gray-t5);
				height: 2.93vw;
				width: 2.93vw;
				box-shadow: var(--box-shadow);
				color: var(--gray-t5);
				font-weight: bold;
				text-align: center;
				line-height: 2.343vw;
				user-select: none;
				position: relative;
			}
			#controls .button:nth-child(-n+1),
			#controls .button:nth-child(n+5) {
				height: 2.343vw;
				width: 2.343vw;
			}
			#controls .button:hover {
				transform: scale(1.05);
				background-color: #00000040;
			}
			#controls .button:active {
				transform: scale(1.05);
				background-color: var(--gray-t5);
			}
			/* ----- Play button ----- */
			#controls #play-pause {
				border: 0.19vw solid var(--gray-t5);
				height: 3.58vw;
				width: 3.58vw;
			}
			#controls #play-pause:not(.paused) {
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 21 24'%3E%3Cpath fill='%23d3d3d3' d='M3 22v-20l18 10-18 10z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 63%;
			}
			#controls #play-pause.paused {
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 1 21 22'%3E%3Cpath fill='%23d3d3d3' d='M4 4h5v16h-5zM12 4h5v16h-5z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 63%;
			}
			/* ----- Step forwards and backwards buttons ----- */
			#controls #step-forward {
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
			}
			#controls #step-backwards {
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				rotate: 180deg;
			}
			#controls #step-forward::before,
			#controls #step-forward::after,
			#controls #step-backwards::before,
			#controls #step-backwards::after {
				display: block;
				content: "";
				width: 37%;
				height: 100%;
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='35' height='30' viewBox='0 0 20 25'%3E%3Cpath fill='%23d3d3d3' d='M3 22v-20l18 10-18 10z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 1.1vw 1.95vw;
			}
			/* ----- Step to start and end button ----- */
			#controls #step-to-end {
				display: inline-flex;
				flex-direction: row;
				justify-content: flex-start;
				align-items: center;
				rotate: 180deg;
			}
			#controls #step-to-start {
				display: inline-flex;
				flex-direction: row;
				justify-content: flex-start;
				align-items: center;
			}
			#controls #step-to-end::before,
			#controls #step-to-start::before {
				display: block;
				content: "|";
				width: 12%;
				height: 100%;
				color: var(--gray-t5);
				font-size: 1.1vw;
				font-weight: bold;
				line-height: 2.314vw;
				text-align: right;
				padding-left: 0.39vw;
			}
			#controls #step-to-end::after,
			#controls #step-to-start::after {
				display: block;
				content: "";
				width: 50%;
				height: 100%;
				rotate: 180deg;
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='35' height='30' viewBox='5 0 20 25'%3E%3Cpath fill='%23d3d3d3' d='M3 22v-20l18 10-18 10z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 1.1vw 1.95vw;
			}
			#speed.button {
				font-size: 0.78vw;
			}
			#speed .selected-speed {
				user-select: none;
				pointer-events: none;
			}
			.button .button-popup {
				position: absolute;
				left: -100%;
				bottom: 3.85vw;
				width: 7.81vw;
				border-radius: 1.465vw;
				display: inline-flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				align-content: center;
				background-color: #4b4b4bc0;
				font-weight: normal;
				transform-origin: bottom center;
				transform: scale(0);
				transition: 0.1s transform ease-in-out;
				font-size: 0.976vw;
				overflow: hidden;
			}
			.button-popup > div {
				width: 100%;
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				align-items: center;
				align-content: center;
			}
			.speed-popup > div {
				line-height: 1.82vw;
			}
			.button-popup > div:nth-child(1) {
				padding-top: 0.13vw;
			}
			.button-popup > div:last-child {
				padding-bottom: 0.4vw;
			}
			.speed-popup.showing {
				transform: scale(1);
			}
			#controls .button:has(.speed-popup.showing) {
				transform: scale(1.05);
				background-color: var(--gray-b1);
			}
			.speed-popup > div:nth-child(odd):first-child {
				border-radius: 1.63vw 1.63vw 0 0;
			}
			.button-popup > div:nth-child(odd) {
				background-color: #00000020;
			}
			.button .speed-popup .selected {
				font-weight: bold;
			}
			.button .speed-popup .selected::before {
				content: " [ ";
			}
			.button .speed-popup .selected::after {
				content: " ] ";
			}
			.button .speed-popup div:hover {
				cursor: pointer;
			}
			.button .speed-popup div:hover {
				text-decoration: underline;
			}
			/* ----- Restart button ----- */
			#controls #restart {
				background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0'%3F%3E%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24px' fill='%23d3d3d3' height='24px'%3E%3Cpath d='M 2 2 L 4.9394531 4.9394531 C 3.1262684 6.7482143 2 9.2427079 2 12 C 2 17.514 6.486 22 12 22 C 17.514 22 22 17.514 22 12 C 22 6.486 17.514 2 12 2 L 12 4 C 16.411 4 20 7.589 20 12 C 20 16.411 16.411 20 12 20 C 7.589 20 4 16.411 4 12 C 4 9.7940092 4.9004767 7.7972757 6.3496094 6.3496094 L 9 9 L 9 2 L 2 2 z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 70%;
			}
			/* --------------------------------------------------------------------------------------------------- */
			.current-phase-description {
				color: var(--white);
				font-weight: normal;
				font-size: 0.945vw;
				width: 100%;
				height: 100%;
				margin-top: auto;
				margin-bottom: auto;
				margin-left: 0.32vw;
				border-radius: 1.63vw 1.63vw 0 0;
				max-height: 5.5em;
				padding: 0.78vw 0;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: normal;
				word-wrap: normal;
				line-height: 1.35em;
				line-clamp: 3;
				display: inline-flex;
				transition: transform 100ms;
			}
			.current-phase-description > div > span {
				position: relative;
				margin: auto 0;
				display: -webkit-box;
				-webkit-line-clamp: 3;
				-webkit-box-orient: vertical;
				vertical-align: center;
				overflow: hidden;
			}
			.current-phase-description > div {
				position: relative;
				height: 100%;
				width: calc(100% - 1.17vw - 1.3vw);
				margin: 0 auto;
				display: inline-flex;
				background-color: #22222270;
				padding: 0 0.455vw;
				border-radius: 0.65vw;
				box-shadow: var(--box-shadow);
			}
			.current-phase-description > div:has(#input-values) {
				width: calc(100% - 1.17vw - 1.3vw + 0.65vw);
				padding: 0 0.13vw;
			}
			.current-phase-description .text-info-note {
				display: inline-flex;
				background-color: rgb(0, 136, 255);
				border: var(--border-thickness) solid var(--white);
				overflow: hidden;
				padding: 0 3px;
				font-weight: bold;
				text-align: center;
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				line-height: 17px;
				color: var(--white);
				text-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
			}
			.current-phase-description .description-record {
				display: inline-flex;
				border: var(--border-thickness) solid var(--white);
				padding: 0 0.19vw 0 1.17vw;
				font-weight: bold;
				text-align: right;
				line-height: 1.1vw;
				color: var(--white);
				text-shadow: 0 0 0.65vw rgba(0, 0, 0, 0.4);
			}
			/* final description */
			.final-description > span {
				margin: auto 0;
			}
			.final-description {
				font-weight: 900;
				font-size: 1.56vw;
				height: 100%;
				display: flex;
				width: 70%;
				margin: auto;
				align-items: flex-end;
				text-transform: uppercase;
				-webkit-text-stroke: 0.065vw var(--white);
				flex-direction: row;
				justify-content: center;
				line-height: 1.95vw;
			}
			.current-phase-description > div:has(.final-description),
			.current-phase-description > div:has(.final-description-alternate) {
				width: calc(100% - 1.17vw - 0.195vw);
				height: 100%;
			}
			.current-phase-description span:has(.final-description),
			.current-phase-description span:has(.final-description-alternate) {
				width: 100%;
				height: 100%;
			}
			.current-phase-description span:has(.final-description-alternate) {
				display: inline-flex;
			}
			.final-description-alternate {
				width: 100%;
				margin: auto;
				padding: auto;
				text-align: center;
				font-size: 1.56vw;
				line-height: 1.95vw;
			}
			#animation-controls-container {
				background-color: #22222270;
				border-radius: 0.65vw;
				max-height: 5.2vw;
				max-width: fit-content;
			}
			/* ------------------------------- alternate algoritihm selector ------------------------------------------------------------------------------*/
			#algorithm-selector-alternate {
				/* display: none; */
				position: absolute;
				z-index: 9999;
				/* top: 1vw; */
				bottom: 6.8vw;
				left: 2.22vw;
				display: inline-flex;
				flex-direction: row;
				align-items: center;
				justify-content: flex-start;
				border-radius: 0.45vw;
				width: 30.75vw;
			}
			#algorithm-selector-alternate > div {
				font-size: 0.9vw;
				height: 1.4vw;
				overflow: hidden;
				padding: 0.3vw 1vw 0.3vw 1vw;
				margin: 0 0.235vw;
				border-radius: 0.45vw;
				display: inline-flex;
				flex-direction: row;
				justify-content: flex-start;
				align-items: center;
				color: var(--white);
				cursor: default;
				user-select: none;
				background-color: #00000020;
			}
			#algorithm-selector-alternate > div.selected {
				font-weight: bold;
				background-color: #00000050;
			}
			#algorithm-selector-alternate > div:hover {
				text-decoration: underline;
			}
			#animation-controls-container .zoom-note {
				position: absolute;
				background-color: transparent;
				font-size: 1vw;
				text-align: center;
				font-weight: normal;
				padding: 0;
				margin: 0;
				color: #ffffff90;
				height: 3vw;
				width: 100%;
				top: -1.6vw
			}
			/* Other controls section --------------------------------------------------------------------------------------------------------------------------------- */
			#other-controls-container.controls-section {
				background-color: #22222270;
				border-radius: 0.65vw;
				max-height: 5.2vw;
				margin-right: 3vw;
				margin-left: 4vw;
				max-width: 25%;
				height: 100%;
				display: inline-flex;
				flex-direction: row;
				justify-content: space-between;
			}
			#other-controls-container > div {
				width: 100%;
				display: inline-flex;
				flex-direction: row;
				align-items: center;
				color: var(--white);
				font-weight: normal;
				font-size: 0.945vw;
				margin-top: auto;
				margin-bottom: auto;
				line-height: 1.5em;
			}
			#other-controls-container > div:first-child {
				justify-content: flex-start;
				max-width: 11vw;
			}
			#other-controls-container > div:last-child {
				justify-content: flex-end;
			}
			#other-controls-container #other-infos {
				display: inline-flex;
				flex-direction: column;
			}
			#other-controls-container #other-infos > div {
				display: inline-flex;
				flex-direction: row;
				justify-content: space-between;
				align-items: center;
				width: 11.2vw;
				display: inline-flex;
				flex-direction: row;
				justify-content: space-between;
				padding: 0.13vw 0.55vw;
				margin: 0.13vw 0.26vw;
				border-radius: 0.32vw;
				background-color: #00000035;
				color: var(--gray-t5);
			}
			#options-button.button {
				background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0'%3F%3E%3Csvg fill='%23d3d3d3' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='30px' height='24px'%3E%3Cpath d='M 10.490234 2 C 10.011234 2 9.6017656 2.3385938 9.5097656 2.8085938 L 9.1757812 4.5234375 C 8.3550224 4.8338012 7.5961042 5.2674041 6.9296875 5.8144531 L 5.2851562 5.2480469 C 4.8321563 5.0920469 4.33375 5.2793594 4.09375 5.6933594 L 2.5859375 8.3066406 C 2.3469375 8.7216406 2.4339219 9.2485 2.7949219 9.5625 L 4.1132812 10.708984 C 4.0447181 11.130337 4 11.559284 4 12 C 4 12.440716 4.0447181 12.869663 4.1132812 13.291016 L 2.7949219 14.4375 C 2.4339219 14.7515 2.3469375 15.278359 2.5859375 15.693359 L 4.09375 18.306641 C 4.33275 18.721641 4.8321562 18.908906 5.2851562 18.753906 L 6.9296875 18.1875 C 7.5958842 18.734206 8.3553934 19.166339 9.1757812 19.476562 L 9.5097656 21.191406 C 9.6017656 21.661406 10.011234 22 10.490234 22 L 13.509766 22 C 13.988766 22 14.398234 21.661406 14.490234 21.191406 L 14.824219 19.476562 C 15.644978 19.166199 16.403896 18.732596 17.070312 18.185547 L 18.714844 18.751953 C 19.167844 18.907953 19.66625 18.721641 19.90625 18.306641 L 21.414062 15.691406 C 21.653063 15.276406 21.566078 14.7515 21.205078 14.4375 L 19.886719 13.291016 C 19.955282 12.869663 20 12.440716 20 12 C 20 11.559284 19.955282 11.130337 19.886719 10.708984 L 21.205078 9.5625 C 21.566078 9.2485 21.653063 8.7216406 21.414062 8.3066406 L 19.90625 5.6933594 C 19.66725 5.2783594 19.167844 5.0910937 18.714844 5.2460938 L 17.070312 5.8125 C 16.404116 5.2657937 15.644607 4.8336609 14.824219 4.5234375 L 14.490234 2.8085938 C 14.398234 2.3385937 13.988766 2 13.509766 2 L 10.490234 2 z M 12 8 C 14.209 8 16 9.791 16 12 C 16 14.209 14.209 16 12 16 C 9.791 16 8 14.209 8 12 C 8 9.791 9.791 8 12 8 z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				height: 2.343vw;
				width: 2.343vw;
				background-size: 100%;
			}
			#about-button.button {
				height: 2.343vw;
				width: 2.343vw;
				font-size: 1.5vw;
			}
			#controls .button-wide {
				width: fit-content !important;
				padding: 0 0.5vw;
				font-size: 0.9em;
			}
			.button .options-popup {
				width: 18.25vw;
				left: calc(-1 * (18.25vw - 10.4vw));
				transform-origin: bottom center;
				background-color: #505050ea;
			}
			.options-popup.showing {
				transform: scale(1);
			}
			.button:has(.options-popup.showing) {
				transform: scale(1.05);
				background-color: var(--gray-b1);
			}
			.button .options-popup > div {
				display: inline-flex;
				flex-direction: row;
				justify-content: space-between;
				padding: 0 1vw;
				width: calc(100% - 1vw * 2);
				height: 2.7vw;
				position: relative;
				padding-top: 0.1vw;
			}
			.button .options-popup > div:first-child {
				font-weight: bold;
				text-align: center;
				align-items: center;
				justify-content: center;
			}
			#other-controls-container .option-description {
				position: absolute;
				top: 2.8vw;
				font-size: 0.8vw;
				left: 0;
				line-height: 0.9vw;
				text-align: left;
				padding: 0 0.8vw 0 1vw;
				width: calc(100% - 0.8vw - 1vw);
				opacity: 0.75;
			}
			.options-popup > div:nth-child(2) {
				padding-bottom: 2.5vw;
			}
			.options-popup > div:nth-child(3) {
				padding-bottom: 1.7vw;
			}
			.options-popup > div:nth-child(4) {
				padding-bottom: 1.9vw;
			}
			.options-popup > div:nth-child(5) {
				padding-bottom: 1.9vw;
			}
			/* ---------- toggle button ---------- */
			/* The switch - the box around the slider */
			.toggle-switch {
				position: relative;
				display: inline-block;
				width: 3.2vw;
				height: 1.8vw;
				margin: auto 0;
				pointer-events: all;
			}
			/* Hide default HTML checkbox */
			.toggle-switch input {
				opacity: 0;
				width: 0;
				height: 0;
			}
			/* The slider toggle-*/
			.toggle-slider {
				position: absolute;
				cursor: pointer;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-color: #ccc;
				-webkit-transition: 0.1s;
				transition: 0.1s;
				border-radius: 100vw;
			}
			.toggle-slider:before {
				position: absolute;
				content: "";
				height: 1.4vw;
				width: 1.4vw;
				left: 0.21vw;
				bottom: 0.21vw;
				background-color: white;
				-webkit-transition: 0.1s;
				transition: 0.1s;
				border-radius: 50%;
			}
			.toggle-switch input:checked + .toggle-slider {
				background-color: #2ce34b;
			}
			.toggle-switch input:focus + .toggle-slider {
				box-shadow: 0 0 1px #2ce34b;
			}
			.toggle-switch input:checked + .toggle-slider:before {
				-webkit-transform: translateX(1.4vw);
				-ms-transform: translateX(1.4vw);
				transform: translateX(1.4vw);
			}
			/* Instructions popup ----------------------------------------------------------------------------------------------------------------------------------- */
			#about-popup:not(.showing) {
				transform: translate(0, 33%) scale(0);
			}
			#about-popup.showing {
				transform: translate(0, 0) scale(1);
			}
			#about-popup {
				--popup-width: 47%;
				--popup-height: 35.5vw;
				position: absolute;
				font-size: 0.95vw;
				background-color: var(--gray-t2);
				z-index: 10005;
				top: calc((100% - var(--popup-height)) / 2);
				left: calc((100% - var(--popup-width)) / 2);
				width: var(--popup-width);
				height: var(--popup-height);
				border-radius: 2vw;
				color: var(--white);
				min-height: fit-content;
				overflow: hidden;
				text-overflow: ellipsis;
				box-shadow: var(--box-shadow);
				z-index: 10005;
				transition: transform 0.15s ease-in-out;
			}
			#about-popup > div {
				padding: 1.2vw 1.8vw 1.8vw 1.8vw;
				text-align: center;
			}
			#about-popup .text-box {
				display: inline-flex;
				border: var(--border-thickness) solid var(--white);
				overflow: hidden;
				padding: 0 0.2vw;
				font-weight: bold;
				text-align: center;
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				color: var(--white);
				text-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
				margin-left: 0.1vw;
				margin-right: 0.5vw;
				height: 1.2vw;
				max-height: 1.2vw;
				min-height: 1.2vw;
				width: 0.8vw;
				max-width: 0.8vw;
				min-width: 0.8vw;
			}
			#about-popup div:nth-child(1) > .text-box {
				background-color: rgb(236, 27, 27);
			}
			#about-popup div:nth-child(2) > .text-box {
				background-color: rgb(238, 201, 15);
			}
			#about-popup div:nth-child(3) > .text-box {
				background-color: rgb(48, 224, 25);
			}
			#about-popup div:nth-child(4) > .text-box {
				background-color: rgb(25, 184, 224);
			}
			#about-popup div:nth-child(5) > .text-box {
				background-color: rgb(42, 25, 224);
			}
			#about-popup div:nth-child(6) > .text-box {
				background-color: rgb(164, 25, 224);
			}
			#about-popup div:nth-child(7) > .text-box {
				background-color: rgb(224, 25, 184);
			}
			.button-icon {
				display: inline-block;
				border: 0.2vw solid var(--white);
				height: 1vw;
				width: 1vw;
				border-radius: 100vw;
				background-repeat: no-repeat;
				background-position: center;
				background-size: 63%;
				font-size: 0.6em;
				text-align: center;
				align-items: center;
				color: var(--white);
				font-weight: bold;
				line-height: 1.7em;
				overflow: hidden;
			}
			.play-pause-icon {
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 21 24'%3E%3Cpath fill='%23ffffff' d='M3 22v-20l18 10-18 10z'/%3E%3C/svg%3E");
			}
			.sorting-tree-icon {
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='649' height='380' viewBox='0 0 649 473'%3E%3Ctitle%3Ehierarchy%3C/title%3E%3Crect x='240' width='180' height='133' fill='%23ffffff'/%3E%3Crect x='240' y='340' width='180' height='133' fill='%23ffffff'/%3E%3Crect y='340' width='180' height='133' fill='%23ffffff'/%3E%3Crect x='469' y='340' width='180' height='133' fill='%23ffffff'/%3E%3Cpolygon points='132 259.5 306 259.5 306 308 354 308 354 259.5 528 259.5 528 308 576 308 576 211.5 354 211.5 354 163 306 163 306 211.5 84 211.5 84 308 132 308 132 259.5' fill='%23ffffff'/%3E%3C/svg%3E");
				background-position: center center;
				background-repeat: no-repeat;
				background-size: 100% 55%;
			}
			.reset-icon {
				background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0'%3F%3E%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24px' fill='%23ffffff' height='24px'%3E%3Cpath d='M 2 2 L 4.9394531 4.9394531 C 3.1262684 6.7482143 2 9.2427079 2 12 C 2 17.514 6.486 22 12 22 C 17.514 22 22 17.514 22 12 C 22 6.486 17.514 2 12 2 L 12 4 C 16.411 4 20 7.589 20 12 C 20 16.411 16.411 20 12 20 C 7.589 20 4 16.411 4 12 C 4 9.7940092 4.9004767 7.7972757 6.3496094 6.3496094 L 9 9 L 9 2 L 2 2 z'/%3E%3C/svg%3E");
				background-size: 70%;
			}
			.step-forward-icon {
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
			}
			.step-backwards-icon {
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				rotate: 180deg;
			}
			.step-forward-icon::before,
			.step-forward-icon::after,
			.step-backwards-icon::before,
			.step-backwards-icon::after {
				display: block;
				content: "";
				width: 31%;
				height: 100%;
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='30' viewBox='0 0 25 25'%3E%3Cpath fill='%23ffffff' d='M3 22v-20l18 10-18 10z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 0.7vw;
			}
			#about-popup > div > div {
				margin: 0.5vw 0;
			}
			#about-popup .description {
				text-align: left;
				display: inline-flex;
				flex-direction: column;
				justify-content: flex-start;
				align-items: flex-start;
				width: 100%;
				color: var(--gray-t4);
			}
			#about-popup .instructions {
				margin-top: 1vw;
				background-color: #00000030;
				border-radius: 0.8vw;
				text-align: left;
				padding: 0.8vw 1.3vw 0.8vw 1.3vw;
			}
			#about-popup .instructions > div:nth-child(2) > div {
				margin: 0.15vw 0;
				display: inline-flex;
				flex-direction: row;
				align-items: flex-start;
			}
			#about-popup .instructions > div:nth-child(2) {
				margin-top: 0.3vw;
			}
			#about-popup .description > div {
				margin: 0.3vw 0;
				text-align: center;
				width: 100%;
			}
			#about-popup a {
				text-decoration: underline;
				font-weight: bold;
				color: var(--gray-t5);
			}
			#black-overlay.showing {
				opacity: 1;
				pointer-events: all;
			}
			#black-overlay:not(.showing) {
				opacity: 0;
				pointer-events: none;
			}
			#black-overlay {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background-color: #00000080;
				z-index: 10000;
				transition: opacity 0.15s;
			}
			#about-popup > div#close-about-popup-button {
				position: absolute;
				top: 1.5vw;
				right: 1.5vw;
				background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0'%3F%3E%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 25 24'%3E%3Cpath fill='%23ffffff' d='M 6.34375 2.28125 L 2.28125 6.34375 L 17.65625 21.71875 L 21.71875 17.65625 L 6.34375 2.28125 z M 2.28125 17.65625 L 6.34375 21.71875 L 21.71875 6.34375 L 17.65625 2.28125 L 2.28125 17.65625 z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 90% 90%;
				background-origin: content-box;
				border-radius: 100vw;
				border: 0.2vw solid var(--white);
				width: 2vw;
				height: 2vw;
				padding: 0;
				background-color: #00000030;
				transform-origin: center center;
			}
			#about-popup > div#close-about-popup-button:hover {
				background-color: #00000050;
				transform: scale(1.05);
			}
			#other-controls-container #sorting-tree-button.button {
				background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='649' height='380' viewBox='0 0 649 473'%3E%3Ctitle%3Ehierarchy%3C/title%3E%3Crect x='240' width='180' height='133' fill='%23d3d3d3'/%3E%3Crect x='240' y='340' width='180' height='133' fill='%23d3d3d3'/%3E%3Crect y='340' width='180' height='133' fill='%23d3d3d3'/%3E%3Crect x='469' y='340' width='180' height='133' fill='%23d3d3d3'/%3E%3Cpolygon points='132 259.5 306 259.5 306 308 354 308 354 259.5 528 259.5 528 308 576 308 576 211.5 354 211.5 354 163 306 163 306 211.5 84 211.5 84 308 132 308 132 259.5' fill='%23d3d3d3'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 85%;
				height: 2.93vw;
				width: 2.93vw;
			}
			/* Sorting Tree ----------------------------------------------------------------------------------------------------------------------------------------- */
			#sorting-tree-popup:not(.showing) {
				transform: translate(0, 33%) scale(0);
			}
			#sorting-tree-popup.showing {
				transform: translate(0, 0) scale(1);
			}
			#sorting-tree-popup {
				--popup-width: 95%;
				--popup-height: 95%;
				position: absolute;
				font-size: 1.1vw;
				background-color: var(--gray-t2);
				z-index: 10005;
				top: calc((100% - var(--popup-height)) / 2);
				left: calc((100% - var(--popup-width)) / 2);
				width: var(--popup-width);
				height: var(--popup-height);
				border-radius: 2vw;
				color: var(--white);
				min-height: fit-content;
				overflow: hidden;
				text-overflow: ellipsis;
				box-shadow: var(--box-shadow);
				z-index: 10005;
				transition: transform 0.15s ease-in-out;
			}
			#sorting-tree-popup .sorting-tree-description {
				margin-top: 1vw;
				line-height: 1.3em;
			}
			#sorting-tree-popup > div {
				padding: 1.2vw 0vw 1.8vw 0vw;
				text-align: center;
				height: 100%;
			}
			#sorting-tree-popup > div#close-sorting-tree-popup-button {
				position: absolute;
				top: 1.5vw;
				right: 1.5vw;
				background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0'%3F%3E%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 25 24'%3E%3Cpath fill='%23ffffff' d='M 6.34375 2.28125 L 2.28125 6.34375 L 17.65625 21.71875 L 21.71875 17.65625 L 6.34375 2.28125 z M 2.28125 17.65625 L 6.34375 21.71875 L 21.71875 6.34375 L 17.65625 2.28125 L 2.28125 17.65625 z'/%3E%3C/svg%3E");
				background-repeat: no-repeat;
				background-position: center;
				background-size: 90% 90%;
				background-origin: content-box;
				border-radius: 100vw;
				border: 0.2vw solid var(--white);
				width: 2vw;
				height: 2vw;
				padding: 0;
				background-color: #00000030;
				transform-origin: center center;
			}
			#sorting-tree-popup > div#close-sorting-tree-popup-button:hover {
				background-color: #00000050;
				transform: scale(1.05);
			}
			#sorting-tree-container {
				margin-top: 1vw;
				width: 100%;
				height: 80%;
				display: inline-flex;
				flex-direction: column;
				justify-content: flex-start;
				align-items: flex-start;
				overflow-y: auto;
				overflow-x: hidden;
				position: relative;
			}
			#sorting-tree-container .tree-pass {
				width: calc(100% - 1vw * 2);
				height: fit-content;
				padding: 0.7vw 1vw 1vw 1vw;
				position: relative;
				padding-top: 1.7vw;
				counter-reset: treerunc 0;
			}
			#sorting-tree-container {
				counter-set: tree-passes -2;
			}
			#sorting-tree-container .tree-pass::before {
				counter-increment: tree-passes;
				content: "Pass " counter(tree-passes);
				position: absolute;
				top: 0.55vw;
				left: 1vw;
				font-weight: bold;
				display: block;
				font-size: 1.05em;
				color: var(--black);
				z-index: 10010;
				background-color: #b9b9b9aa;
				border-radius: 3px;
				padding: 1px 3px;
			}
			#sorting-tree-container .tree-pass:last-child {
				padding-bottom: 2vw;
			}
			#sorting-tree-container .tree-pass:not(:first-child)::before {
				content: "Pass " counter(tree-passes);
			}
			#sorting-tree-container .tree-pass:first-child::before {
				content: "Unsorted File";
			}
			#sorting-tree-container .tree-pass:nth-child(even) {
				background-color: #00000018;
			}
			#sorting-tree-container .tree-pass:nth-child(odd) {
				background-color: #00000010;
			}
			#sorting-tree-container .tree-block {
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				align-items: center;
				width: 3.5vw;
				height: 3.5vw;
				border: var(--border-thickness) solid var(--black);
				margin: 0.3vw 0.3vw;
				background-color: var(--gray-t2);
				position: relative;
			}
			#sorting-tree-container .tree-pass .tree-run::before {
				content: "R" counter(treerunc);
				color: var(--black);
				position: absolute;
				top: 0.2vw;
				left: 0.2vw;
				border-radius: 0.2vw;
				z-index: 101;
				font-size: 0.7em;
				font-weight: bold;
				background-color: #b8b8b8db;
				padding: 0.05vw 0.15vw;
				display: block;
				text-align: right;
			}
			#sorting-tree-container .tree-pass .tree-run {
				display: inline-flex;
				flex-direction: row;
				justify-content: center;
				align-items: center;
				flex-wrap: wrap;
				border: var(--border-thickness) dashed var(--black);
				padding: 0.1vw 0.1vw;
				margin: 0.7vw 0.7vw 0 0.7vw;
				position: relative;
				counter-increment: treerunc;
			}
			#sorting-tree-container .tree-pass:last-child .tree-run,
			#sorting-tree-container .tree-pass:first-child .tree-run {
				border: var(--border-thickness) dashed #00000000;
			}
			#sorting-tree-container .tree-pass:last-child .tree-run::before,
			#sorting-tree-container .tree-pass:first-child .tree-run::before {
				display: none;
			}
			#sorting-tree-container .tree-record.empty {
				opacity: 0.2;
				background-color: var(--black);
			}
			#sorting-tree-container .tree-record {
				border: var(--border-thickness) solid var(--black);
				height: 100%;
				flex: 1;
				margin: calc(-1 * var(--border-thickness) / 2);
				position: relative;
				z-index: 12;
			}
			/* set scroll bar width */
			#sorting-tree-container::-webkit-scrollbar {
				width: calc(var(--scrollbar-width) * 0.9);
				z-index: 99999;
			}
			/* Track */
			#sorting-tree-container::-webkit-scrollbar-track {
				background: var(--gray-t1);
			}
			/* Handle */
			#sorting-tree-container::-webkit-scrollbar-thumb {
				background: var(--gray-b1);
			}
			/* Handle on hover */
			#sorting-tree-container::-webkit-scrollbar-thumb:hover {
				background: var(--gray-b2);
			}
			/* ------------------------------- media queries -------------------------------------------------------------------------------------------- */
			@media screen and (min-width: 1401px) {
				#algorithm-selector-alternate {
					display: none;
				}
				#animation-controls-container .zoom-note {
					display: none;
				}
			}
			@media screen and (max-width: 1400px) {
				#collapse-arrow {
					visibility: hidden;
					user-select: none;
					pointer-events: none;
				}
				#algorithm-section {
					width: 0px;
				}
			}
	</style>
</head>
<body>

	<!-- Container for fireworks -->
	<div id="canvas-container">
		<canvas id="canvas"></canvas>
	</div>
	
	<!-- Actual page content -->
	<div id="page">

		<div id="algorithm-section">
			<div id="algorithm" >

				<!-- "menu bar" on top -->
				<div id="algorithm-selector">
					<div id="two-way" class="selected">2-way</div>
					<div id="k-way">K-way</div>
					<div id="replacement-selection">Replacement Selection</div>
				</div>

				<!-- 2-WAY ALGORITHM---------------------------------------------------------------------------------- -->
				<div class="code-container two-way" style="display: none;">
					<div class="algorithm-name"></div>
					<div class="code">
						<div><span class="comments">// Pass 0</span></div>
						<div><span class="instructions">while</span> <span class="parenthesis">(</span>no more pages in <b>R</b><span class="parenthesis">)</span>:</div>
						<div>	load <b>1</b> page of relation <b>R</b> in the buffer</div>
						<div>	sort records of the page in the buffer</div>
						<div>	write corresponding page in a new run</div>
						<div>set <b>i</b> = <b>1</b></div>
						<div><span class="comments">// Pass i</span></div>
						<div><span class="instructions">while</span> <span class="parenthesis">(</span>there are other runs to consider for pass <b>i</b><span class="parenthesis">)</span>:</div>
						<div>	select <b>M-1</b> runs created in pass <b>i-1</b> and not yet analyzed</div>
						<div>	load first page of each run in the buffer</div>
						<div>	set pointer of each frame to first record of each page</div>
						<div>	<span class="instructions">while</span> <span class="parenthesis">(</span>buffer is not empty<span class="parenthesis">)</span>:</div>
						<div>		find minimum record <b>r</b> among pointed records</div>
						<div>		write the minimum record <b>r</b> in the output frame</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>record <b>r</b> was NOT last of its frame<span class="parenthesis">)</span>:</div>
						<div>			point to next record for corresponding frame</div>
						<div>		<span class="instructions">else if</span> <span class="parenthesis">(</span>corresponding run has more pages<span class="parenthesis">)</span>:</div>
						<div>			load next page of record <b>r</b>'s run to the frame</div>
						<div>			set pointer of the frame to its first record</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>output frame is full<span class="parenthesis">)</span>:</div>
						<div>			write output frame in secondary storage</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>we are at last record of last page for each run<span class="parenthesis">)</span>:</div>
						<div>			set <b>i</b> = <b>i+1</b></div>
						<div><span class="comments">// File is sorted</span></div>
						<div class="highlight"></div>
					</div>
				</div>
				<!-- K-WAY ALGORITHM---------------------------------------------------------------------------------- -->
				<div class="code-container k-way" style="display: none;">
					<div class="algorithm-name"></div>
					<div class="code">
						<div><span class="comments">// Pass 0</span></div>
						<div><span class="instructions">while</span> <span class="parenthesis">(</span>no more pages in <b>R</b><span class="parenthesis">)</span>:</div>
						<div>	load <b>M</b> pages of relation <b>R</b> in the <b>M</b> frames of the buffer</div>
						<div>	sort records of the <b>M</b> pages in the buffer</div>
						<div>	write corresponding pages in a new run</div>
						<div>set <b>i</b> = <b>1</b></div>
						<div><span class="comments">// Pass i</span></div>
						<div><span class="instructions">while</span> <span class="parenthesis">(</span>there are other runs to consider for pass <b>i</b><span class="parenthesis">)</span>:</div>
						<div>	select <b>M-1</b> runs created in pass <b>i-1</b> and not yet analyzed</div>
						<div>	load first page of each run in the buffer</div>
						<div>	set pointer of each frame to first record of each page</div>
						<div>	<span class="instructions">while</span> <span class="parenthesis">(</span>buffer is not empty<span class="parenthesis">)</span>:</div>
						<div>		find minimum record <b>r</b> among pointed records</div>
						<div>		write the minimum record <b>r</b> in the output frame</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>record <b>r</b> was NOT last of its frame<span class="parenthesis">)</span>:</div>
						<div>			point to next record for corresponding frame</div>
						<div>		<span class="instructions">else if</span> <span class="parenthesis">(</span>corresponding run has more pages<span class="parenthesis">)</span>:</div>
						<div>			load next page of record <b>r</b>'s run to the frame</div>
						<div>			set pointer of the frame to its first record</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>output frame is full<span class="parenthesis">)</span>:</div>
						<div>			write output frame in secondary storage</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>we are at last record of last page for each run<span class="parenthesis">)</span>:</div>
						<div>			set <b>i</b> = <b>i+1</b></div>
						<div><span class="comments">// File is sorted</span></div>
						<div class="highlight"></div>
					</div>
				</div>
				<!-- DOUBLE BUFFERING ALGORITHM---------------------------------------------------------------------------------- -->
				<div class="code-container double-buffering" style="display: none;">
					<div class="algorithm-name"></div>
					<div class="code">
						<div><span class="comments">// To implement</span></div>
						<div class="highlight"></div>
					</div>
				</div>
				<!-- REPLACEMENT SELECTION ALGORITHM---------------------------------------------------------------------------------- -->
				<div class="code-container replacement-selection" style="display: none;">
					<div class="algorithm-name"></div>
					<div class="code">
						<div><span class="comments">// Pass 0</span></div>
						<div>load <b>first</b> page of relation <b>R</b> in the input frame <b>F1</b></div>
						<div>load next <b>M-2</b> pages of <b>R</b> in the buffer</div>
						<div>set <b>Q1</b> = <b>queue</b> of records in the <b>M-2</b> frames starting from <b>F2</b></div>
						<div>set <b>Q2</b> = <b>empty queue</b></div>
						<div><span class="instructions">while</span> <span class="parenthesis">(</span><b>F1</b> or <b>Q1</b> or <b>Q2</b> are not empty<span class="parenthesis">)</span>:</div>
						<div>	<span class="instructions">if</span> <span class="parenthesis">(</span><b>Q1</b> is empty<span class="parenthesis">)</span>:</div>
						<div>		move <b>Q2</b> into <b>Q1</b></div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>output frame is not empty<span class="parenthesis">)</span>:</div>
						<div>			write output frame in secondary storage</div>
						<div>		create new run</div>
						<div>	find minimum record <b>r1</b> in <b>Q1</b></div>
						<div>	move <b>r1</b> in the output frame</div>
						<div>	<span class="instructions">if</span> <span class="parenthesis">(</span><b>F1</b> is empty and <b>R</b> has more pages<span class="parenthesis">)</span>:</div>
						<div>		read next page from <b>R</b></div>
						<div>	<span class="instructions">if</span> <span class="parenthesis">(</span><b>F1</b> is NOT empty)</span>:</div>
						<div>		point to the next record <b>r2</b> in input frame <b>F1</b></div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span><b>r1</b> &lt; <b>r2</b><span class="parenthesis">)</span>:</div>
						<div>			move <b>r2</b> in <b>Q1</b></div>
						<div>		<span class="instructions">else</span>:</div>
						<div>			move <b>r2</b> in <b>Q2</b></div>
						<div>	<span class="instructions">if</span> <span class="parenthesis">(</span>output frame is full<span class="parenthesis">)</span>:</div>
						<div>		write output frame in secondary storage</div>
						<div>set <b>i</b> = <b>1</b></div>
						<div><span class="comments">// Pass i</span></div>
						<div><span class="instructions">while</span> <span class="parenthesis">(</span>there are other runs to consider for pass <b>i</b><span class="parenthesis">)</span>:</div>
						<div>	select <b>M-1</b> runs created in pass <b>i-1</b> and not yet analyzed</div>
						<div>	load first page of each run in the buffer</div>
						<div>	set pointer of each frame to first record of each page</div>
						<div>	<span class="instructions">while</span> <span class="parenthesis">(</span>buffer is not empty<span class="parenthesis">)</span>:</div>
						<div>		find minimum record <b>r</b> among pointed records</div>
						<div>		write the minimum record <b>r</b> in the output frame</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>record <b>r</b> was NOT last of its frame<span class="parenthesis">)</span>:</div>
						<div>			point to next record for corresponding frame</div>
						<div>		<span class="instructions">else if</span> <span class="parenthesis">(</span>corresponding run has more pages<span class="parenthesis">)</span>:</div>
						<div>			load next page of record <b>r</b>'s run to the frame</div>
						<div>			set pointer of the frame to its first record</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>output frame is full<span class="parenthesis">)</span>:</div>
						<div>			write output frame in secondary storage</div>
						<div>		<span class="instructions">if</span> <span class="parenthesis">(</span>we are at last record of last page for each run<span class="parenthesis">)</span>:</div>
						<div>			set <b>i</b> = <b>i+1</b></div>
						<div><span class="comments">// File is sorted</span></div>
						<div class="highlight"></div>
					</div>
				</div>
			</div>
			<div id="collapse-arrow"></div>
		</div>

		<div id="visualizer">
			<div id="main-memory-container">
				<div class="section-title">MAIN MEMORY</div>
				<div id="frame-buffer" class="blocks-wrapper">
					<div class="blocks-container-name">BUFFER</div>
					<div class="blocks-container">
						<!-- Pages go here -->
					</div>
				</div>
			</div>
			<div id="secondary-storage-container">
				<div class="section-title">SECONDARY STORAGE</div>
				<div class="content">
					<div id="runs-container-next">
						<!-- Runs go here -->
						<div id="copies-container"></div>
					</div>
					<div id="runs-container">
						<!-- Runs go here -->
						<div id="copies-container"></div>
					</div>
					<div id="file" class="blocks-wrapper">
						<div class="blocks-container">
							<!-- Pages go here -->
						</div>
						<div class="blocks-container-name-v2">FILE FOR R</div>
						<div id="copies-container"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Alternate algorithm selection (for when the page is too zomed and the algorithm section will be hiddem) -->
	<div id="algorithm-selector-alternate">
		<div id="two-way" class="selected">2-way</div>
		<div id="k-way">K-way</div>
		<div id="replacement-selection">Replacement Selection</div>
	</div>

	<!-- Controls section -->
	<div id="controls">
		<div id="phase-description-container" class="controls-section">
			<div class="current-phase-description">
				<div>
					<span>
						<!-- Current phase description go here -->
					</span>
				</div>
			</div>
		</div>
		<div id="animation-controls-container" class="controls-section">
			<div id="restart" class="button"></div>
			<div id="step-backwards" class="button"></div>
			<div id="play-pause" class="button"></div>
			<div id="step-forward" class="button"></div>
			<div id="speed" class="button">
				<div class="selected-speed">1x</div>
				<div class="speed-popup button-popup">
					<div>3x</div>
					<div>2.5x</div>
					<div>2x</div>
					<div>1.75x</div>
					<div>1.5x</div>
					<div>1.25x</div>
					<div class="selected">1x</div>
					<div>0.75x</div>
					<div>0.5x</div>
					<div>0.25x</div>
				</div>
			</div>
			<div class="zoom-note"><span><b>Zoom out</b> to see the <b>algorithm sidebar</b></span></div>
		</div>
		<div id="other-controls-container" class="controls-section">
			<div>
				<div id="other-infos">
					<div id="current-pass">
						<!-- Current pass text go here -->
					</div>
					<div id="io-operations">
						<!-- IO operations counter text go here -->
					</div>
				</div>
			</div>
			<div>
				<div id="options-button" class="button">
					<div class="options-popup button-popup">
						<div>OPTIONS</div>
						<div>
							<span>Active Element Focus</span>
							<label class="toggle-switch" for="focus-toggle">
								<input id="focus-toggle" type="checkbox" checked>
								<span class="toggle-slider"></span>
							</label>
							<span class="option-description">Scroll to follow the currently active element (e.g. records, pages, ecc...) during animation.</span>
						</div>
						<div>
							<span>Code Highlight</span>
							<label class="toggle-switch" for="code-highlight-toggle">
								<input id="code-highlight-toggle" type="checkbox" checked>
								<span class="toggle-slider"></span>
							</label>
							<span class="option-description">Highlight lines of the algorithm pseudocode.</span>
						</div>
						<div>
							<span>Fireworks</span>
							<label class="toggle-switch" for="fireworks-toggle">
								<input id="fireworks-toggle" type="checkbox" checked>
								<span class="toggle-slider"></span>
							</label>
							<span class="option-description">Play fireworks animation when file is sorted.</span>
						</div>
						<div>
							<span>Laser Cursor</span>
							<label class="toggle-switch" for="custom-cursor">
								<input id="custom-cursor" type="checkbox">
								<span class="toggle-slider"></span>
							</label>
							<span class="option-description">Show a custom cursor as the mouse pointer.</span>
						</div>
					</div>
				</div>
				<div id="about-button" class="button">?</div>
				<div id="sorting-tree-button" class="button"></div>
			</div>
		</div>
	</div>

	<!-- About pop-up -->
	<div id="about-popup" class="">
		<div id="close-about-popup-button"></div>
		<div>
			<div><h1>Multipass External Merge Sort<br/>Algorithm Visualizer</h1></div>
			<div style="opacity: 0.65;"><span><b>2-way Sorting</b> - <b>k-way Sorting</b> - <b>Replacement Selection</b></span></div>
				<div class="instructions">
					<div><h2>Instructions</h2></div>
					<div>
						<div>
							<div class="text-box">1</div>
							<div>Select the <u>algorithm variation</u> from the tabs (at the <b>top left of the screen</b>).<span style="content: ''; display: inline-block; height: 1.2vw; width: 0px;"></span></div>
						</div>
						<div>
							<div class="text-box">2</div>
							<div>Insert the desired values for the <u>selected algorithm's animation</u> in the input fields<span style="content: ''; display: inline-block; height: 1.2vw; width: 0px;"><!-- EMPTY (used to align elements to the line) --></span><br/>
								(at <b>the bottom left of the screen</b>).</div>
						</div>
						<div>
							<div class="text-box">3</div>
							<div>Click on the "play" button <span class="play-pause-icon button-icon"></span> in the controls section to <u>play and pause the animation</u><br/>
								(at <b>the bottom of the screen</b>).</div>
						</div>
						<div>
							<div class="text-box">4</div>
							<div>Use the "step forward" <span class="step-forward-icon button-icon"></span> and "step backwards" <span class="step-backwards-icon button-icon"></span> buttons in the controls section<br/>
								(at <b>the bottom of the screen</b>) to <u>manually play or rewind</u> single steps of the animation.</div>
						</div>
						<div>
							<div class="text-box">5</div>
							<div>Select the animation playback speed with the "speed" button <span class="button-icon">1x</span>.</div>
						</div>
						<div>
							<div class="text-box">6</div>
							<div>Use the restart button <span class="reset-icon button-icon"></span> to restart the animation with new input values.</div>
						</div>
						<div>
							<div class="text-box">7</div>
							<div>Additional information and options are available at the <b>bottom left of the screen</b>.<span style="content: ''; display: inline-block; height: 1.2vw; width: 0px;"></span></div>
						</div>
					</div>
				</div>
				<div class="description">
					<div>
						Developed by <a href="https://github.com/valeriodiste">Valerio Di Stefano</a> - Source code available on <a href="https://github.com/valeriodiste/ExternalMergeSortVisualizer">GitHub</a>
					</div>
					<div>
						Project work of the <a href="https://www.diag.uniroma1.it/~lenzerin/index.html/?q=node/53">Data Management (2022/2023)</a> course
						taught by <a href="https://www.diag.uniroma1.it/~lenzerin/index.html/">Prof. Maurizio Lenzerini</a> 
						<br/>
						(master degree course of <a href="https://corsidilaurea.uniroma1.it/it/corso/2022/30430/home">Engineering in Computer Science</a>
						at <a href="https://www.uniroma1.it/it/">Sapienza University of Rome</a>)
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Sorting tree pop-up -->
	<div id="sorting-tree-popup" class="">
		<div id="close-sorting-tree-popup-button"></div>
		<div>
			<div><h1>Sorting Tree</h1></div>
			<div style="opacity: 0.65;"><span class="sorting-tree-description">Sorting tree of relation R for passes of the [SELECTED ALGORITHM] algorithm.</span></div>
			<div id="sorting-tree-container">
				<!-- Tree passes go here -->
			</div>
		</div>
	</div>

	<!-- Black overlay for windows pop-ups -->
	<div id="black-overlay"></div>

	<!-- JS SCRIPTS -->
	<!-- JQuery Library -->
	<script id="jquery-min-js">
		/*! jQuery v3.7.0 | (c) OpenJS Foundation and other contributors | jquery.org/license */
		!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(ie,e){"use strict";var oe=[],r=Object.getPrototypeOf,ae=oe.slice,g=oe.flat?function(e){return oe.flat.call(e)}:function(e){return oe.concat.apply([],e)},s=oe.push,se=oe.indexOf,n={},i=n.toString,ue=n.hasOwnProperty,o=ue.toString,a=o.call(Object),le={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},y=function(e){return null!=e&&e===e.window},C=ie.document,u={type:!0,src:!0,nonce:!0,noModule:!0};function m(e,t,n){var r,i,o=(n=n||C).createElement("script");if(o.text=e,t)for(r in u)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[i.call(e)]||"object":typeof e}var t="3.7.0",l=/HTML$/i,ce=function(e,t){return new ce.fn.init(e,t)};function c(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}function fe(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}ce.fn=ce.prototype={jquery:t,constructor:ce,length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?ae.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ce.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ce.each(this,e)},map:function(n){return this.pushStack(ce.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(ce.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(ce.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:oe.sort,splice:oe.splice},ce.extend=ce.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||v(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(ce.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||ce.isPlainObject(n)?n:{},i=!1,a[t]=ce.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},ce.extend({expando:"jQuery"+(t+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==i.call(e))&&(!(t=r(e))||"function"==typeof(n=ue.call(t,"constructor")&&t.constructor)&&o.call(n)===a)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){m(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(c(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i)return e.textContent;if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=ce.text(t);return n},makeArray:function(e,t){var n=t||[];return null!=e&&(c(Object(e))?ce.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:se.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!l.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(c(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:le}),"function"==typeof Symbol&&(ce.fn[Symbol.iterator]=oe[Symbol.iterator]),ce.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var pe=oe.pop,de=oe.sort,he=oe.splice,ge="[\\x20\\t\\r\\n\\f]",ve=new RegExp("^"+ge+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ge+"+$","g");ce.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var f=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function p(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}ce.escapeSelector=function(e){return(e+"").replace(f,p)};var ye=C,me=s;!function(){var e,b,w,o,a,T,r,C,d,i,k=me,S=ce.expando,E=0,n=0,s=W(),c=W(),u=W(),h=W(),l=function(e,t){return e===t&&(a=!0),0},f="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",t="(?:\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",p="\\["+ge+"*("+t+")(?:"+ge+"*([*^$|!~]?=)"+ge+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+t+"))|)"+ge+"*\\]",g=":("+t+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+p+")*)|.*)\\)|)",v=new RegExp(ge+"+","g"),y=new RegExp("^"+ge+"*,"+ge+"*"),m=new RegExp("^"+ge+"*([>+~]|"+ge+")"+ge+"*"),x=new RegExp(ge+"|>"),j=new RegExp(g),A=new RegExp("^"+t+"$"),D={ID:new RegExp("^#("+t+")"),CLASS:new RegExp("^\\.("+t+")"),TAG:new RegExp("^("+t+"|[*])"),ATTR:new RegExp("^"+p),PSEUDO:new RegExp("^"+g),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ge+"*(even|odd|(([+-]|)(\\d*)n|)"+ge+"*(?:([+-]|)"+ge+"*(\\d+)|))"+ge+"*\\)|)","i"),bool:new RegExp("^(?:"+f+")$","i"),needsContext:new RegExp("^"+ge+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ge+"*((?:-\\d)?\\d*)"+ge+"*\\)|)(?=[^-]|$)","i")},N=/^(?:input|select|textarea|button)$/i,q=/^h\d$/i,L=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,H=/[+~]/,O=new RegExp("\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\([^\\r\\n\\f])","g"),P=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},R=function(){V()},M=J(function(e){return!0===e.disabled&&fe(e,"fieldset")},{dir:"parentNode",next:"legend"});try{k.apply(oe=ae.call(ye.childNodes),ye.childNodes),oe[ye.childNodes.length].nodeType}catch(e){k={apply:function(e,t){me.apply(e,ae.call(t))},call:function(e){me.apply(e,ae.call(arguments,1))}}}function I(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(V(e),e=e||T,C)){if(11!==p&&(u=L.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return k.call(n,a),n}else if(f&&(a=f.getElementById(i))&&I.contains(e,a)&&a.id===i)return k.call(n,a),n}else{if(u[2])return k.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&e.getElementsByClassName)return k.apply(n,e.getElementsByClassName(i)),n}if(!(h[t+" "]||d&&d.test(t))){if(c=t,f=e,1===p&&(x.test(t)||m.test(t))){(f=H.test(t)&&z(e.parentNode)||e)==e&&le.scope||((s=e.getAttribute("id"))?s=ce.escapeSelector(s):e.setAttribute("id",s=S)),o=(l=Y(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+Q(l[o]);c=l.join(",")}try{return k.apply(n,f.querySelectorAll(c)),n}catch(e){h(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return re(t.replace(ve,"$1"),e,n,r)}function W(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function F(e){return e[S]=!0,e}function $(e){var t=T.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function B(t){return function(e){return fe(e,"input")&&e.type===t}}function _(t){return function(e){return(fe(e,"input")||fe(e,"button"))&&e.type===t}}function X(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&M(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function U(a){return F(function(o){return o=+o,F(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function z(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function V(e){var t,n=e?e.ownerDocument||e:ye;return n!=T&&9===n.nodeType&&n.documentElement&&(r=(T=n).documentElement,C=!ce.isXMLDoc(T),i=r.matches||r.webkitMatchesSelector||r.msMatchesSelector,ye!=T&&(t=T.defaultView)&&t.top!==t&&t.addEventListener("unload",R),le.getById=$(function(e){return r.appendChild(e).id=ce.expando,!T.getElementsByName||!T.getElementsByName(ce.expando).length}),le.disconnectedMatch=$(function(e){return i.call(e,"*")}),le.scope=$(function(){return T.querySelectorAll(":scope")}),le.cssHas=$(function(){try{return T.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}}),le.getById?(b.filter.ID=function(e){var t=e.replace(O,P);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(O,P);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},b.find.CLASS=function(e,t){if("undefined"!=typeof t.getElementsByClassName&&C)return t.getElementsByClassName(e)},d=[],$(function(e){var t;r.appendChild(e).innerHTML="<a id='"+S+"' href='' disabled='disabled'></a><select id='"+S+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+ge+"*(?:value|"+f+")"),e.querySelectorAll("[id~="+S+"-]").length||d.push("~="),e.querySelectorAll("a#"+S+"+*").length||d.push(".#.+[+~]"),e.querySelectorAll(":checked").length||d.push(":checked"),(t=T.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),r.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(t=T.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||d.push("\\["+ge+"*name"+ge+"*="+ge+"*(?:''|\"\")")}),le.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),l=function(e,t){if(e===t)return a=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!le.sortDetached&&t.compareDocumentPosition(e)===n?e===T||e.ownerDocument==ye&&I.contains(ye,e)?-1:t===T||t.ownerDocument==ye&&I.contains(ye,t)?1:o?se.call(o,e)-se.call(o,t):0:4&n?-1:1)}),T}for(e in I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(V(e),C&&!h[t+" "]&&(!d||!d.test(t)))try{var n=i.call(e,t);if(n||le.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){h(t,!0)}return 0<I(t,T,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=T&&V(e),ce.contains(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=T&&V(e);var n=b.attrHandle[t.toLowerCase()],r=n&&ue.call(b.attrHandle,t.toLowerCase())?n(e,t,!C):void 0;return void 0!==r?r:e.getAttribute(t)},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ce.uniqueSort=function(e){var t,n=[],r=0,i=0;if(a=!le.sortStable,o=!le.sortStable&&ae.call(e,0),de.call(e,l),a){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)he.call(e,n[r],1)}return o=null,e},ce.fn.uniqueSort=function(){return this.pushStack(ce.uniqueSort(ae.apply(this)))},(b=ce.expr={cacheLength:50,createPseudo:F,match:D,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(O,P),e[3]=(e[3]||e[4]||e[5]||"").replace(O,P),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return D.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&j.test(n)&&(t=Y(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(O,P).toLowerCase();return"*"===e?function(){return!0}:function(e){return fe(e,t)}},CLASS:function(e){var t=s[e+" "];return t||(t=new RegExp("(^|"+ge+")"+e+"("+ge+"|$)"))&&s(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=I.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(v," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(d,e,t,h,g){var v="nth"!==d.slice(0,3),y="last"!==d.slice(-4),m="of-type"===e;return 1===h&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u=v!==y?"nextSibling":"previousSibling",l=e.parentNode,c=m&&e.nodeName.toLowerCase(),f=!n&&!m,p=!1;if(l){if(v){while(u){o=e;while(o=o[u])if(m?fe(o,c):1===o.nodeType)return!1;s=u="only"===d&&!s&&"nextSibling"}return!0}if(s=[y?l.firstChild:l.lastChild],y&&f){p=(a=(r=(i=l[S]||(l[S]={}))[d]||[])[0]===E&&r[1])&&r[2],o=a&&l.childNodes[a];while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if(1===o.nodeType&&++p&&o===e){i[d]=[E,a,p];break}}else if(f&&(p=a=(r=(i=e[S]||(e[S]={}))[d]||[])[0]===E&&r[1]),!1===p)while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if((m?fe(o,c):1===o.nodeType)&&++p&&(f&&((i=o[S]||(o[S]={}))[d]=[E,p]),o===e))break;return(p-=g)===h||p%h==0&&0<=p/h}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||I.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?F(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=se.call(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:F(function(e){var r=[],i=[],s=ne(e.replace(ve,"$1"));return s[S]?F(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:F(function(t){return function(e){return 0<I(t,e).length}}),contains:F(function(t){return t=t.replace(O,P),function(e){return-1<(e.textContent||ce.text(e)).indexOf(t)}}),lang:F(function(n){return A.test(n||"")||I.error("unsupported lang: "+n),n=n.replace(O,P).toLowerCase(),function(e){var t;do{if(t=C?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=ie.location&&ie.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===r},focus:function(e){return e===function(){try{return T.activeElement}catch(e){}}()&&T.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:X(!1),disabled:X(!0),checked:function(e){return fe(e,"input")&&!!e.checked||fe(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return q.test(e.nodeName)},input:function(e){return N.test(e.nodeName)},button:function(e){return fe(e,"input")&&"button"===e.type||fe(e,"button")},text:function(e){var t;return fe(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:U(function(){return[0]}),last:U(function(e,t){return[t-1]}),eq:U(function(e,t,n){return[n<0?n+t:n]}),even:U(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:U(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:U(function(e,t,n){var r;for(r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:U(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=B(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=_(e);function G(){}function Y(e,t){var n,r,i,o,a,s,u,l=c[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=y.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=m.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(ve," ")}),a=a.slice(n.length)),b.filter)!(r=D[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?I.error(e):c(e,s).slice(0)}function Q(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function J(a,e,t){var s=e.dir,u=e.next,l=u||s,c=t&&"parentNode"===l,f=n++;return e.first?function(e,t,n){while(e=e[s])if(1===e.nodeType||c)return a(e,t,n);return!1}:function(e,t,n){var r,i,o=[E,f];if(n){while(e=e[s])if((1===e.nodeType||c)&&a(e,t,n))return!0}else while(e=e[s])if(1===e.nodeType||c)if(i=e[S]||(e[S]={}),u&&fe(e,u))e=e[s]||e;else{if((r=i[l])&&r[0]===E&&r[1]===f)return o[2]=r[2];if((i[l]=o)[2]=a(e,t,n))return!0}return!1}}function K(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Z(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function ee(d,h,g,v,y,e){return v&&!v[S]&&(v=ee(v)),y&&!y[S]&&(y=ee(y,e)),F(function(e,t,n,r){var i,o,a,s,u=[],l=[],c=t.length,f=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)I(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),p=!d||!e&&h?f:Z(f,u,d,n,r);if(g?g(p,s=y||(e?d:c||v)?[]:t,n,r):s=p,v){i=Z(s,l),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(s[l[o]]=!(p[l[o]]=a))}if(e){if(y||d){if(y){i=[],o=s.length;while(o--)(a=s[o])&&i.push(p[o]=a);y(null,s=[],i,r)}o=s.length;while(o--)(a=s[o])&&-1<(i=y?se.call(e,a):u[o])&&(e[i]=!(t[i]=a))}}else s=Z(s===t?s.splice(c,s.length):s),y?y(null,t,s,r):k.apply(t,s)})}function te(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=J(function(e){return e===i},a,!0),l=J(function(e){return-1<se.call(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!=w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[J(K(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return ee(1<s&&K(c),1<s&&Q(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(ve,"$1"),t,s<n&&te(e.slice(s,n)),n<r&&te(e=e.slice(n)),n<r&&Q(e))}c.push(t)}return K(c)}function ne(e,t){var n,v,y,m,x,r,i=[],o=[],a=u[e+" "];if(!a){t||(t=Y(e)),n=t.length;while(n--)(a=te(t[n]))[S]?i.push(a):o.push(a);(a=u(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=E+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==T||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==T||(V(o),n=!C);while(s=v[a++])if(s(o,t||T,n)){k.call(r,o);break}i&&(E=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=pe.call(r));f=Z(f)}k.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&ce.uniqueSort(r)}return i&&(E=h,w=p),c},m?F(r):r))).selector=e}return a}function re(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&Y(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&C&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(O,P),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=D.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(O,P),H.test(o[0].type)&&z(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&Q(o)))return k.apply(n,r),n;break}}}return(l||ne(e,c))(r,t,!C,n,!t||H.test(e)&&z(t.parentNode)||t),n}G.prototype=b.filters=b.pseudos,b.setFilters=new G,le.sortStable=S.split("").sort(l).join("")===S,V(),le.sortDetached=$(function(e){return 1&e.compareDocumentPosition(T.createElement("fieldset"))}),ce.find=I,ce.expr[":"]=ce.expr.pseudos,ce.unique=ce.uniqueSort,I.compile=ne,I.select=re,I.setDocument=V,I.escape=ce.escapeSelector,I.getText=ce.text,I.isXML=ce.isXMLDoc,I.selectors=ce.expr,I.support=ce.support,I.uniqueSort=ce.uniqueSort}();var d=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&ce(e).is(n))break;r.push(e)}return r},h=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},b=ce.expr.match.needsContext,w=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function T(e,n,r){return v(n)?ce.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?ce.grep(e,function(e){return e===n!==r}):"string"!=typeof n?ce.grep(e,function(e){return-1<se.call(n,e)!==r}):ce.filter(n,e,r)}ce.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ce.find.matchesSelector(r,e)?[r]:[]:ce.find.matches(e,ce.grep(t,function(e){return 1===e.nodeType}))},ce.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(ce(e).filter(function(){for(t=0;t<r;t++)if(ce.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)ce.find(e,i[t],n);return 1<r?ce.uniqueSort(n):n},filter:function(e){return this.pushStack(T(this,e||[],!1))},not:function(e){return this.pushStack(T(this,e||[],!0))},is:function(e){return!!T(this,"string"==typeof e&&b.test(e)?ce(e):e||[],!1).length}});var k,S=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(ce.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||k,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:S.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ce?t[0]:t,ce.merge(this,ce.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:C,!0)),w.test(r[1])&&ce.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=C.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(ce):ce.makeArray(e,this)}).prototype=ce.fn,k=ce(C);var E=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function A(e,t){while((e=e[t])&&1!==e.nodeType);return e}ce.fn.extend({has:function(e){var t=ce(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ce.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&ce(e);if(!b.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&ce.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?ce.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?se.call(ce(e),this[0]):se.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ce.uniqueSort(ce.merge(this.get(),ce(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ce.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return d(e,"parentNode")},parentsUntil:function(e,t,n){return d(e,"parentNode",n)},next:function(e){return A(e,"nextSibling")},prev:function(e){return A(e,"previousSibling")},nextAll:function(e){return d(e,"nextSibling")},prevAll:function(e){return d(e,"previousSibling")},nextUntil:function(e,t,n){return d(e,"nextSibling",n)},prevUntil:function(e,t,n){return d(e,"previousSibling",n)},siblings:function(e){return h((e.parentNode||{}).firstChild,e)},children:function(e){return h(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(fe(e,"template")&&(e=e.content||e),ce.merge([],e.childNodes))}},function(r,i){ce.fn[r]=function(e,t){var n=ce.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=ce.filter(t,n)),1<this.length&&(j[r]||ce.uniqueSort(n),E.test(r)&&n.reverse()),this.pushStack(n)}});var D=/[^\x20\t\r\n\f]+/g;function N(e){return e}function q(e){throw e}function L(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}ce.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},ce.each(e.match(D)||[],function(e,t){n[t]=!0}),n):ce.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){ce.each(e,function(e,t){v(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==x(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return ce.each(arguments,function(e,t){var n;while(-1<(n=ce.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<ce.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},ce.extend({Deferred:function(e){var o=[["notify","progress",ce.Callbacks("memory"),ce.Callbacks("memory"),2],["resolve","done",ce.Callbacks("once memory"),ce.Callbacks("once memory"),0,"resolved"],["reject","fail",ce.Callbacks("once memory"),ce.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return ce.Deferred(function(r){ce.each(o,function(e,t){var n=v(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,v(t)?s?t.call(e,l(u,o,N,s),l(u,o,q,s)):(u++,t.call(e,l(u,o,N,s),l(u,o,q,s),l(u,o,N,o.notifyWith))):(a!==N&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){ce.Deferred.exceptionHook&&ce.Deferred.exceptionHook(e,t.error),u<=i+1&&(a!==q&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(ce.Deferred.getErrorHook?t.error=ce.Deferred.getErrorHook():ce.Deferred.getStackHook&&(t.error=ce.Deferred.getStackHook()),ie.setTimeout(t))}}return ce.Deferred(function(e){o[0][3].add(l(0,e,v(r)?r:N,e.notifyWith)),o[1][3].add(l(0,e,v(t)?t:N)),o[2][3].add(l(0,e,v(n)?n:q))}).promise()},promise:function(e){return null!=e?ce.extend(e,a):a}},s={};return ce.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=ae.call(arguments),o=ce.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?ae.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(L(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||v(i[t]&&i[t].then)))return o.then();while(t--)L(i[t],a(t),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ce.Deferred.exceptionHook=function(e,t){ie.console&&ie.console.warn&&e&&H.test(e.name)&&ie.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},ce.readyException=function(e){ie.setTimeout(function(){throw e})};var O=ce.Deferred();function P(){C.removeEventListener("DOMContentLoaded",P),ie.removeEventListener("load",P),ce.ready()}ce.fn.ready=function(e){return O.then(e)["catch"](function(e){ce.readyException(e)}),this},ce.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ce.readyWait:ce.isReady)||(ce.isReady=!0)!==e&&0<--ce.readyWait||O.resolveWith(C,[ce])}}),ce.ready.then=O.then,"complete"===C.readyState||"loading"!==C.readyState&&!C.documentElement.doScroll?ie.setTimeout(ce.ready):(C.addEventListener("DOMContentLoaded",P),ie.addEventListener("load",P));var R=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n))for(s in i=!0,n)R(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,v(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(ce(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},M=/^-ms-/,I=/-([a-z])/g;function W(e,t){return t.toUpperCase()}function F(e){return e.replace(M,"ms-").replace(I,W)}var $=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function B(){this.expando=ce.expando+B.uid++}B.uid=1,B.prototype={cache:function(e){var t=e[this.expando];return t||(t={},$(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[F(t)]=n;else for(r in t)i[F(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][F(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(F):(t=F(t))in r?[t]:t.match(D)||[]).length;while(n--)delete r[t[n]]}(void 0===t||ce.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ce.isEmptyObject(t)}};var _=new B,X=new B,U=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,z=/[A-Z]/g;function V(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(z,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:U.test(i)?JSON.parse(i):i)}catch(e){}X.set(e,t,n)}else n=void 0;return n}ce.extend({hasData:function(e){return X.hasData(e)||_.hasData(e)},data:function(e,t,n){return X.access(e,t,n)},removeData:function(e,t){X.remove(e,t)},_data:function(e,t,n){return _.access(e,t,n)},_removeData:function(e,t){_.remove(e,t)}}),ce.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=X.get(o),1===o.nodeType&&!_.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=F(r.slice(5)),V(o,r,i[r]));_.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){X.set(this,n)}):R(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=X.get(o,n))?t:void 0!==(t=V(o,n))?t:void 0;this.each(function(){X.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){X.remove(this,e)})}}),ce.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=_.get(e,t),n&&(!r||Array.isArray(n)?r=_.access(e,t,ce.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=ce.queue(e,t),r=n.length,i=n.shift(),o=ce._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){ce.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return _.get(e,n)||_.access(e,n,{empty:ce.Callbacks("once memory").add(function(){_.remove(e,[t+"queue",n])})})}}),ce.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?ce.queue(this[0],t):void 0===n?this:this.each(function(){var e=ce.queue(this,t,n);ce._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&ce.dequeue(this,t)})},dequeue:function(e){return this.each(function(){ce.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=ce.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=_.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var G=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Y=new RegExp("^(?:([+-])=|)("+G+")([a-z%]*)$","i"),Q=["Top","Right","Bottom","Left"],J=C.documentElement,K=function(e){return ce.contains(e.ownerDocument,e)},Z={composed:!0};J.getRootNode&&(K=function(e){return ce.contains(e.ownerDocument,e)||e.getRootNode(Z)===e.ownerDocument});var ee=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&K(e)&&"none"===ce.css(e,"display")};function te(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return ce.css(e,t,"")},u=s(),l=n&&n[3]||(ce.cssNumber[t]?"":"px"),c=e.nodeType&&(ce.cssNumber[t]||"px"!==l&&+u)&&Y.exec(ce.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)ce.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,ce.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ne={};function re(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=_.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ee(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ne[s])||(o=a.body.appendChild(a.createElement(s)),u=ce.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ne[s]=u)))):"none"!==n&&(l[c]="none",_.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}ce.fn.extend({show:function(){return re(this,!0)},hide:function(){return re(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ee(this)?ce(this).show():ce(this).hide()})}});var xe,be,we=/^(?:checkbox|radio)$/i,Te=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ce=/^$|^module$|\/(?:java|ecma)script/i;xe=C.createDocumentFragment().appendChild(C.createElement("div")),(be=C.createElement("input")).setAttribute("type","radio"),be.setAttribute("checked","checked"),be.setAttribute("name","t"),xe.appendChild(be),le.checkClone=xe.cloneNode(!0).cloneNode(!0).lastChild.checked,xe.innerHTML="<textarea>x</textarea>",le.noCloneChecked=!!xe.cloneNode(!0).lastChild.defaultValue,xe.innerHTML="<option></option>",le.option=!!xe.lastChild;var ke={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Se(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&fe(e,t)?ce.merge([e],n):n}function Ee(e,t){for(var n=0,r=e.length;n<r;n++)_.set(e[n],"globalEval",!t||_.get(t[n],"globalEval"))}ke.tbody=ke.tfoot=ke.colgroup=ke.caption=ke.thead,ke.th=ke.td,le.option||(ke.optgroup=ke.option=[1,"<select multiple='multiple'>","</select>"]);var je=/<|&#?\w+;/;function Ae(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===x(o))ce.merge(p,o.nodeType?[o]:o);else if(je.test(o)){a=a||f.appendChild(t.createElement("div")),s=(Te.exec(o)||["",""])[1].toLowerCase(),u=ke[s]||ke._default,a.innerHTML=u[1]+ce.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;ce.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<ce.inArray(o,r))i&&i.push(o);else if(l=K(o),a=Se(f.appendChild(o),"script"),l&&Ee(a),n){c=0;while(o=a[c++])Ce.test(o.type||"")&&n.push(o)}return f}var De=/^([^.]*)(?:\.(.+)|)/;function Ne(){return!0}function qe(){return!1}function Le(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Le(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=qe;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return ce().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=ce.guid++)),e.each(function(){ce.event.add(this,t,i,r,n)})}function He(e,r,t){t?(_.set(e,r,!1),ce.event.add(e,r,{namespace:!1,handler:function(e){var t,n=_.get(this,r);if(1&e.isTrigger&&this[r]){if(n)(ce.event.special[r]||{}).delegateType&&e.stopPropagation();else if(n=ae.call(arguments),_.set(this,r,n),this[r](),t=_.get(this,r),_.set(this,r,!1),n!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else n&&(_.set(this,r,ce.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ne)}})):void 0===_.get(e,r)&&ce.event.add(e,r,Ne)}ce.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.get(t);if($(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&ce.find.matchesSelector(J,i),n.guid||(n.guid=ce.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof ce&&ce.event.triggered!==e.type?ce.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(D)||[""]).length;while(l--)d=g=(s=De.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=ce.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=ce.event.special[d]||{},c=ce.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ce.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),ce.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.hasData(e)&&_.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(D)||[""]).length;while(l--)if(d=g=(s=De.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=ce.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||ce.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)ce.event.remove(e,d+t[l],n,r,!0);ce.isEmptyObject(u)&&_.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=ce.event.fix(e),l=(_.get(this,"events")||Object.create(null))[u.type]||[],c=ce.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=ce.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((ce.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<ce(i,this).index(l):ce.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(ce.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[ce.expando]?e:new ce.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,"input")&&He(t,"click",!0),!1},trigger:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,"input")&&He(t,"click"),!0},_default:function(e){var t=e.target;return we.test(t.type)&&t.click&&fe(t,"input")&&_.get(t,"click")||fe(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ce.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ce.Event=function(e,t){if(!(this instanceof ce.Event))return new ce.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ne:qe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ce.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[ce.expando]=!0},ce.Event.prototype={constructor:ce.Event,isDefaultPrevented:qe,isPropagationStopped:qe,isImmediatePropagationStopped:qe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ne,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ne,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ne,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ce.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},ce.event.addProp),ce.each({focus:"focusin",blur:"focusout"},function(r,i){function o(e){if(C.documentMode){var t=_.get(this,"handle"),n=ce.event.fix(e);n.type="focusin"===e.type?"focus":"blur",n.isSimulated=!0,t(e),n.target===n.currentTarget&&t(n)}else ce.event.simulate(i,e.target,ce.event.fix(e))}ce.event.special[r]={setup:function(){var e;if(He(this,r,!0),!C.documentMode)return!1;(e=_.get(this,i))||this.addEventListener(i,o),_.set(this,i,(e||0)+1)},trigger:function(){return He(this,r),!0},teardown:function(){var e;if(!C.documentMode)return!1;(e=_.get(this,i)-1)?_.set(this,i,e):(this.removeEventListener(i,o),_.remove(this,i))},_default:function(e){return _.get(e.target,r)},delegateType:i},ce.event.special[i]={setup:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i);n||(C.documentMode?this.addEventListener(i,o):e.addEventListener(r,o,!0)),_.set(t,i,(n||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i)-1;n?_.set(t,i,n):(C.documentMode?this.removeEventListener(i,o):e.removeEventListener(r,o,!0),_.remove(t,i))}}}),ce.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){ce.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||ce.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),ce.fn.extend({on:function(e,t,n,r){return Le(this,e,t,n,r)},one:function(e,t,n,r){return Le(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ce(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=qe),this.each(function(){ce.event.remove(this,e,n,t)})}});var Oe=/<script|<style|<link/i,Pe=/checked\s*(?:[^=]|=\s*.checked.)/i,Re=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Me(e,t){return fe(e,"table")&&fe(11!==t.nodeType?t:t.firstChild,"tr")&&ce(e).children("tbody")[0]||e}function Ie(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function We(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Fe(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(_.hasData(e)&&(s=_.get(e).events))for(i in _.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)ce.event.add(t,i,s[i][n]);X.hasData(e)&&(o=X.access(e),a=ce.extend({},o),X.set(t,a))}}function $e(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=v(d);if(h||1<f&&"string"==typeof d&&!le.checkClone&&Pe.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),$e(t,r,i,o)});if(f&&(t=(e=Ae(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=ce.map(Se(e,"script"),Ie)).length;c<f;c++)u=e,c!==p&&(u=ce.clone(u,!0,!0),s&&ce.merge(a,Se(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,ce.map(a,We),c=0;c<s;c++)u=a[c],Ce.test(u.type||"")&&!_.access(u,"globalEval")&&ce.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?ce._evalUrl&&!u.noModule&&ce._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):m(u.textContent.replace(Re,""),u,l))}return n}function Be(e,t,n){for(var r,i=t?ce.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ce.cleanData(Se(r)),r.parentNode&&(n&&K(r)&&Ee(Se(r,"script")),r.parentNode.removeChild(r));return e}ce.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=K(e);if(!(le.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ce.isXMLDoc(e)))for(a=Se(c),r=0,i=(o=Se(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&we.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||Se(e),a=a||Se(c),r=0,i=o.length;r<i;r++)Fe(o[r],a[r]);else Fe(e,c);return 0<(a=Se(c,"script")).length&&Ee(a,!f&&Se(e,"script")),c},cleanData:function(e){for(var t,n,r,i=ce.event.special,o=0;void 0!==(n=e[o]);o++)if($(n)){if(t=n[_.expando]){if(t.events)for(r in t.events)i[r]?ce.event.remove(n,r):ce.removeEvent(n,r,t.handle);n[_.expando]=void 0}n[X.expando]&&(n[X.expando]=void 0)}}}),ce.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return R(this,function(e){return void 0===e?ce.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return $e(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Me(this,e).appendChild(e)})},prepend:function(){return $e(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Me(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ce.cleanData(Se(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ce.clone(this,e,t)})},html:function(e){return R(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Oe.test(e)&&!ke[(Te.exec(e)||["",""])[1].toLowerCase()]){e=ce.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(ce.cleanData(Se(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return $e(this,arguments,function(e){var t=this.parentNode;ce.inArray(this,n)<0&&(ce.cleanData(Se(this)),t&&t.replaceChild(e,this))},n)}}),ce.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){ce.fn[e]=function(e){for(var t,n=[],r=ce(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),ce(r[o])[a](t),s.apply(n,t.get());return this.pushStack(n)}});var _e=new RegExp("^("+G+")(?!px)[a-z%]+$","i"),Xe=/^--/,Ue=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=ie),t.getComputedStyle(e)},ze=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ve=new RegExp(Q.join("|"),"i");function Ge(e,t,n){var r,i,o,a,s=Xe.test(t),u=e.style;return(n=n||Ue(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace(ve,"$1")||void 0),""!==a||K(e)||(a=ce.style(e,t)),!le.pixelBoxStyles()&&_e.test(a)&&Ve.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+"":a}function Ye(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",J.appendChild(u).appendChild(l);var e=ie.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),J.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=C.createElement("div"),l=C.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",le.clearCloneStyle="content-box"===l.style.backgroundClip,ce.extend(le,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=C.createElement("table"),t=C.createElement("tr"),n=C.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",J.appendChild(e).appendChild(t).appendChild(n),r=ie.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,J.removeChild(e)),a}}))}();var Qe=["Webkit","Moz","ms"],Je=C.createElement("div").style,Ke={};function Ze(e){var t=ce.cssProps[e]||Ke[e];return t||(e in Je?e:Ke[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Qe.length;while(n--)if((e=Qe[n]+t)in Je)return e}(e)||e)}var et=/^(none|table(?!-c[ea]).+)/,tt={position:"absolute",visibility:"hidden",display:"block"},nt={letterSpacing:"0",fontWeight:"400"};function rt(e,t,n){var r=Y.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function it(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0,l=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=ce.css(e,n+Q[a],!0,i)),r?("content"===n&&(u-=ce.css(e,"padding"+Q[a],!0,i)),"margin"!==n&&(u-=ce.css(e,"border"+Q[a]+"Width",!0,i))):(u+=ce.css(e,"padding"+Q[a],!0,i),"padding"!==n?u+=ce.css(e,"border"+Q[a]+"Width",!0,i):s+=ce.css(e,"border"+Q[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u+l}function ot(e,t,n){var r=Ue(e),i=(!le.boxSizingReliable()||n)&&"border-box"===ce.css(e,"boxSizing",!1,r),o=i,a=Ge(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(_e.test(a)){if(!n)return a;a="auto"}return(!le.boxSizingReliable()&&i||!le.reliableTrDimensions()&&fe(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===ce.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===ce.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+it(e,t,n||(i?"border":"content"),o,r,a)+"px"}function at(e,t,n,r,i){return new at.prototype.init(e,t,n,r,i)}ce.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=F(t),u=Xe.test(t),l=e.style;if(u||(t=Ze(s)),a=ce.cssHooks[t]||ce.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=Y.exec(n))&&i[1]&&(n=te(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(ce.cssNumber[s]?"":"px")),le.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=F(t);return Xe.test(t)||(t=Ze(s)),(a=ce.cssHooks[t]||ce.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Ge(e,t,r)),"normal"===i&&t in nt&&(i=nt[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),ce.each(["height","width"],function(e,u){ce.cssHooks[u]={get:function(e,t,n){if(t)return!et.test(ce.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ot(e,u,n):ze(e,tt,function(){return ot(e,u,n)})},set:function(e,t,n){var r,i=Ue(e),o=!le.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===ce.css(e,"boxSizing",!1,i),s=n?it(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-it(e,u,"border",!1,i)-.5)),s&&(r=Y.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=ce.css(e,u)),rt(0,t,s)}}}),ce.cssHooks.marginLeft=Ye(le.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ge(e,"marginLeft"))||e.getBoundingClientRect().left-ze(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ce.each({margin:"",padding:"",border:"Width"},function(i,o){ce.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+Q[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(ce.cssHooks[i+o].set=rt)}),ce.fn.extend({css:function(e,t){return R(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Ue(e),i=t.length;a<i;a++)o[t[a]]=ce.css(e,t[a],!1,r);return o}return void 0!==n?ce.style(e,t,n):ce.css(e,t)},e,t,1<arguments.length)}}),((ce.Tween=at).prototype={constructor:at,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||ce.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ce.cssNumber[n]?"":"px")},cur:function(){var e=at.propHooks[this.prop];return e&&e.get?e.get(this):at.propHooks._default.get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.options.duration?this.pos=t=ce.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):at.propHooks._default.set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ce.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){ce.fx.step[e.prop]?ce.fx.step[e.prop](e):1!==e.elem.nodeType||!ce.cssHooks[e.prop]&&null==e.elem.style[Ze(e.prop)]?e.elem[e.prop]=e.now:ce.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ce.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},ce.fx=at.prototype.init,ce.fx.step={};var st,ut,lt,ct,ft=/^(?:toggle|show|hide)$/,pt=/queueHooks$/;function dt(){ut&&(!1===C.hidden&&ie.requestAnimationFrame?ie.requestAnimationFrame(dt):ie.setTimeout(dt,ce.fx.interval),ce.fx.tick())}function ht(){return ie.setTimeout(function(){st=void 0}),st=Date.now()}function gt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=Q[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function vt(e,t,n){for(var r,i=(yt.tweeners[t]||[]).concat(yt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function yt(o,e,t){var n,a,r=0,i=yt.prefilters.length,s=ce.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=st||ht(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:ce.extend({},e),opts:ce.extend(!0,{specialEasing:{},easing:ce.easing._default},t),originalProperties:e,originalOptions:t,startTime:st||ht(),duration:t.duration,tweens:[],createTween:function(e,t){var n=ce.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=F(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=ce.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=yt.prefilters[r].call(l,o,c,l.opts))return v(n.stop)&&(ce._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return ce.map(c,vt,l),v(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),ce.fx.timer(ce.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}ce.Animation=ce.extend(yt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return te(n.elem,e,Y.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(D);for(var n,r=0,i=e.length;r<i;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ee(e),v=_.get(e,"fxshow");for(r in n.queue||(null==(a=ce._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,ce.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],ft.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||ce.style(e,r)}if((u=!ce.isEmptyObject(t))||!ce.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=_.get(e,"display")),"none"===(c=ce.css(e,"display"))&&(l?c=l:(re([e],!0),l=e.style.display||l,c=ce.css(e,"display"),re([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===ce.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=_.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&re([e],!0),p.done(function(){for(r in g||re([e]),_.remove(e,"fxshow"),d)ce.style(e,r,d[r])})),u=vt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),ce.speed=function(e,t,n){var r=e&&"object"==typeof e?ce.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return ce.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in ce.fx.speeds?r.duration=ce.fx.speeds[r.duration]:r.duration=ce.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&ce.dequeue(this,r.queue)},r},ce.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ee).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=ce.isEmptyObject(t),o=ce.speed(e,n,r),a=function(){var e=yt(this,ce.extend({},t),o);(i||_.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=ce.timers,r=_.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&pt.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||ce.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=_.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=ce.timers,o=n?n.length:0;for(t.finish=!0,ce.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),ce.each(["toggle","show","hide"],function(e,r){var i=ce.fn[r];ce.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(gt(r,!0),e,t,n)}}),ce.each({slideDown:gt("show"),slideUp:gt("hide"),slideToggle:gt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){ce.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),ce.timers=[],ce.fx.tick=function(){var e,t=0,n=ce.timers;for(st=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||ce.fx.stop(),st=void 0},ce.fx.timer=function(e){ce.timers.push(e),ce.fx.start()},ce.fx.interval=13,ce.fx.start=function(){ut||(ut=!0,dt())},ce.fx.stop=function(){ut=null},ce.fx.speeds={slow:600,fast:200,_default:400},ce.fn.delay=function(r,e){return r=ce.fx&&ce.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=ie.setTimeout(e,r);t.stop=function(){ie.clearTimeout(n)}})},lt=C.createElement("input"),ct=C.createElement("select").appendChild(C.createElement("option")),lt.type="checkbox",le.checkOn=""!==lt.value,le.optSelected=ct.selected,(lt=C.createElement("input")).value="t",lt.type="radio",le.radioValue="t"===lt.value;var mt,xt=ce.expr.attrHandle;ce.fn.extend({attr:function(e,t){return R(this,ce.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){ce.removeAttr(this,e)})}}),ce.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?ce.prop(e,t,n):(1===o&&ce.isXMLDoc(e)||(i=ce.attrHooks[t.toLowerCase()]||(ce.expr.match.bool.test(t)?mt:void 0)),void 0!==n?null===n?void ce.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=ce.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!le.radioValue&&"radio"===t&&fe(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(D);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),mt={set:function(e,t,n){return!1===t?ce.removeAttr(e,n):e.setAttribute(n,n),n}},ce.each(ce.expr.match.bool.source.match(/\w+/g),function(e,t){var a=xt[t]||ce.find.attr;xt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=xt[o],xt[o]=r,r=null!=a(e,t,n)?o:null,xt[o]=i),r}});var bt=/^(?:input|select|textarea|button)$/i,wt=/^(?:a|area)$/i;function Tt(e){return(e.match(D)||[]).join(" ")}function Ct(e){return e.getAttribute&&e.getAttribute("class")||""}function kt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(D)||[]}ce.fn.extend({prop:function(e,t){return R(this,ce.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[ce.propFix[e]||e]})}}),ce.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ce.isXMLDoc(e)||(t=ce.propFix[t]||t,i=ce.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ce.find.attr(e,"tabindex");return t?parseInt(t,10):bt.test(e.nodeName)||wt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),le.optSelected||(ce.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ce.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ce.propFix[this.toLowerCase()]=this}),ce.fn.extend({addClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).addClass(t.call(this,e,Ct(this)))}):(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&" "+Tt(r)+" "){for(o=0;o<e.length;o++)i=e[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ");a=Tt(n),r!==a&&this.setAttribute("class",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).removeClass(t.call(this,e,Ct(this)))}):arguments.length?(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&" "+Tt(r)+" "){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(" "+i+" "))n=n.replace(" "+i+" "," ")}a=Tt(n),r!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s="string"===a||Array.isArray(t);return v(t)?this.each(function(e){ce(this).toggleClass(t.call(this,e,Ct(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=kt(t),this.each(function(){if(s)for(o=ce(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&"boolean"!==a||((r=Ct(this))&&_.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":_.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+Tt(Ct(n))+" ").indexOf(t))return!0;return!1}});var St=/\r/g;ce.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=v(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,ce(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=ce.map(t,function(e){return null==e?"":e+""})),(r=ce.valHooks[this.type]||ce.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=ce.valHooks[t.type]||ce.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(St,""):null==e?"":e:void 0}}),ce.extend({valHooks:{option:{get:function(e){var t=ce.find.attr(e,"value");return null!=t?t:Tt(ce.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!fe(n.parentNode,"optgroup"))){if(t=ce(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=ce.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<ce.inArray(ce.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ce.each(["radio","checkbox"],function(){ce.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<ce.inArray(ce(e).val(),t)}},le.checkOn||(ce.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Et=ie.location,jt={guid:Date.now()},At=/\?/;ce.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new ie.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||ce.error("Invalid XML: "+(n?ce.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Dt=/^(?:focusinfocus|focusoutblur)$/,Nt=function(e){e.stopPropagation()};ce.extend(ce.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||C],d=ue.call(e,"type")?e.type:e,h=ue.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||C,3!==n.nodeType&&8!==n.nodeType&&!Dt.test(d+ce.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[ce.expando]?e:new ce.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:ce.makeArray(t,[e]),c=ce.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!y(n)){for(s=c.delegateType||d,Dt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||C)&&p.push(a.defaultView||a.parentWindow||ie)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(_.get(o,"events")||Object.create(null))[e.type]&&_.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&$(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!$(n)||u&&v(n[d])&&!y(n)&&((a=n[u])&&(n[u]=null),ce.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Nt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Nt),ce.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=ce.extend(new ce.Event,n,{type:e,isSimulated:!0});ce.event.trigger(r,null,t)}}),ce.fn.extend({trigger:function(e,t){return this.each(function(){ce.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ce.event.trigger(e,t,n,!0)}});var qt=/\[\]$/,Lt=/\r?\n/g,Ht=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;function Pt(n,e,r,i){var t;if(Array.isArray(e))ce.each(e,function(e,t){r||qt.test(n)?i(n,t):Pt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==x(e))i(n,e);else for(t in e)Pt(n+"["+t+"]",e[t],r,i)}ce.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!ce.isPlainObject(e))ce.each(e,function(){i(this.name,this.value)});else for(n in e)Pt(n,e[n],t,i);return r.join("&")},ce.fn.extend({serialize:function(){return ce.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ce.prop(this,"elements");return e?ce.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ce(this).is(":disabled")&&Ot.test(this.nodeName)&&!Ht.test(e)&&(this.checked||!we.test(e))}).map(function(e,t){var n=ce(this).val();return null==n?null:Array.isArray(n)?ce.map(n,function(e){return{name:t.name,value:e.replace(Lt,"\r\n")}}):{name:t.name,value:n.replace(Lt,"\r\n")}}).get()}});var Rt=/%20/g,Mt=/#.*$/,It=/([?&])_=[^&]*/,Wt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,$t=/^\/\//,Bt={},_t={},Xt="*/".concat("*"),Ut=C.createElement("a");function zt(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(D)||[];if(v(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Vt(t,i,o,a){var s={},u=t===_t;function l(e){var r;return s[e]=!0,ce.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Gt(e,t){var n,r,i=ce.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&ce.extend(!0,e,r),e}Ut.href=Et.href,ce.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Xt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":ce.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Gt(Gt(e,ce.ajaxSettings),t):Gt(ce.ajaxSettings,e)},ajaxPrefilter:zt(Bt),ajaxTransport:zt(_t),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=ce.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?ce(y):ce.event,x=ce.Deferred(),b=ce.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Wt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+"").replace($t,Et.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(D)||[""],null==v.crossDomain){r=C.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Ut.protocol+"//"+Ut.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=ce.param(v.data,v.traditional)),Vt(Bt,v,t,T),h)return T;for(i in(g=ce.event&&v.global)&&0==ce.active++&&ce.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Ft.test(v.type),f=v.url.replace(Mt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Rt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(At.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(It,"$1"),o=(At.test(f)?"&":"?")+"_="+jt.guid+++o),v.url=f+o),v.ifModified&&(ce.lastModified[f]&&T.setRequestHeader("If-Modified-Since",ce.lastModified[f]),ce.etag[f]&&T.setRequestHeader("If-None-Match",ce.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Xt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Vt(_t,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=ie.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&ie.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<ce.inArray("script",v.dataTypes)&&ce.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(ce.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(ce.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--ce.active||ce.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return ce.get(e,t,n,"json")},getScript:function(e,t){return ce.get(e,void 0,t,"script")}}),ce.each(["get","post"],function(e,i){ce[i]=function(e,t,n,r){return v(t)&&(r=r||n,n=t,t=void 0),ce.ajax(ce.extend({url:e,type:i,dataType:r,data:t,success:n},ce.isPlainObject(e)&&e))}}),ce.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),ce._evalUrl=function(e,t,n){return ce.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){ce.globalEval(e,t,n)}})},ce.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=ce(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(e){ce(this).wrapInner(n.call(this,e))}):this.each(function(){var e=ce(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=v(t);return this.each(function(e){ce(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){ce(this).replaceWith(this.childNodes)}),this}}),ce.expr.pseudos.hidden=function(e){return!ce.expr.pseudos.visible(e)},ce.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ce.ajaxSettings.xhr=function(){try{return new ie.XMLHttpRequest}catch(e){}};var Yt={0:200,1223:204},Qt=ce.ajaxSettings.xhr();le.cors=!!Qt&&"withCredentials"in Qt,le.ajax=Qt=!!Qt,ce.ajaxTransport(function(i){var o,a;if(le.cors||Qt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Yt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&ie.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),ce.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ce.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return ce.globalEval(e),e}}}),ce.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ce.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=ce("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),C.head.appendChild(r[0])},abort:function(){i&&i()}}});var Jt,Kt=[],Zt=/(=)\?(?=&|$)|\?\?/;ce.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Kt.pop()||ce.expando+"_"+jt.guid++;return this[e]=!0,e}}),ce.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Zt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Zt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Zt,"$1"+r):!1!==e.jsonp&&(e.url+=(At.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||ce.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=ie[r],ie[r]=function(){o=arguments},n.always(function(){void 0===i?ce(ie).removeProp(r):ie[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Kt.push(r)),o&&v(i)&&i(o[0]),o=i=void 0}),"script"}),le.createHTMLDocument=((Jt=C.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Jt.childNodes.length),ce.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(le.createHTMLDocument?((r=(t=C.implementation.createHTMLDocument("")).createElement("base")).href=C.location.href,t.head.appendChild(r)):t=C),o=!n&&[],(i=w.exec(e))?[t.createElement(i[1])]:(i=Ae([e],t,o),o&&o.length&&ce(o).remove(),ce.merge([],i.childNodes)));var r,i,o},ce.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=Tt(e.slice(s)),e=e.slice(0,s)),v(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&ce.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?ce("<div>").append(ce.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},ce.expr.pseudos.animated=function(t){return ce.grep(ce.timers,function(e){return t===e.elem}).length},ce.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=ce.css(e,"position"),c=ce(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=ce.css(e,"top"),u=ce.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),v(t)&&(t=t.call(e,n,ce.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},ce.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ce.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===ce.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===ce.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=ce(e).offset()).top+=ce.css(e,"borderTopWidth",!0),i.left+=ce.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-ce.css(r,"marginTop",!0),left:t.left-i.left-ce.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===ce.css(e,"position"))e=e.offsetParent;return e||J})}}),ce.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;ce.fn[t]=function(e){return R(this,function(e,t,n){var r;if(y(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),ce.each(["top","left"],function(e,n){ce.cssHooks[n]=Ye(le.pixelPosition,function(e,t){if(t)return t=Ge(e,n),_e.test(t)?ce(e).position()[n]+"px":t})}),ce.each({Height:"height",Width:"width"},function(a,s){ce.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){ce.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return R(this,function(e,t,n){var r;return y(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?ce.css(e,t,i):ce.style(e,t,n,i)},s,n?e:void 0,n)}})}),ce.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ce.fn[t]=function(e){return this.on(t,e)}}),ce.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),ce.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){ce.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var en=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;ce.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=ae.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(ae.call(arguments)))}).guid=e.guid=e.guid||ce.guid++,i},ce.holdReady=function(e){e?ce.readyWait++:ce.ready(!0)},ce.isArray=Array.isArray,ce.parseJSON=JSON.parse,ce.nodeName=fe,ce.isFunction=v,ce.isWindow=y,ce.camelCase=F,ce.type=x,ce.now=Date.now,ce.isNumeric=function(e){var t=ce.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},ce.trim=function(e){return null==e?"":(e+"").replace(en,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return ce});var tn=ie.jQuery,nn=ie.$;return ce.noConflict=function(e){return ie.$===ce&&(ie.$=nn),e&&ie.jQuery===ce&&(ie.jQuery=tn),ce},"undefined"==typeof e&&(ie.jQuery=ie.$=ce),ce});
	</script>
	<!-- Animation functions -->
	<script id="variables-js">
		
		// Max allowed number of relations per page (past this number relations get impossible to see)
		const MAX_RECORDS_PER_PAGE = 50;
		// Sorting algorithms
		var algorithm_type = {
			two_way: 0,
			k_way: 1,
			replacement_selection: 2,
		}
		var algorithm_type_string_map = {
			0: "2-way External Sorting",
			1: "K-way External Sorting",
			2: "Replacement Selection External Sorting"
		}

		const LOG_DEBUG = false;

		// Algorithm type
		var selected_algorithm_type = null;

		// Input values
		var num_of_frames_in_buffer = -1;
		var num_of_records_per_page = -1;
		var num_of_records_of_file = -1;
		var num_of_pages_of_file = -1;

		var animation_velocities = {
			speed_3_00: 12,	// 3x
			speed_2_50: 10.5,
			speed_2_00: 9,	// 2x
			speed_1_75: 8,
			speed_1_50: 7,
			speed_1_25: 6,
			speed_1_00: 5,	// 1x
			speed_0_75: 4,
			speed_0_50: 3,
			speed_0_25: 2,
		}
		// Current animation speed
		var selected_animation_speed_multiplier;

		// ANIMATION
		var pause_in_between_animation_phases;
		var animation_is_playing = false;
		var animate_forward_step = true;

		// Other variables
		var time = 0;
		const ANIMATION_STEP_MULTIPLIER = 100; // NOTE: Don't change this, change animation_speed instead (this is also the minimum time in ms hte user needs to wait to move forwards / backwards with steps)

		var STEP_DURATION;

		// Other input variables ------------------------
		var enable_fireworks = true;
		var enable_focus_on_element = true;
		var enable_algorithm_lines_highlighting = true;
		var enable_custom_cursor = false;

		function set_enable_fireworks(value) {
			enable_fireworks = value;
			if (!enable_fireworks) {
				// Stop fireworks
				stop_fireworks();
			} else {
				// Start fireworks if needed
				if (current_phase >= animation.length - 3) {
					start_fireworks();
				}
			}
		}

		function set_enable_focus_on_element(value) {
			enable_focus_on_element = value;
		}

		function set_enable_algorithm_lines_highlighting(value) {
			enable_algorithm_lines_highlighting = value;
			if (enable_algorithm_lines_highlighting) {
				// Set code lines to correct code lines
				if (current_phase >= 0 && current_phase < animation.length) {
					let phase_info = animation[current_phase + 1].phase_info;
					move_code_line_to(phase_info.code_line, phase_info.code_line_offset);
				}
			} else {
				// Hide code line
				move_code_line_to([-1]);
			}
		}

		function set_enable_custom_cursor(value) {

			enable_custom_cursor = value;

			if (value) {
				$("body").css("cursor", "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='34' height='34' viewBox='0 0 34 34'%3E%3Ctitle%3ESenza titolo-1%3C/title%3E%3Cg style='opacity:0.4'%3E%3Cpath d='M17.277.277a17,17,0,1,0,17,17A17,17,0,0,0,17.277.277Z' transform='translate(-0.277 -0.277)' style='fill:%23ed2024'/%3E%3C/g%3E%3Cpath d='M17.277,3.515A13.762,13.762,0,1,0,31.039,17.277,13.761,13.761,0,0,0,17.277,3.515Z' transform='translate(-0.277 -0.277)' style='fill:%23ed2024;opacity:0.4'/%3E%3Ccircle cx='17' cy='17' r='10.524' style='fill:%23ed2024;opacity:0.8'/%3E%3C/svg%3E\") 10 10, auto");
			} else {
				$("body").css("cursor", "");
			}
		}
	</script>
	<script src="animation_functions.js"></script>
	<!-- Animation functions -->
	<script id="animation-functions-js">

		/**
		 * @definition Moves a record to the frame with the given number. If number is -1, moves the record to the output frame.
		 */
		function move_record_to_frame(record, frame_number, delay = 0, duration = STEP_DURATION) {

			setTimeout(() => {

				let frame = get_frame(frame_number);

				// Calculate the destination position (frames position) for thee record relative to the parent of the record,
				// i.e. the bloxk containing it, hence use css top and left since the element has position relative
				let current_record_position = $(record).position();
				let delta_position = {
					'left': $(frame).offset().left - $(record).offset().left,
					'top': $(frame).offset().top - $(record).offset().top
				};

				let destination = {
					// set the destination to use in the animate function
					// NOTE: I animate using top and left, so the offset() function might not be appropriate
					'left': current_record_position.left + delta_position.left + 'px',
					'top': current_record_position.top + delta_position.top + 'px'
				};

				// move the record to the frame, with a little animation
				$(record).animate({
					'left': destination.left,
					'top': destination.top
				}, duration, 'linear', function () {
					$(record).css("top", destination.top);
					$(record).css("left", destination.left);
				});

			}, delay);
		}

		function move_record_to_run(page_number, record_number, run_number, run_page_number, delay = 0, duration = STEP_DURATION, next_runs, slot_position = -1) {
			// Moves the record to the run, identified by the run number
			setTimeout(() => {

				let record = get_record(page_number, record_number);
				if (record == null) return;

				// Calculate the destination position (frames position) for thee record relative to the parent of the record,
				// i.e. the blox containing it, hence use css top and left since the element has position relative
				let current_record_position = $(record).position();
				let run_page = get_run_page(run_number, run_page_number, next_runs);
				let delta_position = {
					'left': $(run_page).offset().left - $(record).offset().left,
					'top': $(run_page).offset().top - $(record).offset().top
				};

				let additional_height_offset = 0;
				if (slot_position > 0) {
					// move the record to the slot position
					let border_width = get_actual_border_width()
					additional_height_offset = (get_record_height(true) * (record_number - slot_position)); // - border_width / num_of_records_per_page;
				}

				let destination = {
					// set the destination to use in the animate function
					// NOTE: I animate using top and left, so the offset() function might not be appropriate
					'left': current_record_position.left + delta_position.left + 'px',
					'top': current_record_position.top + delta_position.top - additional_height_offset + 'px'
				};

				// move the record to the frame, with a little animation
				$(record).animate({
					'left': destination.left,
					'top': destination.top
				}, duration, 'linear', function () {
					$(record).css("top", destination.top);
					$(record).css("left", destination.left);
				});

			}, delay);
		}

		function move_record_to_original_position(page_number, record_number, delay = 0, duration = STEP_DURATION) {
			// NOTE: to move the record to its original position, we need to set its relative position back to 0
			setTimeout(() => {
				// reorder all the records from their parent block, in the order they currently are,
				// meaning that the first record from top to bottom will be the first child, 
				//	the second record will be the second child, etc.
				// therefore, order records based on their top position

				let record = get_record(page_number, record_number);
				if (record == null) return;

				$(record).animate({
					'left': '0px',
					'top': '0px'
				}, duration, 'linear', function () {
					$(record).css("left", '0px');
					$(record).css("top", '0px');
				});
			}, delay);
		}

		function reparent_records_based_on_top_position(page_number) {
			let parent = get_file_page(page_number);
			let records = $(parent).children('.record').sort(function (a, b) {
				return $(a).position().top - $(b).position().top;
			});
			let first_child_top = $(records[0]).position().top;
			// reparent all the children in the new order, but obviously first remove them from their current parent
			$(parent).children('.record').remove();
			$(parent).append(records);
			// set all the records top position to the offset of the first record
			$(records).css("top", first_child_top);
		}

		function reparent_all_records_based_on_top_position(after_reparenting_new_top_positions, runs_contained_records_for_dishomogeneous_runs = []) {
			let records_list = $('.record').sort(function (a, b) {
				return $(a).offset().top - $(b).offset().top;
			});
			let pages = $('#file .block');
			if (runs_contained_records_for_dishomogeneous_runs.length == 0) {
				// Append records to page in the order of records_list until a page reaches its max number of records
				// NOTE: assuming runs to always have the max number of possible records in them 
				//		(the only run with a page having less than the max number of records is the last run, for the last page)
				for (let i = 0; i < pages.length; i++) {
					let page = pages[i];
					$(page).children('.record').remove();
					$(page).append(records_list.slice(i * num_of_records_per_page, (i * num_of_records_per_page) + num_of_records_per_page));
					$(page).children('.record').css("top", after_reparenting_new_top_positions[i]);
				}
			} else {
				// Assuming runs to also be dishomogeneous, meaning some runs may contain less records than the max per page in their last page
				//	This happens with the "replacement selection" strategy, and in this case the "after_reparenting_new_top_positions" is an array containing 
				// 		for each index i = run_number - 1, the number of records in the run
				let total_witten_records = 0;
				let page_index = 0;
				for (let j = 0; j < runs_contained_records_for_dishomogeneous_runs.length; j++) {
					let num_of_pages_of_this_run = Math.ceil(runs_contained_records_for_dishomogeneous_runs[j] / num_of_records_per_page);
					for (let i = page_index; i < page_index + num_of_pages_of_this_run; i++) {
						let page = pages[i];
						$(page).children('.record').remove();
						let num_of_records_to_append_for_this_page = num_of_records_per_page;
						if (i == page_index + num_of_pages_of_this_run - 1) num_of_records_to_append_for_this_page = (runs_contained_records_for_dishomogeneous_runs[j] - 1) % num_of_records_per_page + 1;
						$(page).append(records_list.slice(total_witten_records, total_witten_records + num_of_records_to_append_for_this_page));
						$(page).children('.record').css("top", after_reparenting_new_top_positions[i]);
						total_witten_records += num_of_records_to_append_for_this_page;
					}
					page_index += num_of_pages_of_this_run;
				}

			}
		}

		function reparent_all_records_based_on_given_list(record_objects_list, after_reparenting_new_top_positions, runs_contained_records_for_dishomogeneous_runs = []) {
			// let normal_records_list = $('.record');

			let records_list = $('.record').sort(function (a, b) {
				let record_a_index_in_records_objects_list = record_objects_list.findIndex((record_object) => { return parseInt(record_object.value) == parseInt($(a).attr("value")); });
				let record_b_index_in_records_objects_list = record_objects_list.findIndex((record_object) => { return parseInt(record_object.value) == parseInt($(b).attr("value")); });
				let record_a_total_number_in_file = (record_objects_list[record_a_index_in_records_objects_list].page_in_file - 1) * num_of_records_per_page + record_objects_list[record_a_index_in_records_objects_list].number_in_page_of_file;
				let record_b_total_number_in_file = (record_objects_list[record_b_index_in_records_objects_list].page_in_file - 1) * num_of_records_per_page + record_objects_list[record_b_index_in_records_objects_list].number_in_page_of_file;
				return record_a_total_number_in_file - record_b_total_number_in_file;
			});
			let pages = $('#file .block');
			if (runs_contained_records_for_dishomogeneous_runs.length == 0) {
				// Append records to page in the order of records_list until a page reaches its max number of records
				// NOTE: assuming runs to always have the max number of possible records in them 
				//		(the only run with a page having less than the max number of records is the last run, for the last page)
				for (let i = 0; i < pages.length; i++) {
					let page = pages[i];
					$(page).children('.record').remove();
					$(page).append(records_list.slice(i * num_of_records_per_page, (i * num_of_records_per_page) + num_of_records_per_page));
					$(page).children('.record').css("top", after_reparenting_new_top_positions[i]);
				}
			} else {
				// Assuming runs to also be dishomogeneous, meaning some runs may contain less records than the max per page in their last page
				//	This happens with the "replacement selection" strategy, and in this case the "after_reparenting_new_top_positions" is an array containing 
				// 		for each index i = run_number - 1, the number of records in the run
				let total_witten_records = 0;
				let page_index = 0;
				for (let j = 0; j < runs_contained_records_for_dishomogeneous_runs.length; j++) {
					let num_of_pages_of_this_run = Math.ceil(runs_contained_records_for_dishomogeneous_runs[j] / num_of_records_per_page);
					for (let i = page_index; i < page_index + num_of_pages_of_this_run; i++) {
						let page = pages[i];
						$(page).children('.record').remove();
						let num_of_records_to_append_for_this_page = num_of_records_per_page;
						if (i == page_index + num_of_pages_of_this_run - 1) num_of_records_to_append_for_this_page = (runs_contained_records_for_dishomogeneous_runs[j] - 1) % num_of_records_per_page + 1;
						$(page).append(records_list.slice(total_witten_records, total_witten_records + num_of_records_to_append_for_this_page));
						$(page).children('.record').css("top", after_reparenting_new_top_positions[i]);
						// $(page).children('.record').css("top", "0px");
						total_witten_records += num_of_records_to_append_for_this_page;
					}
					page_index += num_of_pages_of_this_run;
				}

			}
		}

		// Used for reparenting records after a multiple pages sort
		function reparent_records_in_buffer_based_on_order(new_pages_and_orders) {

			let record_pages = new_pages_and_orders.map((page_and_order) => { return page_and_order.new_page_number; });
			for (let i = 0; i < record_pages.length; i++) {

				let page_number = record_pages[i];
				let frame_number = (page_number - 1) % num_of_frames_in_buffer + 1;
				let parent = get_file_page(page_number);

				let new_position_to_set = {
					'left': $(get_frame(frame_number)).offset().left - $(get_file_page(page_number)).offset().left,
					'top': $(get_frame(frame_number)).offset().top - $(get_file_page(page_number)).offset().top
				}

				// remove children of page and append all children to page based on the new_pages_and_orders array
				$(parent).children('.record').remove();
				for (let j = 0; j < new_pages_and_orders.length; j++) {

					let page_and_order = new_pages_and_orders[j];

					// append record to page if it belongs to this page
					if (page_and_order.new_page_number == page_number) {
						$(parent).append(page_and_order.record);
					}

				}

				let records = $(parent).children('.record');

				// set all the records top position to the offset of the first record
				$(records).css("top", new_position_to_set.top);
				$(records).css("left", new_position_to_set.left);
			}
		}

		function move_record_to_new_slot(page_number, record_number, slot_number, delay = 0, duration = STEP_DURATION) {
			// Moves the record to a new slot, identified by the slot number, 
			// the slot number is the position assigned to the n-th child, where n is the slot number, in its parent block
			setTimeout(() => {

				let record = get_record(page_number, record_number);
				if (record == null) return;

				// Calculate the destination position (frames position) for thee record relative to the parent of the record,
				// i.e. the blox containing it, hence use css top and left since the element has position relative
				let border_width = get_actual_border_width()
				let destination_height = parseFloat($(record).css("top")) - (get_record_height(true) * (record_number - slot_number)); //- border_width / num_of_records_per_page;

				// move the record to the frame, with a little animation
				$(record).animate({
					'top': destination_height
				}, duration * 0.95, 'linear', function () {
					$(record).css("top", destination_height);
				});

			}, delay);
		}


		function move_record_to_new_slot_in_another_frame(current_page_number, record_number, new_frame_number, slot_number, delay = 0, duration = STEP_DURATION) {
			// Moves the record to a new slot, identified by the slot number, 
			// the slot number is the position assigned to the n-th child, where n is the slot number, in its parent block
			setTimeout(() => {

				let record = get_record(current_page_number, record_number);
				if (record == null) {
					return;
				}

				let frame = get_frame(new_frame_number);

				// Calculate the destination position (frames position) for thee record relative to the parent of the record,
				// i.e. the bloxk containing it, hence use css top and left since the element has position relative
				let current_record_position = $(record).position();
				let delta_position = {
					'left': $(frame).offset().left - $(record).offset().left,
					'top': $(frame).offset().top - $(record).offset().top
				};

				// Calculate the destination position (frames position) for thee record relative to the parent of the record,
				// i.e. the blox containing it, hence use css top and left since the element has position relative
				let border_width = get_actual_border_width()
				let destination_height = (current_record_position.top + delta_position.top) - (get_record_height(true) * (record_number - slot_number)); //- border_width / num_of_records_per_page;

				/* ------------------------------------------------- */

				let destination = {
					// set the destination to use in the animate function
					// NOTE: I animate using top and left, so the offset() function might not be appropriate
					'left': current_record_position.left + delta_position.left + 'px',
					'top': destination_height + 'px'
				};

				// move the record to the frame, with a little animation
				$(record).animate({
					'top': destination.top,
					'left': destination.left
				}, duration * 0.95, 'linear', function () {
					$(record).css("top", destination.top);
					$(record).css("left", destination.left);
				});

			}, delay);
		}


		function move_page_to_frame(page_number, frame_number, delay = 0, duration = STEP_DURATION) {
			let page = get_file_page(page_number);
			let records = $(page).find(".record");

			setTimeout(() => {
				let scroll_duration = STEP_DURATION;
				if (duration < 0.01) {
					scroll_duration = 0;
				}
				scroll_to_focused_element($(get_frame(frame_number)), scroll_duration);
			}, delay);

			records.each(function () {
				move_record_to_frame(this, frame_number, delay, duration);
			});
		}

		function move_page_to_original_position(page_number, delay = 0, duration = STEP_DURATION, scroll_to_page = true) {
			let page = get_file_page(page_number);
			let records = $(page).find(".record");

			if (scroll_to_page) {
				setTimeout(() => {
					let scroll_duration = STEP_DURATION;
					if (duration < 0.01) {
						scroll_duration = 0;
					}
					scroll_to_focused_element($(page), scroll_duration);
				}, delay);
			}

			records.each(function (index) {
				move_record_to_original_position(page_number, index + 1, delay, duration);
			});
		}

		function move_page_to_run(page_number, run_number, run_page_number, delay = 0, duration = STEP_DURATION) {
			let page = get_file_page(page_number);
			if (page == null) {
				if (LOG_DEBUG) console.log("Trying to move a null page");
				return;
			}

			setTimeout(() => {
				let scroll_duration = STEP_DURATION;
				if (duration < 0.01) {
					scroll_duration = 0;
				}
				scroll_to_focused_element($(get_run_page(run_number, run_page_number)), scroll_duration);
			}, delay);

			$(page).find(".record").each(function (index) {
				let record_number = index + 1;
				move_record_to_run(page_number, record_number, run_number, run_page_number, delay, duration);
			});
		}

		function hide_page(page_number, delay = 0) {
			let page = get_file_page(page_number);
			setTimeout(() => {
				$(page).hide();
			}, delay);
		}

		function move_record_by_pixels(page_number, record_number, delta_x, delta_y, delay = 0, duration = STEP_DURATION) {
			setTimeout(() => {
				let record = get_record(page_number, record_number);
				if (record == null) return;
				let left_pos = Math.round(parseInt(record.css("left")) + delta_x);
				let top_pos = Math.round(parseInt(record.css("top")) + delta_y);
				record.animate({
					// move record from its position (i.e. css "left") to 120 px more to the right
					"left": left_pos + "px",
					"top": top_pos + "px"
				}, (animate ? duration : 0), "linear");
			}, delay);
		}

		function show_runs(animation_time = STEP_DURATION, set_next_runs = false) {

			let elem_selector = "#runs-container";
			if (set_next_runs) elem_selector = "#runs-container-next";

			$(elem_selector).animate({
				width: "100%"
			}, animation_time, "linear");
		}

		function hide_runs(animation_time = STEP_DURATION, set_next_runs = false) {
			let elem_selector = "#runs-container";
			if (set_next_runs) elem_selector = "#runs-container-next";

			$(elem_selector).animate({
				width: "0%"
			}, animation_time, "linear");
		}

		function set_single_run(run_number, total_pages_per_run, set_next_runs = false) {
			// check if the #runs-container contains a run at the specified run number, if not, add it
			let elem_selector = "#runs-container";
			if (set_next_runs) elem_selector = "#runs-container-next";

			// if this is the first run being created, remove all runs in the #runs-container
			if (run_number == 1) {
				$(elem_selector).empty();
			}

			// Remove all runs equal or after the specified run number
			if ($(elem_selector).find(".blocks-wrapper").length >= run_number) {
				// remove all runs after the specified run number
				$(elem_selector).find(".blocks-wrapper").each(function (index) {
					if (index + 1 >= run_number) {
						$(this).remove();
					}
				});
			}

			let run_html_start =
				'<div id="run" class="blocks-wrapper">' +
				'<div class="blocks-container">';
			let run_page_html = '<div class="block"><div class="block-name"></div></div>';
			let run_html_end =
				'</div>' +
				'<div class="blocks-container-name-v2"></div>' +
				'</div>';
			let run_html = run_html_start;

			// attach as many blocks to the run as the number of pages per run,
			// but do not exceed the total number of pages of the file
			for (let j = 0; j < total_pages_per_run; j++) {
				run_html += run_page_html;
			}

			run_html += run_html_end;

			run_html = $(run_html);
			// set the width of the run with the specified run number to 0%
			$(run_html).css("width", "0px");
			// also set padding left and padding right to 0px
			$(run_html).css("padding-left", "0px");
			$(run_html).css("padding-right", "0px");
			$(run_html).css("border-width", "0px");

			$(elem_selector).append(run_html);
		}

		function show_single_run(run_number, delay = 0, animation_time = STEP_DURATION, set_next_runs = false, show_runs_container = false) {
			setTimeout(() => {
				if (show_runs_container) show_runs(animation_time, set_next_runs);

				let elem_selector = "#runs-container";
				if (set_next_runs) elem_selector = "#runs-container-next";

				// scroll to first run page
				let scroll_duration = STEP_DURATION / 2;
				if (animation_time < 0.01) {
					scroll_duration = 0;
				}
				scroll_to_focused_element($(elem_selector).children("#run").eq(run_number - 1).find(".block").eq(0).get(0), scroll_duration);

				// set the width of the run with the specified run number to 100%
				let width_of_block = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--page-dim'));
				let border_thickness = get_actual_border_width();

				$(elem_selector).children("#run").eq(run_number - 1).animate({
					width: (width_of_block + 5 * 2).toString() + "px",
					paddingLeft: "16px",
					paddingRight: "16px",
					borderWidth: border_thickness + "px"
				}, animation_time, "linear");

			}, delay);
		}

		function hide_single_run(run_number, delay = 0, animation_time = STEP_DURATION, set_next_runs = false, hide_runs_container = false) {

			if (hide_runs_container) hide_runs(animation_time, set_next_runs);

			let elem_selector = "#runs-container";
			if (set_next_runs) elem_selector = "#runs-container-next";

			setTimeout(() => {
				$(elem_selector).children("#run").eq(run_number - 1).animate({
					width: "0px",
					paddingLeft: "0px",
					paddingRight: "0px",
					borderWidth: "0px"
				}, animation_time, "linear");
			}, delay);
		}

		function reorder_records_of_page_based_on_original_values(page_number, delay = 0, delay_between = 0, animation_time = STEP_DURATION) {
			// reorder records in their original order, as stored in the "record_values" array
			// NOTE: this should basically be the analogous of "sort_records_of_page", but setting records position so that they follow
			// the order of the "record_values" array

			setTimeout(() => {
				// get the records of the page that is currently in the frame
				let records = [];
				for (let i = 0; i < num_of_records_per_page; i++) {
					let record = get_record(page_number, i + 1);
					if (record != null) {
						records.push(record);
					}
				}
				// create an array of records
				let records_array = [];
				for (let i = 0; i < records.length; i++) {
					let value = parseInt($(records[i]).attr('value'));
					records_array.push({
						index: i,
						value: value
					});
				}
				// sort the array of records
				records_array.sort(function (a, b) {
					// return a number such that the records in the records array follow the original order of the records
					// stored in the "record_values" array
					return original_records_values_order[(a.value - 1)].index > original_records_values_order[(b.value - 1)].index ? 1 : -1;
				});
				// move the records to their new position
				for (let i = 0; i < records_array.length; i++) {
					let number = parseInt(records_array[i].index) + 1;
					let new_slot_number = i + 1;
					move_record_to_new_slot(page_number, number, new_slot_number, i * delay_between, animation_time);
				}
				setTimeout(() => {
					reparent_records_based_on_top_position(page_number);
				}, animation_time * 1.125 + ANIMATION_STEP_MULTIPLIER);
			}, delay);
		}

		function reorder_records_of_multiple_pages_based_on_original_values(from_page_number, to_page_number, delay = 0, delay_between = 0, animation_time = STEP_DURATION) {
			// reorder records of MULTIPLE PAGES in their original order, as stored in the "record_values" array
			// NOTE: this should basically be the analogous of "sort_records_of_multiple_pages_in_buffer", but setting those pages' records 
			//  position so that they follow the order of the "record_values" array
			setTimeout(() => {
				// get the records of the pages that are currently in the frame
				let page_numbers = [];
				for (let i = from_page_number; i <= to_page_number; i++) {
					page_numbers.push(i);
				}
				let records = [];
				for (let i = 0; i < page_numbers.length; i++) {
					let page_number = page_numbers[i];
					for (let j = 0; j < num_of_records_per_page; j++) {
						let record = get_record(page_number, j + 1);
						if (record != null) {
							records.push(record);
						}
					}
				}
				// create an array of records
				let records_array = [];
				for (let i = 0; i < records.length; i++) {
					records_array.push({
						'current_record_number': (i % num_of_records_per_page) + 1,
						'value': $(records[i]).attr('value'),
						'page_number': Math.floor(i / num_of_records_per_page) + from_page_number
					});
				}
				// "sort" the array of records
				records_array.sort(function (a, b) {
					// return a number such that the records in the records array follow the original order of the records
					// stored in the "record_values" array
					return original_records_values_order[(a.value - 1)].index > original_records_values_order[(b.value - 1)].index ? 1 : -1;
				});
				// move the records to their new position
				new_records_order = [];
				for (let i = 0; i < records_array.length; i++) {
					let current_record_page_number = records_array[i].page_number;
					let current_record_number = records_array[i].current_record_number;
					let new_slot_number = (i % num_of_records_per_page) + 1;
					let new_record_frame_number = Math.floor(i / num_of_records_per_page) + 1;

					let record = get_record(current_record_page_number, current_record_number);
					if (record != null) {
						new_records_order.push({
							'record': record,
							'top': $(record).css('top'),
							'old_page_number': current_record_page_number,
							'new_page_number': (page_numbers[0] - 1) + Math.floor(i / num_of_records_per_page) + 1,
						});
					}

					move_record_to_new_slot_in_another_frame(current_record_page_number, current_record_number, new_record_frame_number, new_slot_number, i * delay_between, animation_time);
				}
				setTimeout(() => {
					for (let i = 0; i < page_numbers.length; i++) {
						reparent_records_in_buffer_based_on_order(new_records_order);
					}
				}, animation_time * 1.125 + ANIMATION_STEP_MULTIPLIER);
			}, delay);
		}

		function sort_records_of_page(page_number, delay = 0, delay_between = 0, animation_time = STEP_DURATION) {
			// sort records and move the records in their respective sorted position
			setTimeout(() => {
				// get the records of the page that is currently in the frame
				let records = [];
				for (let i = 0; i < num_of_records_per_page; i++) {
					let record = get_record(page_number, i + 1);
					if (record != null) {
						records.push(record);
					}
				}
				// create an array of records
				let records_array = [];
				for (let i = 0; i < records.length; i++) {
					records_array.push({
						'number': i + 1,
						'value': $(records[i]).attr('value')
					});
				}
				// sort the array of records
				records_array.sort(function (a, b) {
					return a.value - b.value;
				});
				// move the records to their new position
				for (let i = 0; i < records_array.length; i++) {
					let number = records_array[i].number;
					let new_slot_number = i + 1;
					move_record_to_new_slot(page_number, number, new_slot_number, i * delay_between, animation_time);
				}
				setTimeout(() => {
					reparent_records_based_on_top_position(page_number);
				}, animation_time * 1.125 + ANIMATION_STEP_MULTIPLIER);
			}, delay);
		}

		function sort_records_of_multiple_pages_in_buffer(from_page_number, to_page_number, delay = 0, delay_between = 0, animation_time = STEP_DURATION) {
			// sort records of the pages given, and move the records in their respective sorted position and in their corresponding page, in order of page number
			setTimeout(() => {
				// get the records of the pages that are currently in the frame
				let page_numbers = [];
				for (let i = from_page_number; i <= to_page_number; i++) {
					page_numbers.push(i);
				}
				let records = [];
				for (let i = 0; i < page_numbers.length; i++) {
					let page_number = page_numbers[i];
					for (let j = 0; j < num_of_records_per_page; j++) {
						let record = get_record(page_number, j + 1);
						if (record != null) {
							records.push(record);
						}
					}
				}
				// create an array of records
				let records_array = [];
				for (let i = 0; i < records.length; i++) {
					records_array.push({
						'current_record_number': (i % num_of_records_per_page) + 1,
						'value': $(records[i]).attr('value'),
						'page_number': Math.floor(i / num_of_records_per_page) + from_page_number
					});
				}
				// sort the array of records
				records_array.sort(function (a, b) {
					return a.value - b.value;
				});
				// move the records to their new position
				new_records_order = [];
				for (let i = 0; i < records_array.length; i++) {
					let current_record_page_number = records_array[i].page_number;
					let current_record_number = records_array[i].current_record_number;
					let new_slot_number = (i % num_of_records_per_page) + 1;
					let new_record_frame_number = Math.floor(i / num_of_records_per_page) + 1;

					let record = get_record(current_record_page_number, current_record_number);
					if (record != null) {
						new_records_order.push({
							'record': record,
							'top': $(record).css('top'),
							'old_page_number': current_record_page_number,
							'new_page_number': (page_numbers[0] - 1) + Math.floor(i / num_of_records_per_page) + 1,
						});
					}

					move_record_to_new_slot_in_another_frame(current_record_page_number, current_record_number, new_record_frame_number, new_slot_number, i * delay_between, animation_time);
				}
				setTimeout(() => {
					for (let i = 0; i < page_numbers.length; i++) {
						reparent_records_in_buffer_based_on_order(new_records_order);
					}
				}, animation_time * 1.125 + ANIMATION_STEP_MULTIPLIER);
			}, delay);

		}

		function get_file_page(page_number) {
			if (page_number < 0 || page_number > $('#file .block').length) {
				if (LOG_DEBUG) console.log('Invalid file page number: ' + page_number);
				return null;
			}
			return $('#file .block:nth-child(' + (page_number).toString() + ')');
		}

		/**
		* @description Returns the frame with the specified frame number (if frame_number == -1, returns the last frame)
		* NOTE: lets you retrieve the last frame even by passing its actual number (not -1)
		*/
		function get_frame(frame_number) {
			if (frame_number != -1 && (frame_number < 0 || frame_number > $('#frame-buffer .block').length)) {
				if (LOG_DEBUG) console.log('Invalid frame number: ' + frame_number);
				return null;
			}
			if (frame_number == -1) {
				// Returns output frame
				return $('#frame-buffer .block:last-child');
			} else {
				return $('#frame-buffer .block:nth-child(' + (frame_number).toString() + ')');
			}
		}

		function get_run_page(run_number, run_page_number, next_runs = false) {

			let elem_selector = "#runs-container";
			if (next_runs) elem_selector = "#runs-container-next";

			if (run_number < 0 || run_number > $(elem_selector + ' #run').length) {
				if (LOG_DEBUG) console.log('Invalid run number: ' + run_number);
				return null;
			}
			if (run_page_number < 0 || run_page_number > $(elem_selector + ' #run:nth-child(' + (run_number).toString() + ') .block').length) {
				if (LOG_DEBUG) console.log('Invalid run page number: ' + run_page_number + ' (for run number ' + run_number + ')');
				return null;
			}
			return $(elem_selector + ' #run:nth-child(' + (run_number).toString() + ') .block:nth-child(' + (run_page_number).toString() + ')');
		}

		function get_record(record_page_number, record_number) {
			// take the block name into account
			let actual_record_number = record_number + 1;
			if (record_page_number - 1 < 0 || record_page_number - 1 > $('#file .block').length) {
				if (LOG_DEBUG) console.log('Invalid (record) page number: ' + record_page_number);
				return null;
			}
			if (actual_record_number - 1 < 0 || actual_record_number - 1 > $('#file .block:nth-child(' + (record_page_number).toString() + ') .record').length) {
				if (LOG_DEBUG) console.log('Invalid record number: ' + actual_record_number + ' (for record page number ' + record_page_number + ')');
				return null;
			}
			return $('#file .block:nth-child(' + (record_page_number).toString() + ') .record:nth-child(' + (actual_record_number).toString() + ')').first();
		}

		function reparent_all_file_pages_to_runs(next_runs = false) {
			// Move each file page (.block) inside the runs' pages (.block) in same order

			let elem_selector = "#runs-container";
			if (next_runs) elem_selector = "#runs-container-next";

			let pages = $("#file .block");
			let run_pages = $(elem_selector + " .block");

			// move each page into the runs container (i.e. copy thr html of each page into the runs container, and remove it from the file container)
			for (let i = 0; i < pages.length; i++) {
				let page = pages[i];
				let run_page = run_pages[i];
				$(run_page).html($(page).html());
			}
			$("#file .block .record").remove();

			// Select all records and make their "left" 0
			$(elem_selector + " .record").css("left", "0px");
			$(elem_selector + " .record").css("top", "0px");

		}

		// Move each run page (.block) inside the file's pages (.block) in same order
		function reparent_all_runs_pages_to_file(next_runs = false) {

			let elem_selector = "#runs-container";
			if (next_runs) elem_selector = "#runs-container-next";

			let pages = $("#file .block");
			let run_pages = $(elem_selector + " .block");

			// move each page into the runs container (i.e. copy thr html of each page into the runs container, and remove it from the file container)
			for (let i = 0; i < pages.length; i++) {
				let page = pages[i];
				let run_page = run_pages[i];
				$(page).html($(run_page).html());
			}
			run_pages.remove();

			// Select all records and make their "left" 0 (needed? correct?)
			$("#file .record").css("left", "0px");
			$("#file .record").css("top", "0px");
		}

		function create_records_grayed_copies(parent_container = "#file", pages_of_file = num_of_pages_of_file) {
			// Empty current copies
			delete_records_grayed_copies(parent_container);
			for (i = 0; i < pages_of_file; i++) {
				let page_number = i + 1;
				for (j = 0; j < num_of_records_per_page; j++) {
					let record_number = j + 1;
					let record = get_record(page_number, record_number);
					if (record == null) continue;
					create_single_record_grayed_copy(record, parent_container);
				}
			}
		}

		function delete_records_grayed_copies(parent_container_selector = "#file") {
			// Empty current copies
			if ($(parent_container_selector + " #copies-container").length > 0) {
				$(parent_container_selector + " #copies-container").empty();
			}
		}

		function create_single_record_grayed_copy(record, parent_container = "#file") {

			// Copy the given record, place it into the "#copies-container" element, also mainitaining its position
			let copy = $(record).clone();
			// change copy's class to "record-copy"
			copy.removeClass("record");
			copy.addClass("record-copy");

			// change copy's color to gray
			copy.css("background-color", "gray");

			// change copy's parent to "#copies-container"
			if ($(parent_container + " #copies-container").length == 0) {
				if (LOG_DEBUG) console.log("Parent to which appending to is not present, creating and appending it...");
				$(parent_container).append("<div id='copies-container'></div>");
			}
			copy.appendTo(parent_container + " #copies-container");

			// copy record's position 
			copy.offset(record.offset());

			// set original width in pixels
			copy.css("width", record.width() + "px");
			// set original height in pixels
			copy.css("height", record.height() + "px");

		}

		function move_record_grayed_copy_by_pixels(record_number, delta_x, delta_y, delay = 0, duration = STEP_DURATION) {
			setTimeout(() => {
				let record = $("#copies-container .record-copy:nth-child(" + record_number + ")");
				if (record == null) return;
				let left_pos = Math.round(parseInt(record.css("left")) + delta_x);
				let top_pos = Math.round(parseInt(record.css("top")) + delta_y);
				record.animate({
					// move record from its position (i.e. css "left") to 120 px more to the right
					"left": left_pos + "px",
					"top": top_pos + "px"
				}, (animate ? duration : 0), "linear");
			}, delay);
		}

		function move_all_record_grayed_copy_by_pixels(delta_x, delta_y, delay = 0, duration = STEP_DURATION) {
			for (let i = 0; i < num_of_records_of_file; i++) {
				let record_number = i + 1;
				move_record_grayed_copy_by_pixels(record_number, delta_x, delta_y, delay, duration);
			};
		}

		function snap_all_record_grayed_copies_to_horizontal_position(pos_x, parent_container) {
			for (let i = 0; i < num_of_records_of_file; i++) {
				let record_number = i + 1;
				let record = $(parent_container + " #copies-container .record-copy:nth-child(" + record_number + ")");
				if (record == null || record.length == 0) continue;
				// Snap the record to the given position
				record.offset({
					left: pos_x,
					top: record.offset().top
				});
			};
		}

		function snap_all_records_to_horizontal_position(pos_x, pages_of_file = num_of_pages_of_file) {
			for (i = 0; i < pages_of_file; i++) {
				let page_number = i + 1;
				for (j = 0; j < num_of_records_per_page; j++) {
					let record_number = j + 1;
					let record = get_record(page_number, record_number);
					if (record == null) continue;

					let left_pos = pos_x - $(get_file_page(page_number)).offset().left;
					record.css("left", left_pos + "px");
				}
			}
		}

		/**
		* @description Move the hightlight line of the code to the specified line (from 1 to 25)
		*/
		function move_code_line_to(code_lines_to_move_to, code_line_offset = 0) {


			let animation_time = Math.min(STEP_DURATION / 2, 100);

			if (code_lines_to_move_to.find((line) => { return line == -1; }) != undefined) {
				// Hiding the code highlight (passed "[-1]" as code_lines_to_move_to)
				$(".code .highlight").animate({
					"height": "0px"
				}, animation_time / 2, "linear");
				let offset = 20.5 * 1 - 23.5;
				$(".code .highlight").animate({
					"top": offset + "px"
				}, animation_time, "linear");
				return;
			}

			if (!enable_algorithm_lines_highlighting) return;

			if (code_lines_to_move_to.find((line) => { return line == 0; }) != undefined) {
				if (LOG_DEBUG) console.log("ERROR: code line numbers should start from 1");
				return;
			}

			// Move to first line of the range 
			let offset = 20.5 * (code_lines_to_move_to[0] + code_line_offset) - 23.5;
			$(".code .highlight").animate({
				"top": offset + "px"
			}, animation_time, "linear");

			// Makes highlight taller to span the number of lines indicated
			let highlight_height = 20.5 * code_lines_to_move_to.length + 5;
			if (code_lines_to_move_to.length > 1) {
				$(".code .highlight").animate({
					"height": highlight_height + "px"
				}, animation_time / 2, "linear");
			} else {
				$(".code .highlight").animate({
					"height": "27px"
				}, animation_time / 2, "linear");
			}

			// Scroll the element accordingly if the line is not visible
			let active_code_container = $("#algorithm .code-container").not(":hidden");
			let code_scroll_height = active_code_container.find(".code").first().prop('scrollHeight');
			let code_scroll_top = active_code_container.find(".code").first().scrollTop();
			let code_displayed_height = active_code_container.find(".code").first().height();
			let total_code_lines = active_code_container.find(".code").first().find("div").length - 1;

			if (code_scroll_height > code_displayed_height) {

				// Scroll the element so that the entire highlight, which has height "highlight_height", is visible,
				// and at the center of the scroll section (if possible)
				let scroll_to = offset - (code_displayed_height - highlight_height) / 2;
				if (scroll_to < 0) scroll_to = 0;
				if (scroll_to > code_scroll_height - code_displayed_height) scroll_to = code_scroll_height - code_displayed_height;
				active_code_container.find(".code").first().animate({
					scrollTop: scroll_to
				}, animation_time, "linear");
			}
		}
	</script>
	<!-- Main -->
	<script id="main-js">

		function set_input_values(refresh_visualization, _num_of_pages_of_file = -1, _num_of_frames_in_buffer = -1, _num_of_records_of_file = -1, _num_of_records_per_page = -1) {
			if (_num_of_frames_in_buffer != -1) num_of_frames_in_buffer = _num_of_frames_in_buffer;
			if (_num_of_records_per_page != -1) num_of_records_per_page = _num_of_records_per_page;
			if (_num_of_records_of_file != -1) num_of_records_of_file = _num_of_records_of_file;
			if (_num_of_pages_of_file != -1) num_of_pages_of_file = _num_of_pages_of_file;
			if (refresh_visualization) initialize_visuals_and_animation(true, false, false);
		}

		/**
		 * @description Sets the selected animation speed to the specified speed 
		 * NOTE: this does NOT modify the actual speed, use the "update_actual_speed" function after setting the selected speed to do so
		 */
		function set_selected_speed(speed) {
			selected_animation_speed_multiplier = get_animation_speed_multiplier(speed);	// The higher, the slowest
			if (LOG_DEBUG) console.log('Selected animation speed: ' + speed);
		}
		function get_animation_speed_multiplier(speed) {
			return 10 / animation_velocities[speed];
		}
		/**
		 * @description Sets the ACTUAL animation speed to the speed (previously) selected using the "set_speed" function
		 */
		function update_actual_speed() {

			pause_in_between_animation_phases = 335 * selected_animation_speed_multiplier - 275;	// in ms
			STEP_DURATION = ANIMATION_STEP_MULTIPLIER * selected_animation_speed_multiplier;

			should_update_speed = false;

			if (LOG_DEBUG) {
				console.log('Selected animation speed multiplier: ' + selected_animation_speed_multiplier + "\n" +
					'Pause in between animation phases: ' + pause_in_between_animation_phases + "\n" +
					'Step duration: ' + STEP_DURATION);
			}
		}

		var focused_element_to_follow_with_view = undefined;
		var focus_element = true;

		var current_phase = -1;

		function fast_forward_to_phase(phase) {

			let fast_forward_to_phase_index = phase;

			let temp_animate = animate_forward_step;
			let temp_duration = STEP_DURATION;
			let temp_pause = pause_in_between_animation_phases;

			animate_forward_step = false;
			STEP_DURATION = 1;
			pause_in_between_animation_phases = 10;

			while (current_phase < fast_forward_to_phase_index && current_phase < animation.length - 1) {
				increase_time(true);
			}

			animate_forward_step = temp_animate;
			STEP_DURATION = temp_duration;
			pause_in_between_animation_phases = temp_pause;
		}

		// stores values of records in their original order and in the order they are initialized (visualized in file)
		var original_records_values_order = [
			// {
			//	value: ?,
			//	index: 0,
			//},
		];

		var phase_of_animation_completion_timer = -1;

		var step_animation_timer_for_buttons_hold = 0;

		var holding_keys = {
			"one_down": false,
			"ArrowRight": false,
			"ArrowLeft": false
		}

		var time_to_hold_next_phase_button_before_stepping_automatically = 300;
		var play_animation_until_next_phase = false;
		var decrease_until_previous_phase = false;

		var should_update_speed = false;

		function get_record_height(ignore_border_thickness = false) {
			let height_of_block = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--page-dim'));
			// NOTE: border width changes on page zoom on browsers, therefore we can't use its initial px value,
			// but rather have to find the "#frame-buffer .block" and get its border (since its the only element whose borders are always avaliable)
			let border_thickness = get_actual_border_width();
			// let additional_border_thickness = border_thickness * 2;
			let actual_height_of_block = height_of_block + border_thickness;
			let records_height = (actual_height_of_block / num_of_records_per_page) - border_thickness;
			if (ignore_border_thickness) {
				records_height += border_thickness;
			}
			return records_height;
		}

		function get_actual_border_width() {
			let border_thickness = getComputedStyle((document.getElementById("frame-buffer"))).borderTopWidth.slice(0, -2);
			return parseFloat(border_thickness);
		}

		var last_set_num_of_pages_of_file = 0;
		var last_set_num_of_records_of_file = 0;
		var last_set_num_of_records_per_page = 0;

		function initialize_visualization(num_of_pages_of_file, num_of_frames, num_of_records_of_file, num_of_records_per_page, force_records_refresh = false) {

			if (LOG_DEBUG) console.log("Initializing visualization with " + num_of_pages_of_file + " pages, " + num_of_frames + " frames, " + num_of_records_of_file + " records, " + num_of_records_per_page + " records per page.")

			reset_displayed_phase_pass_and_io_ops();

			let refresh_records =
				last_set_num_of_pages_of_file != num_of_pages_of_file ||
				last_set_num_of_records_of_file != num_of_records_of_file ||
				last_set_num_of_records_per_page != num_of_records_per_page;

			last_set_num_of_pages_of_file = num_of_pages_of_file;
			last_set_num_of_records_of_file = num_of_records_of_file;
			last_set_num_of_records_per_page = num_of_records_per_page;

			// Empty the buffer
			$('#frame-buffer .blocks-container').empty();

			let page_html = '<div class="block"><div class="block-name"></div></div>';

			if (refresh_records || force_records_refresh) {

				// Empty the file
				$('#file .blocks-container').empty();

				// create pages of file
				let record_html = '<div class="record"></div>';
				let attached_records = 1;

				let records_height = get_record_height();
				let border_width = get_actual_border_width();

				for (let i = 0; i < num_of_pages_of_file; i++) {

					$('#file .blocks-container').first().append(page_html);

					// to each page, attach records until all records are attached
					// if we go past the max number of records per page, skip to the next page creation
					for (let j = 0; j < num_of_records_per_page; j++) {
						if (attached_records > num_of_records_of_file) {
							break;
						}

						// add a record to the page
						$('#file .block').last().append(record_html);

						// Set margin of records to the correct border width value (note that this value changes with brpwsers and zoom levels, may be rounded, ecc...)
						$('#file .record').last().css('margin-top', "-" + border_width + 'px');
						$('#file .record').last().css('margin-left', "-" + border_width + 'px');

						// set the height of the record
						$('#file .record').last().css('height', records_height + 'px');
						$('#file .record').last().css('line-height', records_height + 'px');
						if (num_of_records_per_page <= 6) {
							// from 1 to 6 records per page (show text inside the record)
							let font_size = records_height;
							if (font_size > 24) font_size = 24;
							$('#file .record').last().css('font-size', font_size * 0.9 + 'px');

							if (num_of_records_per_page == 1) {
								$('#file .record').last().css('text-align', 'center');
								$('#file .record').last().css('padding-left', 2.5 + 'px');
								$('#file .record').last().css('padding-right', 2.5 + 'px');
							}
						} else {

							// From 7 to 10 records per page (show text outside the record, to its right)
							// If the number of records is 11 or more, the text will be hidden (see below, in "assign_values_to_file_records()" function)
							$('#file .record').last().addClass('alternate-text');
							$('#file .record').last().css('font-size', Math.max(records_height, 8) * 1.25 + 'px');

							// 31 or more records (hides the border, i.e. makes its color transparent)
							if (num_of_records_per_page > 30) {
								$('#file .record').last().css('border-color', 'transparent');
							}
						}
						attached_records++;
					}
				}

				// assigns values (and colors) to records
				assign_values_to_file_records(num_of_records_per_page, num_of_records_of_file);
			}

			// create frames
			let frame_hmtl = page_html;
			for (let i = 0; i < num_of_frames; i++) {
				$('#frame-buffer .blocks-container').first().append(frame_hmtl);
			}

		}

		// Assigns values to records of file (along with colors)
		function assign_values_to_file_records(num_of_records_per_page, num_of_records_of_file) {
			let values = [];
			for (let i = 1; i <= num_of_records_of_file; i++) values.push(i);
			values = values.sort(() => Math.random() - 0.5);
			refresh_file_record_values(values, num_of_records_per_page);
		}

		function refresh_file_record_values(values) {

			original_records_values_order = [];

			$('#file .record').each(function (index, record) {

				let value = values[index];

				original_records_values_order.push({
					'index': index,
					'value': value,
				});


				$(record).attr('value', value);

				if (num_of_records_per_page <= 6) {
					$(record).html((value).toString());
				} else if (num_of_records_per_page <= 10) {
					// add the value to the record in its pseudo element ":after"
					$(record).append('<div class="record-value">' + value + '</div>');
				} else {
					// Do not append the value text to the record if it has 11 or more records 
					// NOTE: the "value" attribute of the record is still set to be used by the algorithm
					$(record).append('<div class="record-value hidden-value">' + value + '</div>');
				}

				// compute the color
				let color = calculate_record_color_css_from_value(value);
				$(record).css('background-color', color);

			});

			// Records are sorted in the actual final visualized order (i.e. by their value)
			original_records_values_order.sort((a, b) => (a.value > b.value) ? 1 : -1);
		}

		function calculate_record_color_css_from_value(value) {
			let max_hue = 345;
			let start_hue = -11;

			let hue_value = Math.floor((value - 1) * max_hue / num_of_records_of_file + start_hue);
			let color_string = '';
			color_string = 'hsl(' + hue_value + ', 90%, 57%)';

			return color_string;
		}

		var input_output_operations_counter = 0;
		var previous_set_pass = -3;

		function display_phase_description_and_code_line(phase_info, display_for_forward_step) {

			if (phase_info === undefined) return false;

			// Move the code line to highlight the correct code line
			move_code_line_to(phase_info.code_line, phase_info.code_line_offset);

			let description_to_display = phase_info.description();						// Show phase description
			// description_to_display = current_phase + ") " + description_to_display;		// Uncomment to show description along with with the phase number, as "1) ..."

			if (!description_to_display) return false;

			let currently_displayed_description = $.trim($(".current-phase-description span").html());
			if (selected_animation_speed_multiplier < get_animation_speed_multiplier("speed_1_50") && animation_is_playing && current_phase < animation.length - 3) {
				description_to_display = "<span class=\"text-info-note\">INFO</span> Set the animation speed to 1.5x or lower or use the <b>left/arrow keys</b> or <b>backwards/forward buttons</b> to see a <b>step-by-step description</b> of the algorithm.";
			}

			// Replace the &ThinSpace; html entity with a normal space, and replace the displayed description actual thin space with a regular space, again
			let parsed_description_to_display = description_to_display.replaceAll("&ThinSpace;", " ");
			// Note: find the actually already changed character in the string and replace it with a normal space
			// Dont use the actual character, use its unicode code
			let parsed_currently_displayed_description = currently_displayed_description.replaceAll("\u2009", " ");

			if (description_to_display != "" && parsed_currently_displayed_description != parsed_description_to_display) {

				// NOTE: jquery cant animate transform, hence I am using the "transition" property in the actual style of the element
				$(".current-phase-description").css("transform", "scale(0.8)");

				let animation_time = Math.min(100, STEP_DURATION / 2);

				let movement_multiplier = display_for_forward_step ? -1 : 1;
				$(".current-phase-description > div").animate({
					top: (movement_multiplier * 60).toString() + "px",
					opacity: " 0",
				}, animation_time, "linear", function () {
					$(".current-phase-description span").html(description_to_display);

					$(".current-phase-description > div").css("top", (-1 * movement_multiplier * 60).toString() + "px");
					$(".current-phase-description > div").css("opacity", "0");

					// NOTE: jquery cant animate transform, hence I am using the "transition" property in the actual style of the element
					$(".current-phase-description").css("transform", "scale(1)");

					$(".current-phase-description > div").animate({
						top: "0px",
						opacity: "1",
					}, animation_time, "linear");
				});
			}

		}

		function display_phase_pass_and_io_ops(pass, phase_io_operations, display_for_forward_step) {

			// Display current pass
			let current_pass_html = "<span>Current pass:</span><span><b>i=" + pass + "</b></span>"
			if (pass == -2) current_pass_html = "<span>Algorithm is over</span>"	//  End of algorithm
			if (pass == -1) current_pass_html = "<span>Algorithm is starting...</span>"	// Start of algorithm
			let current_pass_elem = $("#current-pass");
			if (previous_set_pass != pass) {
				// Animate the current pass
				current_pass_elem.css("transition", "");
				current_pass_elem.css("color", "yellow");
				setTimeout(() => {
					current_pass_elem.css("transition", "250ms");
					current_pass_elem.css("color", "#d3d3d3");
				}, 100);
			}
			previous_set_pass = pass;
			current_pass_elem.html(current_pass_html);

			// Increase (or decrease) I/O operations counter
			if (current_phase <= 0) input_output_operations_counter = 0;
			let io_ops_elem = $("#io-operations");
			if (display_for_forward_step) input_output_operations_counter += phase_io_operations;
			else input_output_operations_counter -= phase_io_operations;
			let io_ops_html = "<span>I/O Operations:</span><span><b>" + input_output_operations_counter + "</b></span>"
			if (phase_io_operations > 0) {
				// Animate the I/O operations counter
				io_ops_elem.css("transition", "");
				io_ops_elem.css("color", "yellow");
				setTimeout(() => {
					io_ops_elem.css("transition", "250ms");
					io_ops_elem.css("color", "#d3d3d3");
				}, 100);
			}
			io_ops_elem.html(io_ops_html);

		}

		function reset_displayed_phase_pass_and_io_ops() {
			// Reset current pass
			let current_pass_html = "<span style='letter-spacing: -0.035vw; color: white;'>Press <span class='play-pause-icon button-icon' style='display: inline-block; margin-top: -1vw; transform: translateY(0.27vw)'></span> or <span class='step-forward-icon button-icon' style='margin-top: -0.1vw; transform: translateY(0.14vw)'></span> to start</span>" // Start of algorithm
			let current_pass_elem = $("#current-pass");
			current_pass_elem.html(current_pass_html);

			// Reset I/O operations counter
			let io_ops_elem = $("#io-operations");
			let io_ops_html = "<span style='letter-spacing: -0.035vw; color: white;'>Press <span class='sorting-tree-icon button-icon' style='display: inline-block; margin-top: -1vw; transform: translateY(0.27vw)'></span>  for the sorting tree</span></span>"
			io_ops_elem.html(io_ops_html);

		}

		var last_recorded_time = 0;

		function get_animation_phase_based_on_time(time) {
			let difference = time - last_recorded_time;
			let phase = current_phase;
			if (animation[current_phase] === undefined) return 0;
			if (difference > animation[current_phase].duration()) {
				return phase + 1;
			} else if (difference < 0 && Math.abs(difference) > animation[current_phase].duration()) {
				return phase - 1;
			}
			return phase;
		}

		function increase_time(play_phase_animation = true) {
			// if (phase_of_animation_completion_timer.length == 0) return;
			if (current_phase <= animation.length) time += ANIMATION_STEP_MULTIPLIER;
			if (get_animation_phase_based_on_time(time) > current_phase) {

				if (should_update_speed) update_actual_speed();

				current_phase++;
				last_recorded_time = time;

				if (play_animation_until_next_phase) play_animation_until_next_phase = false;

				if (current_phase >= 0 && current_phase < animation.length && animation[current_phase] !== undefined) {
					if (play_phase_animation) {
						animation[current_phase].play(animate_forward_step);
						set_phase_of_animation_completion_timer(animation[current_phase].duration());

						if (current_phase + 1 < animation.length) display_phase_description_and_code_line(animation[current_phase + 1].phase_info, true);
						if (current_phase + 1 < animation.length) display_phase_pass_and_io_ops(animation[current_phase].phase_info.pass_number, animation[current_phase].phase_info.io_operations, true);
						if (LOG_DEBUG) console.log('========== Animation phase (increased): ' + current_phase + '.\n' + animation[current_phase].phase_info.description() + "\nPass of phase: " + animation[current_phase].phase_info.pass_number);
					}
				}
			}
		}

		function decrease_time(set_state_animation = true) {

			time -= ANIMATION_STEP_MULTIPLIER;

			if (get_animation_phase_based_on_time(time) < current_phase) {

				if (should_update_speed) update_actual_speed();

				current_phase--;
				last_recorded_time = time;

				if (decrease_until_previous_phase) decrease_until_previous_phase = false;

				if (current_phase >= 0) {
					if (set_state_animation) {

						disable_scroll_temporarily = true;

						animation[current_phase].rollback(false);

						setTimeout(() => {
							disable_scroll_temporarily = false;
						}, STEP_DURATION);

						if (current_phase + 1 < animation.length) display_phase_description_and_code_line(animation[current_phase + 1].phase_info, false);
						if (current_phase + 1 < animation.length) display_phase_pass_and_io_ops(animation[current_phase].phase_info.pass_number, animation[current_phase + 1].phase_info.io_operations, false);
						if (LOG_DEBUG) {
							let append_string = "\n UNDOING: " + animation[current_phase + 1].phase_info.description();
							console.log('========== Animation phase (decreased): ' + current_phase + "." + append_string + "\nPass of phase: " + animation[current_phase].phase_info.pass_number);
						}
					}
				}
			}
		}

		// Timer used to check if a phase of an animation is actually playing
		function set_phase_of_animation_completion_timer(time) {
			phase_of_animation_completion_timer = time;
		}
		function one_phase_of_animation_is_playing() {
			return phase_of_animation_completion_timer > 0;
		}
		function start_updating_phase_of_animation_completion_timer() {
			// Decrease the timer every animation step divided by 10, this should go on automatically
			setInterval(() => {
				if (phase_of_animation_completion_timer >= 0) {
					phase_of_animation_completion_timer -= ANIMATION_STEP_MULTIPLIER / 10;
				}
			}, ANIMATION_STEP_MULTIPLIER / 10);
		}


		var pressed_step_forward_button = false;
		var pressed_step_backwards_button = false;

		function timeline() {
			if (animation_is_playing) {
				// animation is playing
				increase_time();
			} else {
				// animation NOT playing

				// decrease step animation timer
				if (step_animation_timer_for_buttons_hold > 0) {
					step_animation_timer_for_buttons_hold -= ANIMATION_STEP_MULTIPLIER;
				}

				// keys holding
				if ((holding_keys["ArrowRight"] || pressed_step_forward_button) || play_animation_until_next_phase) {
					// right arrow (time increases)

					if (current_phase == -1) {
						pressed_step_forward_button = false;
						key_controls_handler(undefined, false);
					}

					if (step_animation_timer_for_buttons_hold <= 0.01 || play_animation_until_next_phase) {

						let just_pressed_the_button = play_animation_until_next_phase;

						if (current_phase == animation.length - 1) {
							// This is the very last phase
							play_animation_until_next_phase = false;
							pressed_step_forward_button = false;
							key_controls_handler(undefined, false);
						}

						// increase the time until the phase changes
						if (play_animation_until_next_phase && (one_phase_of_animation_is_playing() || current_phase == -1)) {
							if (LOG_DEBUG) console.log("Pressed the right arrow while a phase of the animation is playing: starting increasing time until we can play the next phase animation...")
							// One phase of the animation is playing, so we need to wait for it to finish (we update its time)
							increase_time();
						} else if (current_phase < animation.length - 1) {
							if (LOG_DEBUG) console.log("Holding (or pressed) the right arrow: increasing time until the next phase...")
							let phase = get_animation_phase_based_on_time(time);
							while (get_animation_phase_based_on_time(time) == phase && current_phase < animation.length) {
								increase_time();
							}
						}

						// Set the timer to play the next phase's animation if the user is still holding down the button
						if (just_pressed_the_button) {
							// User just started holding the button (the animation played until the next phase, now we set a timeout at the end of which,
							//  	if the user is still holding the button, the animation will continue)
							let animation_duration = 0;
							if (animation[current_phase] !== undefined) animation_duration = animation[current_phase].duration();
							start_step_animation_timer(Math.max(time_to_hold_next_phase_button_before_stepping_automatically, animation_duration));
						} else {
							// set the timer to the duration of the current phase (minus pause in between timer)
							if (animation[current_phase] !== undefined) start_step_animation_timer(animation[current_phase].duration() - pause_in_between_animation_phases);
						}
					}
				} else if (holding_keys["ArrowLeft"] || pressed_step_backwards_button || decrease_until_previous_phase) {

					if (selected_algorithm_type == algorithm_type.replacement_selection && animation[current_phase] !== undefined && animation[current_phase].phase_info.pass_number == 0) {
						// If the current phase is the first pass of the replacement selection algorithm, do not allow to go backwards
						if (LOG_DEBUG) console.log("Cannot go backwards from the first pass of the replacement selection algorithm");

						pressed_step_backwards_button = false;
						decrease_until_previous_phase = false;
						key_controls_handler(undefined, false);

						let confirm = window.confirm("The visualization of the Replacement Selection External Sorting algorithm doesn't allow to get back of a single step during pass 0.\n\n" +
							"This is because the behaviour of this algorithm highly depends on the specific records of the file being sorted.\n\n" +
							"You can still get back to the start of pass 0 for this visualization and replay the animation from there.\n" +
							"Do you want to go back to the start of pass 0?");
						if (confirm) {
							// Restart pass 0
							if (LOG_DEBUG) console.log("Restarting pass 0...");
							// current_phase = 0;
							restart(false);
							initialize_animation();
							fast_forward_to_phase(1);
						} else {
							return;
						}
					} else {

						if (step_animation_timer_for_buttons_hold <= 0.01 || decrease_until_previous_phase) {

							let just_pressed_the_button = decrease_until_previous_phase;

							if (current_phase == 0) {
								// This is the very first phase (phase 0)
								decrease_until_previous_phase = false;
								pressed_step_backwards_button = false;
								key_controls_handler(undefined, false);
							}

							// decrease the time until the phase changes
							if (decrease_until_previous_phase && (one_phase_of_animation_is_playing() || current_phase == -1)) {
								if (LOG_DEBUG) console.log("Pressed the left arrow while a phase of the animation is playing: starting decreasing time until we can play the next phase animation...");
								// One phase of the animation is playing, so we need to wait for it to finish (we update its time)
								decrease_time();
							} else {
								if (LOG_DEBUG) console.log("Holding (or pressed) the left arrow: decreasing time until the next phase...")
								let phase = get_animation_phase_based_on_time(time);
								while (get_animation_phase_based_on_time(time) == phase && current_phase > 0) {
									decrease_time();
								}
							}

							// Set the timer to play the previous phase's animation if the user is still holding down the button (to hold the button and decreasing steps)
							if (just_pressed_the_button) {
								// User just started holding the button (the animation decreased its time until the previous phase, now we set a timeout at the end of which,
								//  	if the user is still holding the button, the animation will continue)
								let animation_duration = STEP_DURATION * multiplier;
								// if (animation[current_phase] !== undefined) animation_duration = animation[current_phase].duration();
								start_step_animation_timer(Math.max(time_to_hold_next_phase_button_before_stepping_automatically, animation_duration));
							} else {
								// set the timer to the step duration multiplier
								if (animation[current_phase] !== undefined) start_step_animation_timer(STEP_DURATION * multiplier);
							}

						}
					}
				}
			}

			if (current_phase == animation.length - 1) {
				// Set final text description
				final_rainbow_text_descripiton({
					selector: '.final-description',	// css selector of word container
					minSize: 26,					// in pixels
					maxSize: 28,					// in pixels
					align: 'center',				// align items for letters in flexbox
					rainbow: true,					// enables hue change
					speed: 0.5,						 // 1 is 2PI in rad., 0.5 is PI in rad. etc
					rainbowSpeed: 4,				// speed of hue color change,
					frequency: -2.5					// frequency of sine
				});
			}
		}

		function animate() {
			setTimeout(() => {
				timeline();
				animate();
			}, ANIMATION_STEP_MULTIPLIER);
		}

		var disable_scroll_temporarily = false;

		function scroll_to_focused_element(element, animation_duration = STEP_DURATION) {
			if (!enable_focus_on_element || disable_scroll_temporarily) return;
			// follow the focus element ("focused_element_to_follow_with_view") with the scroll view, meaning that the view should
			//		always show the focus element make sure to avoid jittering by checking if the focus element is already in view
			focused_element_to_follow_with_view = $(element);
			let screen_center_height_percentage = 5;
			if (focus_element && focused_element_to_follow_with_view != undefined && focused_element_to_follow_with_view.length > 0) {
				if (focused_element_to_follow_with_view.first().offset().top < $('#page').height() * (0.5 - screen_center_height_percentage * 0.01 / 2) || focused_element_to_follow_with_view.first().offset().top > $('#page').height() * (0.5 + screen_center_height_percentage * 0.01 / 2)) {
					let scroll_to = focused_element_to_follow_with_view.first().offset().top - $('#page').height() * 0.5 + $('#page').scrollTop();
					// stop the animation to avoid jittering
					$('#page').stop();
					$('#page').animate({ scrollTop: scroll_to }, animation_duration);
				}
			}
		}

		function start_step_animation_timer(to_set) {
			step_animation_timer_for_buttons_hold = to_set;
		}

		function key_controls_handler(keyCode, pressed) {

			// Set flag to indicate that one key was pressed (useful to avoid firing multiple key down events when holding a key)
			holding_keys["one_down"] = pressed;

			holding_keys["ArrowRight"] = pressed && keyCode == 39;
			holding_keys["ArrowLeft"] = pressed && keyCode == 37;

		}

		function play_pause_animation() {
			// toggle the animation

			if (current_phase == -1) initialize_visuals_and_animation(false, true);
			if (animation.length == 0) return;

			animation_is_playing = !animation_is_playing;

			// Display animation info on pause (in case the animation info were being hidden by the "lower animation speed" message, i.e. animation was auto playing with speed greater than 1.5x)
			if (!animation_is_playing) {
				if (current_phase + 1 < animation.length) display_phase_description_and_code_line(animation[current_phase + 1].phase_info, true);
			}

			// Add class .paused 
			if (animation.length > 0) {
				if (!animation_is_playing) {
					$("#play-pause").removeClass('paused');
				} else {
					$("#play-pause").addClass('paused');
				}
			}

			if (current_phase == animation.length) {
				if (fireworks_are_playing) {
					stop_fireworks();
				} else {
					start_fireworks();
				}
			}
		}

		function restart(show_confirmation_if_playing = true, custom_confirm_message = "") {

			let confirmed = true;
			let message = custom_confirm_message == "" ? "\nThis will restart the animation.\nDo you really want to restart it?" : custom_confirm_message;
			if (show_confirmation_if_playing && current_phase >= 1 && current_phase < animation.length - 3) confirmed = confirm(message);

			// Reset page, visualization, ecc... to the initial state

			if (confirmed) {

				// Initial input values
				if (num_of_frames_in_buffer == -1) num_of_frames_in_buffer = 3;
				if (num_of_pages_of_file == -1) num_of_pages_of_file = 4;
				if (num_of_records_per_page == -1) num_of_records_per_page = 5;
				if (num_of_records_of_file == -1) num_of_records_of_file = 18;

				let input_controls_content =
					'<div style="visibility: hidden; width: 1000px;"></div>' +
					'<div id="input-values">' +
					'	<div class="input-group">' +
					'		<div>File pages:</div>' +
					'		<div><b>B</b>&ThinSpace;=&ThinSpace;<input type="number" id="file-pages" value="' + num_of_pages_of_file + '" min="1"></div>' +
					'	</div>' +
					'	<div class="input-group">' +
					'		<div>Buffer frames:</div>' +
					'		<div><b>M</b>&ThinSpace;=&ThinSpace;<input type="number" id="frames-in-buffer" value="' + num_of_frames_in_buffer + '" min="1"></div>' +
					'	</div>' +
					'	<div class="input-group">' +
					'		<div>File records:</div>' +
					'		<div><input type="number" id="file-records" value="' + num_of_records_of_file + '" min="1"></div>' +
					'	</div>' +
					'	<div class="input-group">' +
					'		<div>Max records per page:</div>' +
					'		<div><input type="number" id="records-per-page" value="' + num_of_records_per_page + '" min="1" max="' + MAX_RECORDS_PER_PAGE + '"></div>' +
					'	</div>' +
					'</div>';
				// Make the input controls (html above) appear
				$(".current-phase-description > div > span").html(input_controls_content);

				animation_is_playing = false;
				current_phase = -1;
				play_animation_until_next_phase = false;
				decrease_until_previous_phase = false;

				if (selected_algorithm_type == null) selected_algorithm_type = algorithm_type.two_way;
				time = 0;

				$("#play-pause").removeClass('paused');

				hide_runs(0, false);
				hide_runs(0, true);

				$("#file").attr("style", "");
				$("#runs-container").removeClass("transform-to-file");

				delete_records_grayed_copies("#file");
				$("#runs-container").empty();
				$("#runs-container-next").empty();

				stop_fireworks();

				set_functions_to_input_fields();

				initialize_visuals_and_animation(true, false, true);

				move_code_line_to([-1]);

				return true;
			} else {
				return false;;
			}
		}

		var set_rainbow_text = false;
		function final_rainbow_text_descripiton({ minSize, maxSize, selector, align, rainbow, speed, rainbowSpeed, frequency }) {
			if (!set_rainbow_text) {
				let wordContainer = $($(selector)[0]);
				if (wordContainer === undefined || wordContainer.length == 0) return;
				set_rainbow_text = true;
				let word = $(wordContainer).html();
				$(wordContainer).css("align-items", align);
				let spanify = (word) => {
					let HTMLString = ''
					word.split('').forEach(l => {
						l === ' ' ? HTMLString += `<span>&nbsp;</span>` : HTMLString += `<span>${l}</span>`
					})
					return HTMLString;
				}
				$(wordContainer).html(spanify(word));
				let letters = [].slice.call($(wordContainer).find("span"));
				let loop = ms => {
					requestAnimationFrame(loop);
					letters.forEach((l, i) => {
						let fontSize = parseInt(Math.sin(ms / (360 * speed) + (i / frequency)) * (maxSize - minSize) + maxSize, 10);
						l.style.fontSize = `${fontSize}px`;
						if (rainbow) {
							l.style.color = `hsl(${ms / rainbowSpeed + i * 20}, 50%, 50%)`;
							l.style.textShadow = ` 0 0 15px hsl(${ms / rainbowSpeed + i * 20}, 50%, 50%)`;
						}
					})
				}
				loop(0);
			}
		}

		function add_button_functions() {

			// Algorithm side-tab collapse button
			$("#collapse-arrow").click(function () {
				// NOTE: if this element is clicked while the aimation is in a state on which records are NOT 
				// in their normal page position, then the various pages will move from their position because of the resize of the page
				let confirmed = true;
				if (current_phase > 1 && current_phase < animation.length - 3) {
					confirmed = confirm("\nYou are trying to collapse the algorithm side-bar after the animation started.\n\nThis may cause visual errors with the position of the elements on the screen, which will then be gradually fixed while the animation continues playing (to avoid this, restart the animation and collapse the algorithm side bar before the animation starts).\n\nDo you really want to collapse the algorithm now?");
				}
				if (confirmed) {
					$(this).parent().toggleClass('collapsed');
				}
			});

			// Add functions to the algorithm selector buttons
			let change_algorithm_confirm_message = "\nYou are trying to change the algorithm after the animation started.\n\nThis will restart the animation.\n\nDo you really want to change the algorithm?"
			$("#algorithm-selector #two-way, #algorithm-selector-alternate #two-way").click(function () {
				if (selected_algorithm_type != algorithm_type.two_way) {
					// Reset animation
					let restarted = restart(undefined, change_algorithm_confirm_message);
					if (restarted) {

						// Set button(s) as selected
						$("#algorithm-selector div, #algorithm-selector-alternate div").removeClass("selected");
						$("#algorithm-selector #two-way").addClass('selected');
						$("#algorithm-selector-alternate #two-way").addClass('selected');

						// Show corresponding algorithm
						$("#algorithm .code-container").css('display', 'none');
						$("#algorithm .two-way").css('display', 'block');

						$("#frame-buffer").removeClass('replacement-selection');
						$("#frame-buffer").removeClass('single-column');

						selected_algorithm_type = algorithm_type.two_way;
					}
				}
			});
			$("#algorithm-selector #k-way, #algorithm-selector-alternate #k-way").click(function () {
				if (selected_algorithm_type != algorithm_type.k_way) {
					// Reset animation
					let restarted = restart(undefined, change_algorithm_confirm_message);
					if (restarted) {


						// Set button as selected
						$("#algorithm-selector div, #algorithm-selector-alternate div").removeClass("selected");
						$("#algorithm-selector #k-way").addClass('selected');
						$("#algorithm-selector-alternate #k-way").addClass('selected');

						// Show corresponding algorithm
						$("#algorithm .code-container").css('display', 'none');
						$("#algorithm .k-way").css('display', 'block');

						$("#frame-buffer").removeClass('replacement-selection');
						$("#frame-buffer").removeClass('single-column');

						selected_algorithm_type = algorithm_type.k_way;
					}
				}
			});
			$("#algorithm-selector #replacement-selection, #algorithm-selector-alternate #replacement-selection").click(function () {
				if (selected_algorithm_type != algorithm_type.replacement_selection) {
					// Reset animation
					let restarted = restart(undefined, change_algorithm_confirm_message);
					if (restarted) {

						// Set button as selected
						$("#algorithm-selector div, #algorithm-selector-alternate div").removeClass("selected");
						$("#algorithm-selector #replacement-selection").addClass('selected');
						$("#algorithm-selector-alternate #replacement-selection").addClass('selected');

						// Show corresponding algorithm
						$("#algorithm .code-container").css('display', 'none');
						$("#algorithm .replacement-selection").css('display', 'block');

						$("#frame-buffer").addClass('replacement-selection');
						$("#frame-buffer").addClass('single-column');

						selected_algorithm_type = algorithm_type.replacement_selection;
					}
				}
			});
			// force click on the "two-way" button on start (to set it as selected algorithm)
			selected_algorithm_type = null;
			$("#algorithm-selector #two-way").click();

			// Add function to the #play-pause button
			$("#play-pause").click(function () {
				play_pause_animation();
			});

			// Add functions to the #speed button
			$("#controls #speed").click(function () {
				let speed_popup = $(this).find(".speed-popup").first();
				speed_popup.toggleClass('showing');
			});
			// Add functions to the #speed button popup
			$("#controls #speed .speed-popup div").click(function () {
				// Set button as selected
				$("#controls #speed .speed-popup div").removeClass("selected");
				$(this).addClass('selected');

				$("#controls #speed .selected-speed").html($(this).html());

				// Set animation speed
				set_selected_speed(Object.keys(animation_velocities)[$(this).index()]);
				should_update_speed = true;
			});
			// make it so that if you click outside the speed popup, it closes
			$(document).mouseup(function (e) {
				var container = $("#controls #speed .speed-popup");
				if (!container.is(e.target) && container.has(e.target).length === 0) {
					if (!$("#controls #speed").is(e.target)) {
						container.removeClass('showing');
					}
				}
			});


			// Add functions to the #options-button button
			$("#options-button").click(function () {
				let speed_popup = $(this).find(".options-popup").first();
				speed_popup.toggleClass('showing');
			});
			// Disable the options popup if the user clicks outside of it
			$(document).mouseup(function (e) {
				var container = $(".options-popup");
				var popup_button = $("#options-button");
				if (!container.is(e.target) && !popup_button.is(e.target) && container.has(e.target).length === 0 && popup_button.has(e.target).length === 0) {
					container.removeClass('showing');
				}
			});

			// Add functions to the toggle buttons #focus-toggle, #code-highlight-toggle, #fireworks-toggle
			$("#focus-toggle").click(function () {
				set_enable_focus_on_element(!enable_focus_on_element);
			});
			$("#code-highlight-toggle").click(function () {
				set_enable_algorithm_lines_highlighting(!enable_algorithm_lines_highlighting);
			});
			$("#fireworks-toggle").click(function () {
				set_enable_fireworks(!enable_fireworks);
			});
			$("#custom-cursor").click(function () {
				set_enable_custom_cursor(!enable_custom_cursor);
			});

			// Add function to the #about-button button
			$("#about-button").click(function () {
				// Show the "#about-popup"
				$("#about-popup").addClass('showing');
				$("#black-overlay").addClass('showing');
			});
			// Add functio to the "close popup" button of the #about-popup
			$("#about-popup #close-about-popup-button").click(function () {
				// Hide the "#instructions-popup"
				$("#about-popup").removeClass('showing');
				$("#black-overlay").removeClass('showing');
			});

			// Add function to the #about-button button
			$("#sorting-tree-button").click(function () {
				if (current_phase == -1 && !animation_is_playing) initialize_animation();
				// Show the "#sorting-tree-popup"
				$("#sorting-tree-popup").addClass('showing');
				$("#black-overlay").addClass('showing');

				// Change the sorting tree text
				let string = "Sorting tree of relation R with B=" + num_of_pages_of_file + " pages, " + num_of_records_of_file + " records, " + num_of_records_per_page + " max records per page and M=" + num_of_frames_in_buffer + " available frames in buffer.<br/>Each line shows the file and sorted runs at the end of each pass of the " + algorithm_type_string_map[selected_algorithm_type] + " algorithm.";
				$("#sorting-tree-popup .sorting-tree-description").html(string);
			});
			// Add functio to the "close popup" button of the #about-popup
			$("#sorting-tree-popup #close-sorting-tree-popup-button").click(function () {
				// Hide the "#instructions-popup"
				$("#sorting-tree-popup").removeClass('showing');
				$("#black-overlay").removeClass('showing');
			});

			// Force click on the #about-button button on start (to show the instructions popup)
			$("#about-button").click();

			// Add functions to the #step-forward and #step-backwards buttons
			$("#step-forward").on("mousedown", function () {

				if (!animation_is_playing) play_animation_until_next_phase = true;
				else animation_is_playing = false;

				$("#play-pause").removeClass('paused');

				if (current_phase == -1) initialize_visuals_and_animation(false, true);
				if (animation.length == 0) return;

				pressed_step_forward_button = true;
			});
			$("#step-forward").on("mouseup mouseleave", function () {
				pressed_step_forward_button = false;
			});
			$("#step-backwards").on("mousedown", function () {

				if (!animation_is_playing) decrease_until_previous_phase = true;
				else animation_is_playing = false;

				if (current_phase <= 0) return;
				$("#play-pause").removeClass('paused');
				pressed_step_backwards_button = true;
			});
			$("#step-backwards").on("mouseup mouseleave", function () {
				pressed_step_backwards_button = false;
			});

			// Add function to the reset button
			$("#restart").click(function () {
				restart();
			});

			// Set input fields functions
			set_functions_to_input_fields();
			// Force change on every input field to set the correct values
			$("input#frames-in-buffer").change();
			$("input#file-pages").change();
			$("input#file-records").change();
			$("input#records-per-page").change();

		}

		function set_functions_to_input_fields() {
			// Set input fields functions
			$("input#file-pages").on("input", function () {
				// This also changes the number of file records
				let new_file_pages_number = parseInt($(this).val());
				let new_file_records_number;
				if (num_of_records_of_file % num_of_records_per_page != 0) new_file_records_number = (new_file_pages_number - 1) * num_of_records_per_page + (num_of_records_of_file % num_of_records_per_page);
				else new_file_records_number = new_file_pages_number * num_of_records_per_page;

				set_input_values(true, new_file_pages_number, -1, new_file_records_number, -1);
				$("input#file-records").val(new_file_records_number);
			});
			$("input#frames-in-buffer").on("input", function () {
				// Set the number of frames in buffer
				set_input_values(true, -1, parseInt($(this).val()), -1, -1);
			});
			$("input#file-records").on("input", function () {
				// This also changes the num of pages of file
				let new_file_records_number = parseInt($(this).val());
				let new_file_pages_number = num_of_pages_of_file;
				if (new_file_records_number > new_file_pages_number * num_of_records_per_page) {
					new_file_pages_number = Math.ceil(new_file_records_number / num_of_records_per_page);
				} else if (new_file_records_number <= (new_file_pages_number - 1) * num_of_records_per_page) {
					new_file_pages_number = Math.ceil(new_file_records_number / num_of_records_per_page);
				}
				set_input_values(true, new_file_pages_number, -1, new_file_records_number, -1);
				$("input#file-pages").val(new_file_pages_number);
			});
			$("input#records-per-page").on("input", function () {
				// This also changes the number of pages of file
				let new_records_per_page = parseInt($(this).val());
				if (new_records_per_page > MAX_RECORDS_PER_PAGE) {
					new_records_per_page = MAX_RECORDS_PER_PAGE;
					$(this).val(new_records_per_page);
				}
				let new_file_pages_number = num_of_pages_of_file;
				if (new_records_per_page * num_of_pages_of_file < num_of_records_of_file) {
					new_file_pages_number = Math.ceil(num_of_records_of_file / new_records_per_page);
				} else if (new_records_per_page * (num_of_pages_of_file - 1) + 1 > num_of_records_of_file) {
					new_file_pages_number = Math.ceil(num_of_records_of_file / new_records_per_page);
				}
				set_input_values(true, new_file_pages_number, -1, -1, new_records_per_page);
				$("input#file-pages").val(new_file_pages_number);
			});
		}

		function add_keyboard_functions() {

			// make it so that if the user clicks the spacebar, the "animation_is_playing" variable is toggled
			$(document).keydown(function (e) {
				// spacebar
				if (e.keyCode == 32) {
					e.preventDefault();
					play_pause_animation();
				}
			});

			// Add functions to the arrow buttons
			$(document).keydown(function (e) {
				// avoid keeping the key pressed
				if (!holding_keys["one_down"]) {

					if (e.keyCode == 37 && current_phase <= 0) return;

					key_controls_handler(e.keyCode, true);

					// If the animation is not playing, and the user presses the right arrow key, then the animation will play
					// 		until the next phase is reached
					if (e.keyCode == 39) {
						// right arrow (time increases)

						if (current_phase == -1) initialize_visuals_and_animation(false, true);

						if (!animation_is_playing) play_animation_until_next_phase = true;
						else animation_is_playing = false;

						$("#play-pause").removeClass('paused');

					} else if (e.keyCode == 37) {
						// left arrow (time decreases)

						if (!animation_is_playing) decrease_until_previous_phase = true;
						else animation_is_playing = false;

						$("#play-pause").removeClass('paused');
					}
				}
			});
			$(document).keyup(function (e) {
				// a key is released
				key_controls_handler(e.keyCode, false);
			});

			// Add "quick speed set" functions to buttons "1", "2" and "3" to set speed to the corresponding value
			$(document).keydown(function (e) {
				if (e.keyCode == 49) {
					// 1
					let elem = $("#controls #speed .speed-popup div:nth-child(" + 7 + ")");	// 1x speed
					elem.click();
					elem.click();
				}
				if (e.keyCode == 50) {
					// 2
					let elem = $("#controls #speed .speed-popup div:nth-child(" + 3 + ")");	// 2x speed
					elem.click();
					elem.click();
				}
				if (e.keyCode == 51) {
					// 3
					let elem = $("#controls #speed .speed-popup div:nth-child(" + 1 + ")");	// 3x speed
					elem.click();
					elem.click();
				}
			});

			// Add function to the "R" key to restart the animation
			// NOTE: disabled because it may lead to unwanted restarts if the "R" key is inadvertently pressed
			// $(document).keydown(function (e) {
			// 	if (e.keyCode == 82) {
			// 		// R
			// 		restart();
			// 	}
			// });
		}

		function initialize_visuals_and_animation(initialize_visuals = true, initialize_animation_phases = true, force_records_refresh = false) {
			if (initialize_visuals) {
				initialize_visualization(num_of_pages_of_file, num_of_frames_in_buffer, num_of_records_of_file, num_of_records_per_page, force_records_refresh);
			}
			if (initialize_animation_phases) {
				if (LOG_DEBUG) console.log("Initializing animation (selected algorithm: " + selected_algorithm_type + ")...");
				current_phase = -1;
				initialize_animation();
			}
		}

		// Create a single pass "row" for the algorithm tree from given record objects and run pages
		function build_single_tree_pass(pass_number, records, run_pages) {

			if (pass_number == -1) {
				// Empty the tree container
				$("#sorting-tree-container").empty();
			}

			let run_html = '<div class="tree-run"></div>';
			let block_html = '<div class="tree-block"></div>';
			let record_html = '<div class="tree-record"></div>';

			let tree_pass_element = $("#sorting-tree-container .tree-pass:nth-child(" + (pass_number + 2) + ")");
			if (tree_pass_element.length == 0) {
				// Create new pass
				tree_pass_element = $('<div class="tree-pass"></div>');
				$("#sorting-tree-container").append(tree_pass_element);
			}

			// Remove records with value -1 (padding records)
			let filtered_records = records.filter(function (record, index) {
				return record.value != -1;
			});

			// Append to the tree_pass_element the runs and their pages (blocks), containing as much records as the number indicated in that list,
			// then also, for each block, assign to the block the "value" contained in the corresponding "records" list (the corresponding record is the one with the same index as the iteration we are considering, meaning records are sorted as if the runs_pages list was "flattened")
			let total_runs;
			let total_pages_of_this_run;
			let total_records_of_this_run_page;
			let total_iterations = Math.ceil(filtered_records.length / num_of_records_per_page) * num_of_records_per_page;
			// tree_pass_element.append(run_html);
			for (let i = 0; i < total_iterations; i++) {

				if (i == 0) {
					$(tree_pass_element).append(run_html);
					$(tree_pass_element).find(".tree-run:last-child").append(block_html);
					total_runs = 1;
					total_pages_of_this_run = 1;
					total_records_of_this_run_page = 0;
				}

				if (total_runs - 1 < run_pages.length && total_pages_of_this_run - 1 < run_pages[total_runs - 1].length &&
					total_records_of_this_run_page >= run_pages[total_runs - 1][total_pages_of_this_run - 1]) {

					function append_remaining_records() {
						// Append remaining "empty" records to the block (before creating a new page or run)
						let remaining_records = num_of_records_per_page - total_records_of_this_run_page;
						for (let j = 0; j < remaining_records; j++) {
							let record_element = $(record_html);
							record_element.addClass("empty");
							$(tree_pass_element).find(".tree-run:last-child .tree-block:last-child").append(record_element);
						}
					}

					if (total_pages_of_this_run + 1 > run_pages[total_runs - 1].length) {

						// Create new run
						if (total_runs + 1 <= run_pages.length) {

							append_remaining_records();

							$(tree_pass_element).append(run_html);
							$(tree_pass_element).find(".tree-run:last-child").append(block_html);
							total_runs += 1;
							total_pages_of_this_run = 1;
							total_records_of_this_run_page = 0;

						} else if (total_runs + 1 > run_pages.length) {

							append_remaining_records();

							// Appended all records: stop
							break;
						}

					} else {

						append_remaining_records();

						// Actually create the new block
						$(tree_pass_element).find(".tree-run:last-child").append(block_html);
						total_pages_of_this_run += 1;
						total_records_of_this_run_page = 0;
					}

				}

				let record_element = $(record_html);
				if (i < filtered_records.length && filtered_records[i].value != -1) {
					let color = calculate_record_color_css_from_value(filtered_records[i].value);
					$(record_element).css('background-color', color);
				} else {
					$(record_element).addClass("empty");
				}

				$(tree_pass_element).find(".tree-run:last-child .tree-block:last-child").append(record_element);

				total_records_of_this_run_page += 1;

			}
		}

		var window_width = window.innerWidth;

		// Detect window horizontal resize, not vertical resize
		$(window).resize(function () {
			if (window.innerWidth != window_width) {

				window_width = window.innerWidth;

				if (current_phase >= 2 && current_phase < animation.length - 3) {
					if (LOG_DEBUG) console.log("Window resized horizontally while animation is playing");
					alert("\nYou zoomed in/out or resied the window while the animation already started.\n\nThis may cause visual errors with the position of the elements on the screen, which will then be gradually fixed while the animation continues playing (to avoid this, restart the animation and resize the window before the animation starts).");
				}
			}
		});

		window.onerror = function () {
			let restart_option = confirm("\nAn error occurred....\n\nDo you want to reset the page?");
			if (restart_option) restart(false);
			else alert("\nThe page will not be resetted, but the animation may not work properly.");
		}

		$(document).ready(function () {

			set_selected_speed("speed_1_00"); // Starting with 1x speed
			update_actual_speed();	// Update actual speed based on selected speed

			// Add button functions
			add_button_functions();

			// Add keyboard functions
			add_keyboard_functions();

			animate();

			start_updating_phase_of_animation_completion_timer();

		});
	</script>
	<!-- Animation -->
	<script id="animation-js">
		var animation = [];
		let multiplier = 1.6;
		let normal_delay = () => {
			return STEP_DURATION * multiplier;
		}
		let in_buffer_normal_delay = () => {
			return normal_delay() / 2;
		}

		function get_record_description_string(record, record_text = "r") {
			let record_string = "<b>" + record_text + "&ThinSpace;=&ThinSpace;</b><span class=\"description-record\" style=\"background-color: " + $(record).css("background-color") + ";\">";
			record_string += $(record).attr("value");
			record_string += "</span>";
			return record_string;
		}

		function logN(base, n) {
			return Math.log(n) / Math.log(base);
		}
		function get_num_and_pages_of_runs_after_pass(pass_i) {
			let num_of_runs = 0;
			let num_of_pages_of_each_run = 0;
			let num_of_available_frames = num_of_frames_in_buffer - 1;
			if (selected_algorithm_type == algorithm_type.two_way) {
				num_of_runs = Math.ceil(num_of_pages_of_file / Math.pow(num_of_available_frames, pass_i));
				num_of_pages_of_each_run = Math.pow(num_of_available_frames, pass_i);
			} else if (selected_algorithm_type == algorithm_type.k_way) {
				num_of_runs = Math.ceil(num_of_pages_of_file / (Math.pow(num_of_available_frames, pass_i) * num_of_frames_in_buffer))
				num_of_pages_of_each_run = Math.pow(num_of_available_frames, pass_i) * num_of_frames_in_buffer;
			} else if (selected_algorithm_type == algorithm_type.replacement_selection) {
				num_of_runs = -1;
				num_of_pages_of_each_run = -1;
			}
			return [num_of_runs, num_of_pages_of_each_run];
		}

		function initialize_animation() {

			animation = [];

			let pass_number_to_set_1 = -1;

			// Check if inputs are correct
			var invalid_records =
				num_of_records_per_page > MAX_RECORDS_PER_PAGE ||
				num_of_records_per_page < 1;
			var invalid_frames =
				num_of_frames_in_buffer <= 2;
			if (invalid_records || invalid_frames) {
				if (invalid_records) alert('Invalid number of records per page: ' + num_of_records_per_page + '\nMinimum is 1 record per page, max is ' + MAX_RECORDS_PER_PAGE + ' records per page (because otherwise records would be so thin that they would be impossible to see).');
				if (invalid_frames) alert('Invalid number of frames in buffer: ' + num_of_frames_in_buffer + '\nExternal merge sort cannot be performed with less than 3 frames in the buffer.');
				return;
			}

			// used to set the phase_info.code_line_offset value, for all phases after pass 0
			let highlight_lines_offset = 0;

			let num_of_available_frames = num_of_frames_in_buffer - 1;

			// NOTE: this is the TOTAL number of needed passes, including pass 0
			var max_num_of_needed_passes = 1;
			if (selected_algorithm_type == algorithm_type.two_way) {
				// Ceil[ log_f(B) + 1 ]  with f = M-1
				max_num_of_needed_passes = Math.ceil(logN(num_of_available_frames, num_of_pages_of_file) + 1);
			} else if (selected_algorithm_type == algorithm_type.k_way) {
				// Ceil[ log_f(Ceil[ B/M ]) ]  with f = M-1
				max_num_of_needed_passes = Math.ceil(logN(num_of_available_frames, Math.ceil(num_of_pages_of_file / num_of_frames_in_buffer)) + 1);
			} else if (selected_algorithm_type == algorithm_type.replacement_selection) {
				max_num_of_needed_passes = Math.ceil(logN(num_of_available_frames, num_of_records_of_file) + 1);
				highlight_lines_offset = 25 - 7;	// the number before the " - 7" is the line numer of the line in the algorithm code on the side with the comment "// Pass i"
			}

			/**
			 * @description All records list, in the order they are in the file (the order and properties of each of the records in this list, hence value, page and number in file,
			 * 		gets updated at the end of each pass, pass 0 included, while before pass 0 it is equal to the order the records are initialized with, hence a random order)
			 * <br/>NOTE: this list may contain elements with value = -1, which means that there is an empty space in the slot represented by that record in the actual file
			 * 		(this may happen in the replacement selection algorithm, in which runs are dishomogeneous and in which the totla number of pages created may be bigger
			 * 		than the original number of pages of the file, hence there may be empty spaces in pages of the file)
			 * @structure
			 * ```
			 * {
			 *   value: number,
			 *   page_in_file: number,
			 *   number_in_page_of_file: number
			 * }
			 * ```
			*/
			let all_records = [];
			for (let i = 0; i < num_of_records_of_file; i++) {
				all_records.push({
					value: i + 1,
					page_in_file: 0,
					number_in_page_of_file: 0,
				});
			}
			all_records.sort(function (a, b) { return original_records_values_order[a.value - 1].index - original_records_values_order[b.value - 1].index; });
			function assign_file_pages_and_numbers_to_records_list_based_on_order() {
				for (let i = 0; i < num_of_records_of_file; i++) {
					all_records[i].page_in_file = Math.floor(i / num_of_records_per_page) + 1;
					all_records[i].number_in_page_of_file = i % num_of_records_per_page + 1;
				}
			}
			assign_file_pages_and_numbers_to_records_list_based_on_order();
			if (LOG_DEBUG) console.log(" ALL RECORDS (at start of animation) ")
			if (LOG_DEBUG) console.log(all_records);

			// Build a "records" list to pass to the function to build the sorting tree
			let records_list = [];
			let records_list_in_order_of_file = original_records_values_order.slice();
			records_list_in_order_of_file.sort(function (a, b) { return a.index - b.index; });
			records_list_in_order_of_file.forEach(function (record, index) {
				let value = record.value;
				let page_in_file = Math.floor(index / num_of_records_per_page) + 1;
				let number_in_page_of_file = index % num_of_records_per_page + 1;
				let record_object = {
					value: value,
					page_in_file: page_in_file,
					number_in_page_of_file: number_in_page_of_file
				}
				records_list.push(record_object);
			});
			let runs_pages = [];
			for (let i = 0; i < num_of_pages_of_file; i++) {
				runs_pages.push(num_of_records_per_page);
			}
			build_single_tree_pass(-1, records_list, [runs_pages]);

			// Phase 0 (does nothing, just to show the description of the next phase)
			animation.push({
				// NOTE: This is phase 0
				play: function (animate = true) {
					// Do nothing: this phase was put here to correctly show the description of the next phase (since we always show description of next phase at each phase)

					// Reset the layout of the buffer
					if (selected_algorithm_type == algorithm_type.replacement_selection) {
						$("#frame-buffer").addClass("single-column");
					}
				},
				phase_info: {
					code_line_offset: 0,
					code_line: [-1],
					pass_number: pass_number_to_set_1,
					io_operations: 0,
					description: function () {
						return "Initializing...";
					}
				},
				rollback: function (animate = false) { },
				duration: function () {
					return STEP_DURATION + pause_in_between_animation_phases
				},
			});
			// Starting animation --------------------------------------------------------------------------------------------------------------
			animation.push({
				// NOTE: This is phase 1
				play: function (animate = true) {
					// Do nothing...
				},
				phase_info: {
					code_line_offset: 0,
					code_line: [1],
					pass_number: pass_number_to_set_1,
					io_operations: 0,
					description: function () {
						return "Starting sorting of relation <b>R</b> with <b>" + num_of_records_of_file + "</b> records (stored in secondary storage, in <b>B=" + num_of_pages_of_file + "</b> page" + (num_of_pages_of_file == 1 ? "" : "s") + " of a file), using <b>M=" + num_of_frames_in_buffer + "</b> frames in the buffer<br/>(in main memory).";
					}
				},
				rollback: function (animate = false) {
					// How the animation should look at the end of the phase
					hide_runs((animate ? undefined : 0));
				},
				duration: function () {
					return normal_delay() + pause_in_between_animation_phases
				},
			});
			// Initialization (setting runs as visible) --------------------------------------------------------------------------------------------------------------
			animation.push({
				// NOTE: This is phase 2
				play: function (animate = true) {
					// Initilaize the visualization
					show_runs((animate ? undefined : 0));
				},
				phase_info: {
					code_line_offset: 0,
					code_line: [(selected_algorithm_type == algorithm_type.replacement_selection ? 1 : 2)],
					pass_number: pass_number_to_set_1,
					io_operations: 0,
					description: function () {
						let append_string_io_ops = " with <b>" + (max_num_of_needed_passes * num_of_pages_of_file * 2) + " I/O operations</b>";
						if (selected_algorithm_type == algorithm_type.replacement_selection) append_string_io_ops = "";
						let append_string = "File will be sorted in <b>" + (max_num_of_needed_passes - 1) + " pass" + (max_num_of_needed_passes - 1 > 1 ? "es" : "") + "</b> (<b>excluding</b> pass 0)" + append_string_io_ops + ".";
						if (selected_algorithm_type == algorithm_type.replacement_selection) append_string = "";
						return "Starting <b>pass 0</b> of the <b>" + algorithm_type_string_map[selected_algorithm_type] + "</b> algorithm. " + append_string;
					}
				},
				rollback: function (animate = false) {
					show_runs((animate ? undefined : 0));
					move_page_to_original_position(1, 0, (animate ? undefined : 0), (animate ? true : false));

					// Delete records grayed copied
					delete_records_grayed_copies("#file");
				},
				duration: function () {
					return normal_delay() + pause_in_between_animation_phases
				},
			});

			/**
			 * @description List containing, for each run number (as the index i such that "run_num = i+1"), its total number of records in the run
			 * @example [ [5,5,2], [5,3], [3] ]
			 */
			let created_runs_records = [];

			// Populates animations for the 2-way algorithm
			function build_2_way_pass_0() {

				// #####  2-WAY  ###############################################################################################################################################################################
				// Move one page in frame, sort page's records, move page to a new run #########################################################################################################################

				let pass_number_to_set = 0;

				for (let i = 0; i < num_of_pages_of_file; i++) {

					// File page and frame to move to
					let page_number = i + 1;
					let frame_number = 1;

					// Runs to move to (after sorting)
					let num_of_pages_per_run = 1;
					let run_number = Math.ceil(page_number / num_of_pages_per_run);
					let run_page_number = ((page_number - 1) % num_of_pages_per_run) + 1;

					// move page to frame =======================================================================================
					animation.push({
						play: function (animate = true) {
							// create copies of records of file
							if (page_number == 1) {
								create_records_grayed_copies("#file");
							}
							set_single_run(run_number, num_of_pages_per_run);
							move_page_to_frame(page_number, frame_number, 0, (animate ? undefined : 0));
						},
						phase_info: {
							code_line_offset: 0,
							code_line: [3],
							pass_number: pass_number_to_set,
							io_operations: 1,
							description: function () {
								return "Loading page <b>P" + page_number + "</b> of the file to frame <b>F" + frame_number + "</b> of the buffer.";
							}
						},
						rollback: function (animate = false) {
							set_single_run(run_number, num_of_pages_per_run);
							reorder_records_of_page_based_on_original_values(page_number, 0, 0, (animate ? undefined : 0));

						},
						duration: function () {
							return normal_delay() + pause_in_between_animation_phases
						},
					});
					// sort records of page ======================================================================================
					animation.push({
						play: function (animate = true) {
							sort_records_of_page(page_number, 0, 0, (animate ? undefined : 0));
						},
						phase_info: {
							code_line_offset: 0,
							code_line: [4],
							pass_number: pass_number_to_set,
							io_operations: 0,
							description: function () {
								return "Sorting records of page in frame <b>F" + frame_number + "</b>.";
							}
						},
						rollback: function (animate = false) {
							hide_single_run(run_number, 0, (animate ? undefined : 0));
							sort_records_of_page(page_number, 0, 0, (animate ? undefined : 0));
						},
						duration: function () {
							return normal_delay() + pause_in_between_animation_phases + ((run_page_number != 1) ? ANIMATION_STEP_MULTIPLIER : 0)
						},
					});
					// create run page ============================================================================
					animation.push({
						play: function (animate = true) {
							show_single_run(run_number, 0, (animate ? undefined : 0));
						},
						phase_info: {
							code_line_offset: 0,
							code_line: [5],
							pass_number: pass_number_to_set,
							io_operations: 0,
							description: function () {
								return "Creating a new run <b>R" + run_number + "</b> of <b>one</b> page in secondary storage to store the sorted records currently in frame <b>F" + frame_number + "</b>.";
							}
						},
						rollback: function (animate = false) {
							show_single_run(run_number, 0, (animate ? undefined : 0));
							move_page_to_frame(page_number, frame_number, 0, (animate ? undefined : 0));
						},
						duration: function () {
							return normal_delay() + pause_in_between_animation_phases
						},
					});
					// move page to run ======================================================================================
					animation.push({
						play: function (animate = true) {
							let delay = 0;
							if (get_run_page(run_number, run_page_number) == null) {
								if (LOG_DEBUG) console.log("WARNING: Run page we are trying to move to is null: this is probably because of rollbacks (step backwards) of animation phases, which set the run to a run having a different number of pages...\nTo fix this, we are re-setting the run to have the correct number of pages");
								set_single_run(run_number, num_of_pages_per_run);
								delay = STEP_DURATION * 0.2;
							}
							move_page_to_run(page_number, run_number, run_page_number, delay, (animate ? undefined : 0));
						},
						phase_info: {
							code_line_offset: 0,
							code_line: [5],
							pass_number: pass_number_to_set,
							io_operations: 1,
							description: function () {
								return "Writing the sorted records of page <b>P" + page_number + "</b> (in frame <b>F" + frame_number + "</b>) to run <b>R" + run_number + "</b><br/>(in secondary storage).";
							}
						},
						rollback: function (animate = false) {

							// undo next phase
							if (page_number < num_of_pages_of_file) {
								// move previous page, which should be in frame, back to ist original position
								move_page_to_original_position(page_number + 1, 0, (animate ? undefined : 0));
							} else if (page_number == num_of_pages_of_file) {
								// This is the last "phase" of pass 0

								// Hide new runs container
								hide_runs((animate ? undefined : 0), true);
								// For each record, snap it to its runs container position (along with its grayed copy)
								let pos_x = $("#runs-container .block").offset().left;
								snap_all_records_to_horizontal_position(pos_x, num_of_pages_of_file);

								// Delete (eventually present) grayed copies of records in the #runs-container
								delete_records_grayed_copies("#runs-container");

								show_runs((animate ? undefined : 0));

								// Reset runs
								let num_of_runs_to_produce = num_of_pages_of_file;
								for (let i = 0; i < num_of_runs_to_produce; i++) {
									let num_of_pages_per_run = 1;
									let run_number = i + 1;
									set_single_run(run_number, num_of_pages_per_run);
									show_single_run(run_number, 0, (animate ? undefined : 0));
								}
							}

							move_page_to_run(page_number, run_number, run_page_number, 0, (animate ? undefined : 0));

						},
						duration: function () {
							return normal_delay() + pause_in_between_animation_phases
						},
					});
				}

				// Update actual records list ("all_records" list)
				// i.e. for each group of "num_of_Records_per_page" records, sort them based on their value
				let new_records_list = [];
				for (let i = 0; i < num_of_pages_of_file; i++) {
					let records_of_page = all_records.slice(i * num_of_records_per_page, (i + 1) * num_of_records_per_page);
					records_of_page.sort(function (a, b) { return a.value - b.value; });
					new_records_list = new_records_list.concat(records_of_page);
				}
				all_records = new_records_list.slice();
				assign_file_pages_and_numbers_to_records_list_based_on_order();
				if (LOG_DEBUG) console.log(" ALL RECORDS (after pass 0 of 2-way) ");
				if (LOG_DEBUG) console.log(all_records);

			}

			// Populate animation for the k-way algorithm
			function build_k_way_pass_0() {
				// #####  K-WAY  ###############################################################################################################################################################################
				// Move M pages in frame, sort all M pages' records, move pages to a new run (of M pages) ######################################################################################################

				let pass_number_to_set = 0;

				for (let i = 0; i < num_of_pages_of_file; i++) {

					// File page and frame to move to
					let page_number = i + 1;
					let frame_number = i % num_of_frames_in_buffer + 1;

					// Runs to move to (after sorting)
					let num_of_pages_per_run = num_of_frames_in_buffer;
					let run_number = Math.ceil(page_number / num_of_pages_per_run);
					let run_page_number = ((page_number - 1) % num_of_pages_per_run) + 1;

					// move page to frame =======================================================================================
					animation.push({
						play: function (animate = true) {

							if (page_number == 1) {
								// create copies of records of file
								create_records_grayed_copies("#file");
							}
							if (run_page_number == 1) {
								// Create the run to store the records of this group of M pages (M is TOTAL number of frames in buffer)
								set_single_run(run_number, num_of_pages_per_run);
							}

							// Move the page to the frame
							move_page_to_frame(page_number, frame_number, 0, (animate ? undefined : 0));
						},
						phase_info: {
							code_line_offset: 0,
							code_line: [3],
							pass_number: pass_number_to_set,
							io_operations: 1,
							description: function () {
								return "Loading page <b>P" + page_number + "</b> of the file to frame <b>F" + frame_number + "</b> of the buffer.";
							}
						},
						rollback: function (animate = false) {

							if (run_page_number == 1) {
								set_single_run(run_number, num_of_pages_per_run);
							}
							move_page_to_frame(page_number, frame_number, 0, (animate ? undefined : 0));

							if ((page_number - 1) % num_of_frames_in_buffer + 1 == num_of_frames_in_buffer || page_number == num_of_pages_of_file) {
								// If this page is the Mth of an M pages group, should reorder its and the previous M-1 pages's records based on the original values

								let first_page_in_buffer = page_number - num_of_frames_in_buffer + 1;
								if (page_number == num_of_pages_of_file) first_page_in_buffer = page_number - ((page_number - 1) % num_of_frames_in_buffer);
								let last_page_in_buffer = page_number;
								reorder_records_of_multiple_pages_based_on_original_values(first_page_in_buffer, last_page_in_buffer, 0, 0, (animate ? undefined : 0));

							} else {
								// This is NOT the Mth page of an M pages group (meaning we are still loading pages until the buffer is full) move the next page back to its original position
								if (page_number < num_of_pages_of_file) {
									move_page_to_original_position(page_number + 1, 0, (animate ? undefined : 0));
								}
							}

						},
						duration: function () {
							return normal_delay() + pause_in_between_animation_phases
						},
					});
					// When we are done loading M pages, sort their records and then move them into the buffer
					if ((page_number - 1) % num_of_frames_in_buffer + 1 == num_of_frames_in_buffer || page_number == num_of_pages_of_file) {
						let first_page_in_buffer = page_number - num_of_frames_in_buffer + 1;
						if (page_number == num_of_pages_of_file) first_page_in_buffer = page_number - ((page_number - 1) % num_of_frames_in_buffer);
						let last_page_in_buffer = page_number;
						// sort records of M pages ======================================================================================
						animation.push({
							play: function (animate = true) {
								if (LOG_DEBUG) console.log("Sorting pages: " + (first_page_in_buffer) + " to " + last_page_in_buffer);
								sort_records_of_multiple_pages_in_buffer(first_page_in_buffer, last_page_in_buffer, 0, 0, (animate ? undefined : 0));
							},
							phase_info: {
								code_line_offset: 0,
								code_line: [4],
								pass_number: pass_number_to_set,
								io_operations: 0,
								description: function () {
									return "Sorting records of all the <b>" + num_of_frames_in_buffer + "</b> page" + (num_of_frames_in_buffer == 1 ? "" : "s") + " in the buffer (from page <b>P" + (first_page_in_buffer) + "</b> to page <b>P" + last_page_in_buffer + "</b> of the file).";
								}
							},
							rollback: function (animate = false) {
								sort_records_of_multiple_pages_in_buffer(first_page_in_buffer, last_page_in_buffer, 0, 0, (animate ? undefined : 0));

								hide_single_run(run_number, 0, (animate ? undefined : 0));
							},
							duration: function () {
								return normal_delay() + pause_in_between_animation_phases
							},
						});
						// create new run ============================================================================
						animation.push({
							play: function (animate = true) {
								show_single_run(run_number, 0, (animate ? undefined : 0));
							},
							phase_info: {
								code_line_offset: 0,
								code_line: [5],
								pass_number: pass_number_to_set,
								io_operations: 0,
								description: function () {
									return "Creating a new run <b>R" + run_number + "</b> of <b>" + num_of_frames_in_buffer + "</b> page" + (num_of_frames_in_buffer == 1 ? "" : "s") + " in secondary storage to store the sorted records in the <b>" + num_of_frames_in_buffer + "</b> frames of the buffer.";
								}
							},
							rollback: function (animate = false) {
								show_single_run(run_number, 0, (animate ? undefined : 0));

								// Move back first of the M pages (moved into a run by the next phase) back to the frame from which it came from (frame 1), hence undoing the next phase
								move_page_to_frame(first_page_in_buffer, 1, 0, (animate ? undefined : 0));
							},
							duration: function () {
								return normal_delay() + pause_in_between_animation_phases
							},
						});
						// move the M pages in buffer to the M run pages =================================================================
						for (let past_page_number = first_page_in_buffer; past_page_number <= last_page_in_buffer; past_page_number++) {
							let run_number_2 = Math.ceil(past_page_number / num_of_pages_per_run);
							let run_page_number_2 = ((past_page_number - 1) % num_of_pages_per_run) + 1;
							let frame_number_2 = past_page_number - first_page_in_buffer + 1;	// For the end_function (undoing the animation)
							// move next one of the M pages in buffer to the new run ======================================================================================
							animation.push({
								play: function (animate = true) {
									let delay = 0;
									if (get_run_page(run_number_2, run_page_number_2) == null) {
										if (LOG_DEBUG) console.log("WARNING: Run page we are trying to move to is null: this is probably because of rollbacks (step backwards) of animation phases, which set the run to a run having a different number of pages...\nTo fix this, we are re-setting the run to have the correct number of pages");
										set_single_run(run_number_2, num_of_pages_per_run);
										delay = STEP_DURATION * 0.2;
									}
									move_page_to_run(past_page_number, run_number_2, run_page_number_2, delay, (animate ? undefined : 0));
								},
								phase_info: {
									code_line_offset: 0,
									code_line: [5],
									pass_number: pass_number_to_set,
									io_operations: 1,
									description: function () {
										return "Writing the sorted records in the buffer (of " + (first_page_in_buffer == last_page_in_buffer ? ("page <b>P" + first_page_in_buffer + "</b>") : ("pages from <b>P" + (first_page_in_buffer) + "</b> to <b>P" + last_page_in_buffer + "</b>")) + ") to run <b>R" + run_number + "</b> of <b>" + num_of_frames_in_buffer + "</b> pages (in secondary storage).";
									}
								},
								rollback: function (animate = false) {

									// Undo next phase
									if (past_page_number < page_number) {
										// move next page of this M (or maybe less if the page is the last) pages group, which should be in frame, back to ist frame position
										move_page_to_frame(past_page_number + 1, frame_number_2 + 1, 0, (animate ? undefined : 0));
									} else {
										if (page_number < num_of_pages_of_file) {
											// Undoing start animatioin of next group of M runs (hence undoing movement of next page into frame 1)
											move_page_to_original_position(page_number + 1, 0, (animate ? undefined : 0));
										} else if (page_number == num_of_pages_of_file) {
											// This is the last page of the file, last iteration of pass 0

											// Hide new runs container
											hide_runs((animate ? undefined : 0), true);
											// For each record, snap it to its runs container position (along with its grayed copy)
											let pos_x = $("#runs-container .block").offset().left;
											snap_all_records_to_horizontal_position(pos_x, num_of_pages_of_file);

											// Delete (eventually present) grayed copies of records in the #runs-container
											delete_records_grayed_copies("#runs-container");

											show_runs((animate ? undefined : 0));

											// Reset runs
											let num_of_runs_to_produce = Math.ceil(num_of_pages_of_file / num_of_frames_in_buffer);
											for (let i = 0; i < num_of_runs_to_produce; i++) {
												let run_number = i + 1;
												set_single_run(run_number, num_of_pages_per_run);
												show_single_run(run_number, 0, (animate ? undefined : 0));
											}
										}
									}

									move_page_to_run(past_page_number, run_number_2, run_page_number_2, 0, (animate ? undefined : 0));
								},
								duration: function () {
									return normal_delay() + pause_in_between_animation_phases
								},
							});
						}
					}
				}

				// Update actual records list ("all_records" list)
				// i.e. for each group of "num_of_records_per_page * num_of_frames_in_buffer" records, sort them based on their value
				let new_records_list = [];
				for (let i = 0; i < num_of_records_per_page * num_of_frames_in_buffer; i++) {
					let start_index = i * num_of_records_per_page * num_of_frames_in_buffer;
					let end_index = (i + 1) * num_of_records_per_page * num_of_frames_in_buffer;
					if (end_index > all_records.length) end_index = all_records.length;
					let records_of_page = all_records.slice(start_index, end_index);
					records_of_page.sort(function (a, b) { return a.value - b.value; });
					new_records_list = new_records_list.concat(records_of_page);
				}
				all_records = new_records_list.slice();
				assign_file_pages_and_numbers_to_records_list_based_on_order();
				if (LOG_DEBUG) console.log(" ALL RECORDS (after pass 0 of k-way) ");
				if (LOG_DEBUG) console.log(all_records);

			}

			// Populate animation for the replacement selection algorithm
			function build_replacement_selection_pass_0() {

				let pass_number_to_set = 0;

				function get_input_frame_records() {
					// Get the list of records in the "all_records_in_frame_buffer" list which have a "queue_type" of "queue_types.queue_1_records"
					let records = all_records_in_frame_buffer.filter(function (record) {
						return record.queue_type == queue_types.input_frame;
					});
					return records;
				}

				function get_queue_1_records() {
					// Get the list of records in the "all_records_in_frame_buffer" list which have a "queue_type" of "queue_types.queue_1_records"
					let records = all_records_in_frame_buffer.filter(function (record) {
						return record.queue_type == queue_types.queue_1_records;
					});
					return records;
				}

				function get_queue_2_records() {
					// Get the list of records in the "all_records_in_frame_buffer" list which have a "queue_type" of "queue_types.queue_1_records"
					let records = all_records_in_frame_buffer.filter(function (record) {
						return record.queue_type == queue_types.queue_2_records;
					});

					return records;
				}

				/**
				 * @description removes a record from the "all_records_in_frame_buffer" list, only if the record has type "record_obj.queue_type"
				 * equal to the given one, then returns true if the record was removed, false otherwise.
				 */
				function remove_record_from_records_list(record_obj, queue_type) {
					let index_of_record = all_records_in_frame_buffer.findIndex(function (record) {
						return record.queue_type == queue_type && record.page_number_in_file == record_obj.page_number_in_file && record.record_number_in_page_of_file == record_obj.record_number_in_page_of_file;
					});
					if (index_of_record != -1) {
						// Change subsequent records slot numbers
						// 	i.e. move all subsequent records, hence all records with a slot number greater than the one removed, one slot up, hence decrease the slot number by 1
						for (let i = 0; i < all_records_in_frame_buffer.length; i++) {
							if (all_records_in_frame_buffer[i].slot_number > all_records_in_frame_buffer[index_of_record].slot_number) {
								all_records_in_frame_buffer[i].slot_number -= 1;
							}
						}
						// Remove record from list
						all_records_in_frame_buffer.splice(index_of_record, 1);
					}
					else return false;
					return true;
				}

				/**
				 * @description changes the queue type of a record in the "all_records_in_frame_buffer" list to the new "record_obj.queue_type".
				 * @NOTE Also changes the actual slot number of the record itself and, if we are moving to Q1 (hence we are moving it at the end of Q1),
				 * pushes all records of Q2 by one slot down
				 */
				function change_record_queue_type(record_obj, new_queue_type) {
					let index_of_record = all_records_in_frame_buffer.findIndex(function (record) {
						return record.page_number_in_file == record_obj.page_number_in_file && record.record_number_in_page_of_file == record_obj.record_number_in_page_of_file;
					});
					if (index_of_record != -1) {
						// Change record slot number
						all_records_in_frame_buffer[index_of_record].slot_number = num_of_records_per_page + get_queue_1_records().length + (new_queue_type == queue_types.queue_1_records ? 0 : get_queue_2_records().length) + 1;
						// Change subsequent records (queue 2 records) slot numbers
						if (all_records_in_frame_buffer[index_of_record].queue_type == queue_types.input_frame && new_queue_type == queue_types.queue_1_records) {
							// Push all records of Q2 by one slot down
							for (let i = 0; i < all_records_in_frame_buffer.length; i++) {
								if (all_records_in_frame_buffer[i].queue_type == queue_types.queue_2_records) {
									all_records_in_frame_buffer[i].slot_number += 1;
								}
							}
						}
						// Change record queue type
						all_records_in_frame_buffer[index_of_record].queue_type = new_queue_type;
					}
					else return false;
					return true;
				}

				let records_counter_for_run = 0;

				// Create the first run (of 1 pages at start, then might expand to more pages)
				animation.push({
					play: function (animate = true) {
						set_single_run(1, 1);
						show_single_run(1, 0, (animate ? undefined : 0));
						create_records_grayed_copies("#file");
					},
					phase_info: {
						code_line_offset: 0,
						code_line: [1],
						pass_number: pass_number_to_set,
						io_operations: 0,
						description: function () {
							return "Creating the first run <b>R1</b> (initially with one page) in secondary storage.";
						}
					},
					rollback: function (animate = false) {
						show_single_run(1, 0, (animate ? undefined : 0));
						create_records_grayed_copies("#file");

					},
					duration: function () {
						return in_buffer_normal_delay() + pause_in_between_animation_phases
					},
				});

				/**
				 * @description records which are NOT in the input frame (nor in the output frame)
				 */
				let all_records_in_frame_buffer = [];
				let records_in_output_frame = [];

				let final_written_records = [
					// {
					// 	value: 0,
					// 	page_in_file: 0,
					// 	number_in_page_of_file: 0,
					// }
				];

				let queue_types = {
					input_frame: 0,
					queue_1_records: 1,
					queue_2_records: 2,
				}

				// Bring first page of R in input frame F1
				animation.push({
					play: function (animate = true) {
						move_page_to_frame(1, 1, 0, (animate ? undefined : 0));

						$("#frame-buffer").addClass("pass-zero");
					},
					phase_info: {
						code_line_offset: 0,
						code_line: [2],
						pass_number: pass_number_to_set,
						io_operations: 1,
						description: function () {
							return "Loading first page of <b>R</b> in input frame <b>F1</b> (in main memory).";
						}
					},
					rollback: function (animate = false) {
						// Does nothing now...
					},
					duration: function () {
						return normal_delay() + pause_in_between_animation_phases
					},
				});
				// Add records in "all_records_in_frame_buffer"
				for (let record_num = 1; record_num <= num_of_records_per_page; record_num++) {
					let record = get_record(1, record_num);
					if (record != null && record != undefined) {
						let record_obj = {
							page_number_in_file: 1,
							record_number_in_page_of_file: record_num,
							queue_type: queue_types.input_frame,
							slot_number: record_num,
							value: parseInt(record.attr("value"))
						}
						all_records_in_frame_buffer.push(record_obj);
					}
				}

				let loaded_pages = 1;

				// Bring next M-2 pages of R in input frame F2, F3, ..., FM-1
				let num_of_pages_to_load = Math.min(num_of_available_frames - 1, num_of_pages_of_file - 1);

				for (let page_n = 2; page_n <= num_of_pages_to_load + 1; page_n++) {
					// Add records in "records_in_normal_frames_of_buffer"
					for (let record_num = 1; record_num <= num_of_records_per_page; record_num++) {
						let record = get_record(page_n, record_num);
						let record_slot_number = (page_n - 1) * num_of_records_per_page + record_num;
						if (record != null && record != undefined) {
							let record_obj = {
								page_number_in_file: page_n,
								record_number_in_page_of_file: record_num,
								queue_type: queue_types.queue_1_records,
								slot_number: record_slot_number,
								value: parseInt(record.attr("value"))
							}
							all_records_in_frame_buffer.push(record_obj);
						}
					}

					// Bring next of the M-2 pages in the buffer (in frames from F2 onwards)
					animation.push({
						play: function (animate = true) {
							// Move page to frame
							move_page_to_frame(page_n, page_n, 0, (animate ? undefined : 0));
						},
						phase_info: {
							code_line_offset: 0,
							code_line: [3],
							pass_number: pass_number_to_set,
							io_operations: 1,
							description: function () {
								let frame_numbers_to_consider = [];
								for (let i = 2; i <= num_of_pages_to_load + 1; i++) frame_numbers_to_consider.push(i);
								return "Loading next " + (num_of_pages_to_load > 1 ? ("<b>" + num_of_pages_to_load + "</b> pages") : "page") + " of <b>R</b> in buffer" + (num_of_pages_to_load > 1 ? "s" : "") + " <b>F" + frame_numbers_to_consider.join("</b>, <b>F") + "</b> (in main memory), which initially represents <b>Q1</b>.";
							}
						},
						rollback: function (animate = false) {
							// Does nothing now...
						},
						duration: function () {
							return normal_delay() + pause_in_between_animation_phases
						},
					});

					loaded_pages++;
				}

				// "Set" queues Q1 and Q2
				animation.push({
					play: function (animate = true) {
						// Make first record of queue 1 (i.e. first record of 2nd page) active
						get_record(2, 1).addClass("first-active");
					},
					phase_info: {
						code_line_offset: 0,
						code_line: [4, 5],
						pass_number: pass_number_to_set,
						io_operations: 0,
						description: function () {
							return "Initializing queues <b>Q1</b> containing records in frames from <b>F1</b> to <b>F" + num_of_available_frames + "</b>, and <b>Q2</b> to an empty queue.";
						}
					},
					rollback: function (animate = false) {
						// Does nothing now...
					},
					duration: function () {
						return normal_delay() + pause_in_between_animation_phases
					},
				});

				// This "max_iterations" may be deleted, used only to avoid infinite loops
				let max_iterations = num_of_records_of_file * 5;
				let last_created_run_number = 1;
				let next_run_page_number = 1;
				while ((get_queue_1_records().length > 0 || get_queue_2_records().length > 0 || get_input_frame_records().length > 0) && max_iterations-- > 0) {

					let all_records_in_frame_buffer_for_this_iteration_1 = [];
					all_records_in_frame_buffer.forEach(function (record) {
						all_records_in_frame_buffer_for_this_iteration_1.push(copy_record_obj(record));
					});

					if (get_queue_1_records().length == 0) {

						let new_run_number_for_this_iteration_at_start = last_created_run_number + 1;
						let run_page_number_for_this_iteration_at_start = next_run_page_number;

						if (get_queue_2_records().length > 0) {
							// Move all records in q2 to q1 (i.e. also change records appearance, opacity)
							animation.push({
								play: function (animate = true) {
									scroll_to_focused_element($("#file"));
									// Change records appearance, opacity (set as inactive)
									for (let i = 0; i < all_records_in_frame_buffer_for_this_iteration_1.length; i++) {
										let record = all_records_in_frame_buffer_for_this_iteration_1[i];
										if (record.queue_type == queue_types.queue_2_records) {
											let record_element = get_record(record.page_number_in_file, record.record_number_in_page_of_file);
											record_element.removeClass("inactive");
											record_element.removeClass("first-inactive");

											if (record.slot_number == num_of_records_per_page + 1) {
												record_element.addClass("first-active");
											}
										}
									}
								},
								phase_info: {
									code_line_offset: 0,
									code_line: [7, 8],
									pass_number: pass_number_to_set,
									io_operations: 0,
									description: function () {
										return "Queue <b>Q1</b> is empty: moving all records from <b>Q2</b> to <b>Q1</b>.";
									}
								},
								rollback: function (animate = false) {
									// Does nothing now...
								},
								duration: function () {
									return in_buffer_normal_delay() + pause_in_between_animation_phases
								},
							});
							// Actually move records in list (hence change their queue type, and slot maybe?)
							for (let i = 0; i < all_records_in_frame_buffer.length; i++) {
								let record = all_records_in_frame_buffer[i];
								if (record.queue_type == queue_types.queue_2_records) {
									change_record_queue_type(record, queue_types.queue_1_records);
								}
							}
						}

						// Empty output frame (if needed)
						if (records_in_output_frame.length > 0) {

							let run_number_for_this_iteration_start = last_created_run_number;
							let run_page_number_for_this_iteration_start = next_run_page_number;

							let records_in_outut_frame_for_this_run_start = [];
							records_in_output_frame.forEach(function (record) {
								records_in_outut_frame_for_this_run_start.push(copy_record_obj(record));
							});

							// We need to create a new run page
							if (next_run_page_number > 1) {
								animation.push({
									play: function (animate = true) {
										set_single_run(run_number_for_this_iteration_start, run_page_number_for_this_iteration_start);
										show_single_run(run_number_for_this_iteration_start, 0, 0);
									},
									phase_info: {
										code_line_offset: 0,
										code_line: [9, 10],
										pass_number: pass_number_to_set,
										io_operations: 0,
										description: function () {
											return "Creating a new page <b>P" + run_page_number_for_this_iteration_start + "</b> for run <b>R" + run_number_for_this_iteration_start + "</b> to store the records of the output frame <b>F" + num_of_frames_in_buffer + "</b>.";
										}
									},
									rollback: function (animate = false) {
										// Does nothing now...
									},
									duration: function () {
										return normal_delay() + pause_in_between_animation_phases
									},
								});
							}

							// Move all records currently in output frame to the run
							animation.push({
								play: function (animate = true) {
									// Move all records currently in output frame to the run
									let delay = 0;
									if (get_run_page(run_number_for_this_iteration_start, run_page_number_for_this_iteration_start) == null) {
										if (LOG_DEBUG) console.log("WARNING: Run page we are trying to move to is null: this is probably because of rollbacks (step backwards) of animation phases, which set the run to a run having a different number of pages...\nTo fix this, we are re-setting the run to have the correct number of pages");
										set_single_run(run_number_for_this_iteration_start, run_page_number_for_this_iteration_start);
										delay = STEP_DURATION * 0.2;
									}
									records_in_outut_frame_for_this_run_start.forEach(function (record, index) {
										let slot_in_run = index + 1;
										move_record_to_run(record.page_number_in_file, record.record_number_in_page_of_file,
											run_number_for_this_iteration_start, run_page_number_for_this_iteration_start, delay, (animate ? undefined : 0), false, slot_in_run);

										scroll_to_focused_element(get_run_page(run_number_for_this_iteration_start, run_page_number_for_this_iteration_start));
									});
								},
								phase_info: {
									code_line_offset: 0,
									code_line: [9, 10],
									pass_number: pass_number_to_set,
									io_operations: 1,
									description: function () {
										return "Writing records of the output frame <b>F" + num_of_frames_in_buffer + "</b> to page <b>P" + run_page_number_for_this_iteration_start + "</b> of run <b>R" + run_number_for_this_iteration_start + "</b>.";
									}
								},
								rollback: function (animate = false) {
									// Does nothing now...
								},
								duration: function () {
									return normal_delay() + pause_in_between_animation_phases
								},
							});

							records_counter_for_run += records_in_output_frame.length;

							// Add records in output frame (plus padding if needed) to the final written records list (before emptying the output records list)
							let final_written_records_last_written_page = 0;
							if (final_written_records.length > 0) final_written_records_last_written_page = final_written_records[final_written_records.length - 1].page_in_file;
							for (let i = 0; i < num_of_records_per_page; i++) {
								let record_page_in_file = final_written_records_last_written_page + 1;
								let rec_obj = {
									value: -1,
									page_in_file: record_page_in_file,
									number_in_page_of_file: i + 1
								}
								if (i < records_in_output_frame.length) {
									rec_obj.value = records_in_output_frame[i].value;
								}
								final_written_records.push(rec_obj);
							}

							next_run_page_number += 1;
							records_in_output_frame = [];
						}

						// Create a new run (of 1 pages at start, then might expand to more pages)
						animation.push({
							play: function (animate = true) {
								set_single_run(new_run_number_for_this_iteration_at_start, 1);
								show_single_run(new_run_number_for_this_iteration_at_start, 0, (animate ? undefined : 0));
							},
							phase_info: {
								code_line_offset: 0,
								code_line: [11],
								pass_number: pass_number_to_set,
								io_operations: 0,
								description: function () {
									return "Run <b>R" + (new_run_number_for_this_iteration_at_start - 1) + "</b> is complete (with <b>" + run_page_number_for_this_iteration_at_start + "</b> pages): creating a new run <b>R" + new_run_number_for_this_iteration_at_start + "</b>.";
								}
							},
							rollback: function (animate = false) {
								// Does nothing now...
							},
							duration: function () {
								return in_buffer_normal_delay() + pause_in_between_animation_phases
							},
						});

						created_runs_records.push(records_counter_for_run);
						records_counter_for_run = 0;

						last_created_run_number += 1;
						next_run_page_number = 1;
					}

					// Create a copy of the "all_records_in_frame_buffer" list
					// Trick used because for the animationo, the list actually retrieves only its last state (hence the empty list at the end) during the actual execution of the animation
					function copy_record_obj(record_to_copy) {
						return {
							page_number_in_file: record_to_copy.page_number_in_file,
							record_number_in_page_of_file: record_to_copy.record_number_in_page_of_file,
							queue_type: record_to_copy.queue_type,
							slot_number: record_to_copy.slot_number,
							value: record_to_copy.value
						};
					}

					// Find minium record r1 in Q1 (and set it to be pointed)
					let r1 = get_queue_1_records().reduce(function (prev, curr) {
						return prev.value < curr.value ? prev : curr;
					});
					let record_r1 = get_record(r1.page_number_in_file, r1.record_number_in_page_of_file);	// actual record element (in the page)
					animation.push({
						play: function (animate = true) {
							scroll_to_focused_element($("#file"));
							record_r1.addClass("pointed");
						},
						phase_info: {
							code_line_offset: 0,
							code_line: [12],
							pass_number: pass_number_to_set,
							io_operations: 0,
							description: function () {
								return "The mimium record of queue <b>Q1</b> is " + get_record_description_string(record_r1, "r1") + ".";
							}
						},
						rollback: function (animate = false) {
							// Does nothing now...
						},
						duration: function () {
							return in_buffer_normal_delay() + pause_in_between_animation_phases
						},
					});

					let removed_record_slot_number = r1.slot_number;
					let current_num_of_records_in_output_frame = records_in_output_frame.length;

					let input_frame_is_empty = get_input_frame_records().length == 0;

					let more_pages_to_load = loaded_pages + 1 <= num_of_pages_of_file;

					// Move r1 in output frame
					animation.push({
						play: function (animate = true) {

							move_record_to_new_slot_in_another_frame(r1.page_number_in_file, r1.record_number_in_page_of_file, num_of_available_frames + 1, current_num_of_records_in_output_frame + 1, (animate ? undefined : 0));

							if (input_frame_is_empty && !more_pages_to_load) {
								record_r1.removeClass("pointed");
							}

							record_r1.removeClass("first-active");
							// Find first record in Q1 (i.e. record in Q1 with the minimum slot number) and set it as first-active
							let remaining_records_in_q1 = all_records_in_frame_buffer_for_this_iteration_1.filter(function (record) {
								return (record.page_number_in_file != r1.page_number_in_file || record.record_number_in_page_of_file != r1.record_number_in_page_of_file) &&
									record.queue_type != queue_types.input_frame;
							});
							if (remaining_records_in_q1.length > 0) {
								let first_record_obj_in_q1 = remaining_records_in_q1.reduce(function (prev, curr) {
									return prev.slot_number < curr.slot_number ? prev : curr;
								});
								let first_record_in_q1 = get_record(first_record_obj_in_q1.page_number_in_file, first_record_obj_in_q1.record_number_in_page_of_file);
								first_record_in_q1.addClass("first-active");

								scroll_to_focused_element(get_frame(num_of_available_frames + 1));
							}

							for (let i = 0; i < all_records_in_frame_buffer_for_this_iteration_1.length; i++) {
								record = all_records_in_frame_buffer_for_this_iteration_1[i];
								if (record.slot_number > removed_record_slot_number && record.queue_type != queue_types.input_frame) {
									let new_slot_number = record.slot_number - 1;
									let record_frame_number = Math.ceil(new_slot_number / num_of_records_per_page);
									let record_slot_number = (new_slot_number - 1) % num_of_records_per_page + 1;
									move_record_to_new_slot_in_another_frame(record.page_number_in_file, record.record_number_in_page_of_file, record_frame_number, record_slot_number, (animate ? undefined : 0));
								}
							};

						},
						phase_info: {
							code_line_offset: 0,
							code_line: [13],
							pass_number: pass_number_to_set,
							io_operations: 0,
							description: function () {
								return "Moving min record " + get_record_description_string(record_r1, "r1") + " of queue <b>Q1</b> in output frame <b>F" + num_of_frames_in_buffer + "</b>.";
							}
						},
						rollback: function (animate = false) {
							// Does nothing now...
						},
						duration: function () {
							return in_buffer_normal_delay() + pause_in_between_animation_phases
						},
					});
					// Remove found record r1 from the "all_records_in_frame_buffer" list (i.e. from queue 1)
					remove_record_from_records_list(r1, queue_types.queue_1_records);

					// Move record in output frame list of records
					records_in_output_frame.push(r1);

					let all_records_in_frame_buffer_for_this_iteration_2 = [];
					all_records_in_frame_buffer.forEach(function (record) {
						all_records_in_frame_buffer_for_this_iteration_2.push(copy_record_obj(record));
					});

					// If F1 is empty
					if (get_input_frame_records().length == 0) {

						// If F1 is empty (hence no more records in input frame), load next page of R in input frame F1 (if possble)

						let page_to_load = loaded_pages + 1;
						if (page_to_load <= num_of_pages_of_file) {
							// Bring next page of R in input frame F1
							animation.push({
								play: function (animate = true) {
									move_page_to_frame(page_to_load, 1, 0, (animate ? undefined : 0));
								},
								phase_info: {
									code_line_offset: 0,
									code_line: [14, 15],
									pass_number: pass_number_to_set,
									io_operations: 1,
									description: function () {
										return "Input frame <b>F1</b> is empty: loading next page <b>P" + page_to_load + "</b> of <b>R</b> in input frame (in main memory).";
									}
								},
								rollback: function (animate = false) {
									// Does nothing now...
								},
								duration: function () {
									return normal_delay() + pause_in_between_animation_phases
								},
							});
							// Add records in "all_records_in_frame_buffer"
							for (let record_num = 1; record_num <= num_of_records_per_page; record_num++) {
								let record = get_record(page_to_load, record_num);
								if (record != null && record != undefined) {
									let record_obj = {
										page_number_in_file: page_to_load,
										record_number_in_page_of_file: record_num,
										queue_type: queue_types.input_frame,
										slot_number: record_num,
										value: parseInt(record.attr("value"))
									}
									all_records_in_frame_buffer.push(record_obj);
								}
							}

							loaded_pages += 1;
						}
					}

					// Check if F1 is NOT empty (hence we it was actually already full or we just loaded a new page from file because it was empty)
					if (get_input_frame_records().length > 0) {
						// Find r2 = min record in Q1 (and set it to be pointed)
						let r2 = get_input_frame_records()[0];	// record object
						let record_r2 = get_record(r2.page_number_in_file, r2.record_number_in_page_of_file); // actual record element (in the page)
						animation.push({
							play: function (animate = true) {

								record_r2.addClass("pointed");

								scroll_to_focused_element(record_r2);
							},
							phase_info: {
								code_line_offset: 0,
								code_line: [16, 17],
								pass_number: pass_number_to_set,
								io_operations: 0,
								description: function () {
									return "The next record of the input frame <b>F1</b> is " + get_record_description_string(record_r2, "r2") + ".";
								}
							},
							rollback: function (animate = false) {
								// Does nothing now...
							},
							duration: function () {
								return in_buffer_normal_delay() + pause_in_between_animation_phases
							},
						});

						let q1_length = get_queue_1_records().length;	// Here because it changes with the while loop going before the animation plays
						let q2_length = get_queue_2_records().length;	// Here because it changes with the while loop going before the animation plays

						// Move r2 in Q1 (hence "last", next free slot of records in Q1)
						// If r2 > r1
						if (r2.value > r1.value) {
							// Move r2 in Q1 (hence "last", next free slot of records in Q1)
							// 		(should also then push the records in Q2 down to give space for r2)
							animation.push({
								play: function (animate = true) {

									let total_slot_to_move_to = num_of_records_per_page + q1_length + 1; // Global slot, from the first slot of F1, to move the record to (the bottom of the Q1)
									let frame_number_to_move_to = Math.ceil(total_slot_to_move_to / num_of_records_per_page);
									let record_number_to_move_to = (total_slot_to_move_to - 1) % num_of_records_per_page + 1;
									move_record_to_new_slot_in_another_frame(r2.page_number_in_file, r2.record_number_in_page_of_file, frame_number_to_move_to, record_number_to_move_to, (animate ? undefined : 0));

									record_r1.removeClass("pointed");
									record_r2.removeClass("pointed");

									scroll_to_focused_element(get_frame(frame_number_to_move_to));

									// Should push down all other records in Q2 by one slot
									for (let i = 0; i < all_records_in_frame_buffer_for_this_iteration_2.length; i++) {
										let record = all_records_in_frame_buffer_for_this_iteration_2[i];
										if (record.slot_number >= total_slot_to_move_to && record.queue_type == queue_types.queue_2_records) {
											let new_slot_number = record.slot_number + 1;
											let record_frame_number = Math.ceil(new_slot_number / num_of_records_per_page);
											let record_slot_number = (new_slot_number - 1) % num_of_records_per_page + 1;
											move_record_to_new_slot_in_another_frame(record.page_number_in_file, record.record_number_in_page_of_file, record_frame_number, record_slot_number, (animate ? undefined : 0));
										}
									};

								},
								phase_info: {
									code_line_offset: 0,
									code_line: [18, 19],
									pass_number: pass_number_to_set,
									io_operations: 0,
									description: function () {
										return "We have " + get_record_description_string(record_r1, "r1") + " &lt; " + get_record_description_string(record_r2, "r2") + ": moving <b>r2</b> from the input frame <b>F1</b> to queue <b>Q1</b>.";
									}
								},
								rollback: function (animate = false) {
									// Does nothing now...
								},
								duration: function () {
									return in_buffer_normal_delay() + pause_in_between_animation_phases
								},
							});
							// Move r2 from the input frame to Q1
							change_record_queue_type(r2, queue_types.queue_1_records);

						} else {
							// Move r2 in Q2 (at the end of Q2)
							animation.push({
								play: function (animate = true) {
									let total_slot_to_move_to = num_of_records_per_page + q1_length + q2_length + 1; // Global slot, from the first slot of F1, to move the record to (the bottom of the Q1)
									let frame_number_to_move_to = Math.ceil(total_slot_to_move_to / num_of_records_per_page);
									let record_number_to_move_to = (total_slot_to_move_to - 1) % num_of_records_per_page + 1;
									move_record_to_new_slot_in_another_frame(r2.page_number_in_file, r2.record_number_in_page_of_file, frame_number_to_move_to, record_number_to_move_to, (animate ? undefined : 0));
									record_r1.removeClass("pointed");
									record_r2.removeClass("pointed");

									// Set record to be "inactive" (indicating it is now in queue 2)
									record_r2.addClass("inactive");
									if (q2_length == 0) {
										record_r2.addClass("first-inactive");
									}

									scroll_to_focused_element(get_frame(frame_number_to_move_to));

								},
								phase_info: {
									code_line_offset: 0,
									code_line: [20, 21],
									pass_number: pass_number_to_set,
									io_operations: 0,
									description: function () {
										return "We have " + get_record_description_string(record_r1, "r1") + " &ge; " + get_record_description_string(record_r2, "r2") + ": moving <b>r2</b> from the input frame <b>F1</b> to queue <b>Q2</b>.";
									}
								},
								rollback: function (animate = false) {
									// Does nothing now...
								},
								duration: function () {
									return in_buffer_normal_delay() + pause_in_between_animation_phases
								},
							});
							// Move r2 from the input frame to Q2
							change_record_queue_type(r2, queue_types.queue_2_records);
						}

						let all_records_in_frame_buffer_for_this_iteration_3 = [];
						all_records_in_frame_buffer.forEach(function (record) {
							all_records_in_frame_buffer_for_this_iteration_3.push(copy_record_obj(record));
						});
					}

					let records_in_output_frame_for_this_run = [];
					records_in_output_frame.forEach(function (record) {
						records_in_output_frame_for_this_run.push(copy_record_obj(record));
					});

					let last_iteration_check = (get_queue_1_records().length == 0 && get_queue_2_records().length == 0 && get_input_frame_records().length == 0);

					// if output frame is full (or is not full but contains the very last frames of the file, hence must be emptied, meaning that the file has no more records)
					if (records_in_output_frame.length >= num_of_records_per_page || last_iteration_check) {

						let run_number_for_this_iteration = last_created_run_number;
						let run_page_number_for_this_iteration = next_run_page_number;

						// We need to create a second or higher page for the run
						if (next_run_page_number > 1) {
							// Show a new run page
							animation.push({
								play: function (animate = true) {
									set_single_run(run_number_for_this_iteration, run_page_number_for_this_iteration);
									show_single_run(run_number_for_this_iteration, 0, 0);
								},
								phase_info: {
									code_line_offset: 0,
									code_line: [22, 23],
									pass_number: pass_number_to_set,
									io_operations: 0,
									description: function () {
										return "Creating a new page <b>P" + run_page_number_for_this_iteration + "</b> for run <b>R" + run_number_for_this_iteration + "</b> to store the records of the output frame <b>F" + num_of_frames_in_buffer + "</b>.";
									}
								},
								rollback: function (animate = false) {
									// Does nothing now...
								},
								duration: function () {
									return normal_delay() + pause_in_between_animation_phases
								},
							});
						}

						// Move all records currently in output frame to the run
						animation.push({
							play: function (animate = true) {
								// Move all records in output frame to the run

								records_in_output_frame_for_this_run.forEach(function (record, index) {
									let slot_in_run = index + 1;
									move_record_to_run(record.page_number_in_file, record.record_number_in_page_of_file,
										run_number_for_this_iteration, run_page_number_for_this_iteration, 0, (animate ? undefined : 0), false, slot_in_run);

									scroll_to_focused_element(get_run_page(run_number_for_this_iteration, run_page_number_for_this_iteration));
								});
							},
							phase_info: {
								code_line_offset: 0,
								code_line: [23, 24],
								pass_number: pass_number_to_set,
								io_operations: 1,
								description: function () {
									return "Writing records of the output frame <b>F" + num_of_frames_in_buffer + "</b> to page <b>P" + run_page_number_for_this_iteration + "</b> of run <b>R" + run_number_for_this_iteration + "</b>.";
								}
							},
							rollback: function (animate = false) {
								// Does nothing now...
							},
							duration: function () {
								return normal_delay() + pause_in_between_animation_phases
							},
						});

						records_counter_for_run += records_in_output_frame.length;
						if (last_iteration_check) {
							created_runs_records.push(records_counter_for_run);
							records_counter_for_run = 0;
						}

						// Add records in output frame (plus padding if needed) to the final written records list (before emptying the output records list)
						let final_written_records_last_written_page = 0;
						if (final_written_records.length > 0) final_written_records_last_written_page = final_written_records[final_written_records.length - 1].page_in_file;
						for (let i = 0; i < num_of_records_per_page; i++) {
							let record_page_in_file = final_written_records_last_written_page + 1;
							let rec_obj = {
								value: -1,
								page_in_file: record_page_in_file,
								number_in_page_of_file: i + 1
							}
							if (i < records_in_output_frame.length) {
								rec_obj.value = records_in_output_frame[i].value;
							}
							final_written_records.push(rec_obj);
						}

						next_run_page_number += 1;
						records_in_output_frame = [];

					}
				}

				// Reparent file recrds (create new hidden file pages if needed)
				let runs_created_records_at_end_of_pass_0 = created_runs_records.slice();
				animation.push({
					play: function (animate = true) {

						// Changing layout of the buffer
						$("#frame-buffer").removeClass("single-column");
						$("#frame-buffer").removeClass("pass-zero");

						// Reparent records of file
						let runs_pages = $("#runs-container .block");

						let list_of_runs_tops = [];
						let file_hidden_page_html = '<div class="block invisible"><div class="block-name"></div></div>';

						scroll_to_focused_element($("#file"));

						for (let i = 0; i < runs_pages.length; i++) {
							let page_number = i + 1;
							// Add new pages of file to store the exceeding page numbers records (since the number of pages of each created run may be more than the file's number of pages)
							if (page_number > num_of_pages_of_file) {
								$('#file .blocks-container').first().append(file_hidden_page_html);

							}
							let page = get_file_page(page_number);
							list_of_runs_tops.push($(runs_pages[i]).offset().top - page.offset().top);
						}

						setTimeout(() => {
							reparent_all_records_based_on_top_position(list_of_runs_tops, runs_created_records_at_end_of_pass_0);
						}, ANIMATION_STEP_MULTIPLIER);
					},
					phase_info: {
						code_line_offset: 0,
						code_line: [25],
						pass_number: pass_number_to_set,
						io_operations: 0,
						description: function () {
							return "<b>Pass 0</b> of the " + algorithm_type_string_map[selected_algorithm_type] + " algorithm is complete (created <b>" + last_created_run_number + "</b> runs): starting <b>pass 1</b>.";
						}
					},
					rollback: function (animate = false) {
						// Does nothing now...

						// Hide new runs container
						hide_runs((animate ? undefined : 0), true);
						// For each record, snap it to its runs container position (along with its grayed copy)
						let actual_num_of_pages_of_file = $("#runs-container .block").length;
						let pos_x = $("#runs-container .block").offset().left;
						snap_all_records_to_horizontal_position(pos_x, actual_num_of_pages_of_file);

						// Delete grayed copies of records in the #runs-container (may not be needed, but just in case)
						delete_records_grayed_copies("#runs-container");
					},
					duration: function () {
						return normal_delay() + pause_in_between_animation_phases
					},
				});

				all_records = final_written_records.slice();
				if (LOG_DEBUG) console.log(" ALL RECORDS (after pass 0 of replacement_selection) ");
				if (LOG_DEBUG) console.log(all_records);

			}

			// Pass 0 -----------------------------------------------------------------------------------------------------------------------
			// Move to each page to initial frame, then add phase to sort objects, then move back to sorted runs
			if (selected_algorithm_type == algorithm_type.two_way) {
				// Build animations for the 2-way algorithm
				build_2_way_pass_0();
			} else if (selected_algorithm_type == algorithm_type.k_way) {
				// Build animations for the k-way algorithm
				build_k_way_pass_0();
			} else if (selected_algorithm_type == algorithm_type.replacement_selection) {
				// Replacement selection algorithm
				build_replacement_selection_pass_0();
			}

			let pass_counter = 0;

			function build_i_passes() {

				// Pass i -----------------------------------------------------------------------------------------------------------------------
				let immediate_termination_condition = false;
				immediate_termination_condition ||= (selected_algorithm_type == algorithm_type.two_way && num_of_pages_of_file == 1);
				immediate_termination_condition ||= (selected_algorithm_type == algorithm_type.k_way && num_of_pages_of_file <= num_of_frames_in_buffer);
				immediate_termination_condition ||= (selected_algorithm_type == algorithm_type.replacement_selection && created_runs_records.length == 1);

				if (num_of_pages_of_file >= 1 && !immediate_termination_condition) {
					// Move each run to frames of buffer, i.e. move M-1 runs to frames of buffer (where M is number of available frames)

					// Build the created runs record for the two way and k-way algorithms (since for them the created_runs_records list is empty at the start of the algorithm)
					if (created_runs_records.length == 0) {
						let num_of_runs_at_start = 0;
						let num_of_pages_of_each_run_at_start = 0;
						if (selected_algorithm_type == algorithm_type.two_way) {
							num_of_runs_at_start = num_of_pages_of_file;
							num_of_pages_of_each_run_at_start = 1;
						} else if (selected_algorithm_type == algorithm_type.k_way) {
							num_of_runs_at_start = Math.ceil(num_of_pages_of_file / num_of_frames_in_buffer);
							num_of_pages_of_each_run_at_start = num_of_frames_in_buffer;
						}


						for (let i = 0; i < num_of_runs_at_start; i++) {
							if (i < num_of_runs_at_start - 1) created_runs_records.push(num_of_pages_of_each_run_at_start * num_of_records_per_page);
							else created_runs_records.push((num_of_records_of_file - 1) % (num_of_pages_of_each_run_at_start * num_of_records_per_page) + 1);
						}
					}

					// NOTE: Maintained by the animation functions (populated by the actual start function of the phase itself)
					let output_frame_records = [
						// {
						// 	record_page_number: ?,
						// 	record_number: ?,
						// 	frame_number: ?,
						// 	value: ?,
						//}
					];
					let actual_num_of_records_in_output_frame = 0;

					// let actual_pointed_records = [];

					// Iterating over passes (pass is "pass_i")
					for (let pass_i = 1; pass_i <= (max_num_of_needed_passes - 1) && created_runs_records.length != 1; pass_i++) {

						let pass_number_to_set = pass_i;

						pass_counter += 1;

						// Records written in the runs container at the end of this pass
						let final_written_records = [
							// {
							// 	value: 0,
							// 	page_in_file: 0,
							// 	number_in_page_of_file: 0,
							// }
						];

						let new_run_page_number = 1;

						// Iterating over passes (pass is "pass_i")

						// Set to be an array of elements representing each page of the runs (flattened), with each element being the number of records of the page
						let pages_of_each_run_at_start = [];
						let temp_list = [];
						for (let i = 0; i < created_runs_records.length; i++) {
							let pages_of_this_run = Math.ceil(created_runs_records[i] / num_of_records_per_page);
							for (let j = 0; j < pages_of_this_run; j++) {
								if (j < pages_of_this_run - 1) temp_list.push(num_of_records_per_page);
								else temp_list.push((created_runs_records[i] - 1) % num_of_records_per_page + 1);
							}
							// Push the temp_list as an actual list to the pages_of_each_run_at_start list
							pages_of_each_run_at_start.push(temp_list);
							temp_list = [];
						}

						// Build this array to be similar to the one above, but with runs being the runs that will be produced after merging "num_of_available_frames" runs, hence each element is the number of records of the page of the run
						let pages_of_each_run_at_end = [];
						for (let i = 0; i < created_runs_records.length; i += num_of_available_frames) {
							let final_records_of_this_end_run = 0;
							for (let j = 0; j < num_of_available_frames; j++) {
								if (i + j < created_runs_records.length) {
									final_records_of_this_end_run += created_runs_records[i + j];
								}
							}
							let needed_pages_to_store_this_run = Math.ceil(final_records_of_this_end_run / num_of_records_per_page);
							// Create the runs pages list (i.e. list of number of records for each run)
							for (let j = 0; j < needed_pages_to_store_this_run; j++) {
								if (j < needed_pages_to_store_this_run - 1) temp_list.push(num_of_records_per_page);
								else temp_list.push((final_records_of_this_end_run - 1) % num_of_records_per_page + 1);
							}
							// Push the temp_list as an actual list to the pages_of_each_run_at_start list
							pages_of_each_run_at_end.push(temp_list);
							temp_list = [];
						}

						let actual_num_of_pages_of_file = pages_of_each_run_at_start.flat().length;

						function get_run_number_and_run_page_number_from_page_number(file_page_number, use_end_runs = false) {
							let file_page_number_counter = 0;
							let run_number = 0;
							let run_page_number = 0;
							let pages_of_each_run = (use_end_runs ? pages_of_each_run_at_end : pages_of_each_run_at_start);
							for (let i = 0; i < pages_of_each_run.length; i++) {
								for (let j = 0; j < pages_of_each_run[i].length; j++) {
									file_page_number_counter += 1;
									if (file_page_number_counter == file_page_number) {
										run_number = i + 1;
										run_page_number = j + 1;
										return [run_number, run_page_number];
									}
								}
							}
							return [run_number, run_page_number];
						}

						function get_page_number_from_run_number_and_run_page_number(run_number, run_page_number, use_end_runs = false) {
							let file_page_number = 0;
							for (let i = 0; i < run_number - 1; i++) {
								if (use_end_runs) file_page_number += pages_of_each_run_at_end[i].length;
								else file_page_number += pages_of_each_run_at_start[i].length;
							}
							file_page_number += run_page_number;
							return file_page_number;
						}

						pass_number_to_set = pass_i;

						/**
						* @description List of objects having attributes:
						*
						* ```
						* {
						*  record_page_number: 0,
						*  record_number: 0,
						*  frame_number: 0,
						*  value: 0,
						* }
						* ```
						*/
						let actual_pointed_records = [];

						let records_runs_grayed_copies_container_html_content_for_this_pass = "";

						let created_runs_records_at_start_of_this_pass = [];
						created_runs_records.forEach(num_of_records => {
							created_runs_records_at_start_of_this_pass.push(num_of_records);
						});

						// Show new runs container (and moves & then snaps records to the run pages n which they are since showing the run moves them) ----------------------------------------------------------------------------------------------------
						animation.push({
							play: function (animate = true) {

								if (LOG_DEBUG) console.log(">>>> Pass " + pass_i + ") Num of runs at end of pass " + pass_i + ": " + pages_of_each_run_at_end.length + " (" + pages_of_each_run_at_end[0].length + " pages each)");

								// Reset all runs to the actual original number of pages and runs for each run at start
								for (let i = 0; i < pages_of_each_run_at_start.length; i++) {
									// Recreate pages of each run as they were at the start of the pass
									// "pages_of_each_run_at_start" may for example have the structure:  [[5,5,2], [5,2], [3], [5,3]]  (i.e. 4 runs)
									let this_run_number = i + 1;
									let num_of_pages_of_this_run = pages_of_each_run_at_start[i].length;
									set_single_run(this_run_number, num_of_pages_of_this_run);
									show_single_run(this_run_number, 0, (animate ? undefined : 0));
								}

								// Show new runs container
								scroll_to_focused_element(get_file_page(1));

								// "Show" new runs container (i.e. makes space for it)
								show_runs((animate ? STEP_DURATION * 0.90 : 0), true);

								// Move each record by a certain amount left
								for (i = 0; i < actual_num_of_pages_of_file; i++) {
									let page_number = i + 1;
									for (j = 0; j < num_of_records_per_page; j++) {
										let record_number = j + 1;
										if (get_record(page_number, record_number) != null) {
											// NOTE: should add up to: 49.5
											let adjustment_factor = 1.5;
											move_record_by_pixels(page_number, record_number, adjustment_factor * ($("#secondary-storage-container .content").width() / 521.625) + (49.5 - adjustment_factor)), 0, 0, (animate ? STEP_DURATION * 0.90 : 0);
										}
									}
								}

								setTimeout(() => {
									// Snap each record to the run page
									for (i = 0; i < actual_num_of_pages_of_file; i++) {
										let page_number = i + 1;
										for (j = 0; j < num_of_records_per_page; j++) {
											let record_number = j + 1;
											if (get_record(page_number, record_number) != null) {
												// Snap record to the run page
												let run_number = get_run_number_and_run_page_number_from_page_number(page_number)[0];
												let run_page_number = get_run_number_and_run_page_number_from_page_number(page_number)[1];
												let delta = $(get_run_page(run_number, run_page_number)).offset().left - $(get_record(page_number, record_number)).offset().left;
												move_record_by_pixels(page_number, record_number, delta, 0, 0, 0);


												// Create grayed copy of records in the runs container
												setTimeout(() => {
													create_single_record_grayed_copy(get_record(page_number, record_number), "#runs-container");
												}, STEP_DURATION * 0.3);
											}
										}
									}

								}, (animate ? STEP_DURATION * 0.90 : 0) + STEP_DURATION * 0.3);

							},
							phase_info: {
								code_line_offset: highlight_lines_offset,
								code_line: [7, 8],
								pass_number: pass_number_to_set,
								io_operations: 0,
								description: function () {
									let append_string = "";
									if (selected_algorithm_type == algorithm_type.replacement_selection && pass_i == 1) {
										append_string = " (note that the layout of the buffer changed for visualization purposes, but the buffer still has <b>" + num_of_frames_in_buffer + "</b> frames)";
									}
									return "Starting <b>pass i=" + pass_i + "</b> of the <b>" + algorithm_type_string_map[selected_algorithm_type] + "</b> algorithm" + append_string + ".";
								}
							},
							rollback: function (animate = false) {
								// Show runs
								show_runs((animate ? undefined : 0), true);

								// Undo next phase (undo move of first run of first group of runs to the first frame, i.e. R1-P1 to F1)
								move_page_to_run(1, 1, 1, 0, (animate ? undefined : 0));
							},
							duration: function () {
								return normal_delay() * 1.75 + pause_in_between_animation_phases
							},
						});

						let all_records_list_at_start_of_this_pass = [];
						all_records.forEach(record => {
							all_records_list_at_start_of_this_pass.push({ ...record });
						});

						// Build sorting tree of pass 0
						if (pass_i == 1) {
							build_single_tree_pass(0, all_records_list_at_start_of_this_pass, pages_of_each_run_at_start);
						}

						// Iterate over runs (consider a group of M-1 runs at each iteration, then consider each of its records)
						let num_of_groups_of_m_minus_1_runs_for_this_pass = Math.ceil(pages_of_each_run_at_start.length / num_of_available_frames); 	// integer from 1 to ...
						for (let group_of_runs_index = 0; group_of_runs_index < num_of_groups_of_m_minus_1_runs_for_this_pass; group_of_runs_index++) {
							// Considering a group of (M-1) runs (where M is the number of total frames)

							let runs_numbers = []; // the numbers of the "num_of_available_frames" (i.e. m-1) we are considering for this group (e.g. [3,4,5] for 4 buffer frames while considering runs 3, 4 and 5)
							for (let run_number = group_of_runs_index * num_of_available_frames + 1; run_number <= pages_of_each_run_at_start.length && run_number <= (group_of_runs_index + 1) * num_of_available_frames; run_number++) {
								runs_numbers.push(run_number);
							}

							runs_numbers.forEach(run_number => {
								let page_number = get_page_number_from_run_number_and_run_page_number(run_number, 1); // Page number in the file
								let frame_number = (run_number - 1) % num_of_available_frames + 1;
								if (page_number <= actual_num_of_pages_of_file) {
									// Move first page of each run to the first frame ===============================================================================
									animation.push({
										play: function (animate = true) {

											// Remove the "pointed" class from each record
											$("#file .record").removeClass("pointed");

											if (run_number == 1 && page_number == 1) {
												// Snap grayed records in their position (to avoid visual errors)
												let pos_x = $("#runs-container .block").offset().left;
												snap_all_record_grayed_copies_to_horizontal_position(pos_x, "#runs-container");
												// Also snap normal file records in their position (to avoid visual errors)
												snap_all_records_to_horizontal_position(pos_x, actual_num_of_pages_of_file);

												// Store a copy of the html content of the runs container copies container (to be used later, in the rollback function of the last iteration in last phase of this pass)
												records_runs_grayed_copies_container_html_content_for_this_pass = $("#runs-container #copies-container").html();

											}
											if (page_number == 1) {
												// Set page of new runs
												set_single_run(run_number, pages_of_each_run_at_end[run_number - 1].length, true);
											}

											if (animate) {
												scroll_to_focused_element(get_file_page(page_number, frame_number, false), STEP_DURATION * 0.8);
											}
											// Move the next page to the frame (with a delay to allow to scroll until the page before loading it)
											move_page_to_frame(page_number, frame_number, normal_delay(), (animate ? undefined : 0));
										},
										phase_info: {
											code_line_offset: highlight_lines_offset,
											code_line: [9, 10],
											pass_number: pass_number_to_set,
											io_operations: 1,
											description: function () {
												if (pages_of_each_run_at_start.length < num_of_available_frames) {
													// There are less runs remaining than the available frames in the buffer
													return "Loading the first " + ((pages_of_each_run_at_start[run_number - 1].length == 1) ? "(and only)" : "") + " page of the <b>" + pages_of_each_run_at_start.length + "</b> runs <b>R" + runs_numbers.join("</b>, <b>R") + "</b> (created at <b>pass i-1=" + (pass_i - 1) + "</b>) to <b>" + pages_of_each_run_at_start.length + "</b> frames of the buffer.";
												} else {
													// There are more runs than available frames in the buffer
													return "Loading the first " + ((pages_of_each_run_at_start[run_number - 1].length == 1) ? "(and only)" : "") + " page of the <b>M-1=" + num_of_available_frames + "</b> runs <b>R" + runs_numbers.join("</b>, <b>R") + "</b> (created at <b>pass i-1=" + (pass_i - 1) + "</b>) to <b>M-1=" + num_of_available_frames + "</b> frames of the buffer.";
												}
											}
										},
										rollback: function (animate = false) {

											// Remove the "pointed" class from each record
											$("#file .record").removeClass("pointed");

											// Undo next phase (undo move of next page of group to next frame)
											if (frame_number < num_of_available_frames) {


												// Undo move of next page of group
												let next_page_number = get_page_number_from_run_number_and_run_page_number(run_number + 1, 1); // Page number in the file
												move_page_to_run(next_page_number, run_number + 1, 1, 0, (animate ? undefined : 0));

											} else {


												// This is the (first) page ot the last run of the group, undo next actual phase
												// 	i.e. undo add class "pointed" to 1st records of each page
												runs_numbers.forEach((run_number) => {
													let page_number = get_page_number_from_run_number_and_run_page_number(run_number, 1); // Page number in the file
													get_record(page_number, 1).removeClass("pointed");
												});
											}

											// Redo previous phase (move first run of first group of runs to the first frame, i.e. R1-P1 to F1)
											if (run_number == 1 && page_number == 1) {
												// Snap normal file records & grayed records in their position (to avoid visual errors)
												let pos_x = $("#runs-container .block").offset().left;
												snap_all_record_grayed_copies_to_horizontal_position(pos_x, "#runs-container");
											}
											if (page_number == 1) {
												// Set page of new runs
												set_single_run(run_number, pages_of_each_run_at_end[run_number - 1].length, true);
											}
											// Move the next page to the frame (with a delay to allow to scroll until the page before loading it)
											move_page_to_frame(page_number, frame_number, 0, (animate ? undefined : 0));

										},
										duration: function () {
											return normal_delay() * 2 + pause_in_between_animation_phases
										},
									});
								}
							});

							// Set the "actual_pointed_records" list (first records of each page)
							runs_numbers.forEach((run_number, index) => {
								let page_number = get_page_number_from_run_number_and_run_page_number(run_number, 1); // Page number in the file
								let total_record_number_in_file = (page_number - 1) * num_of_records_per_page + 1;	// NOTE: list of all records may contain fake records for page padding, hence this is not the real total record number in file, is the total record slot
								let value = -1;
								if (total_record_number_in_file - 1 < all_records.length) value = all_records[total_record_number_in_file - 1].value;
								if (value == -1) value = Number.MAX_SAFE_INTEGER;	// Set it like this to avoid problems with the min function
								actual_pointed_records[index] = {
									record_page_number: page_number,
									record_number: 1,
									frame_number: index + 1,
									value: value,
								}
							});

							let actual_pointed_records_for_this_runs_group = actual_pointed_records.slice();
							let actual_pointed_records_for_this_runs_group_copy = [];
							actual_pointed_records.forEach((record) => {
								actual_pointed_records_for_this_runs_group_copy.push({ ...record });
							});


							// Highlight first record of each page as pointed record ===============================================================================
							animation.push({
								play: function (animate = true) {
									runs_numbers.forEach((run_number, index) => {
										if (LOG_DEBUG) console.log("\t Pass " + pass_i + ") Moved first page of runs [" + runs_numbers.join(", ") + "] in frame for this group");

										// Hightlight pointed records
										let page_number = get_page_number_from_run_number_and_run_page_number(run_number, 1); // Page number in the file
										get_record(page_number, 1).addClass("pointed");

									});
								},
								phase_info: {
									code_line_offset: highlight_lines_offset,
									code_line: [11],
									pass_number: pass_number_to_set,
									io_operations: 0,
									description: function () {
										return "Set each frame's pointer to point to its first record.";
									}
								},
								rollback: function (animate = false) {
									runs_numbers.forEach((run_number, index) => {
										// Hightlight pointed records

										let page_number = get_page_number_from_run_number_and_run_page_number(run_number, 1); // Page number in the file
										get_record(page_number, 1).addClass("pointed");

										// Undo next phase: undo move of min record among pointed records (hence first records) of certain frame to output frame, and add class "pointed" back
										let actual_first_min_record_object = {
											...actual_pointed_records_for_this_runs_group_copy.reduce((previous, current) => {
												return current.value < previous.value ? current : previous;
											})
										};
										move_record_to_new_slot_in_another_frame(actual_first_min_record_object.record_page_number, actual_first_min_record_object.record_number,
											actual_first_min_record_object.frame_number, 1, 0, (animate ? undefined : 0));
										get_record(actual_first_min_record_object.record_page_number, actual_first_min_record_object.record_number).addClass("pointed");

									});
								},
								duration: function () {
									return in_buffer_normal_delay() + pause_in_between_animation_phases
								},
							});
							// Move various records (min records) to the output frame ------------------------------------------------------------------------------------
							let total_records_in_this_runs_group = 0;
							runs_numbers.forEach(run_number => {
								for (let run_page_number = 1; run_page_number <= pages_of_each_run_at_start[run_number - 1].length; run_page_number++) {
									total_records_in_this_runs_group += pages_of_each_run_at_start[run_number - 1][run_page_number - 1];
								}
							});

							for (let i = 0; i < total_records_in_this_runs_group; i++) {

								// NOTE: i is an index representing all records currently in the group of "num_of_available_frames" runs (i.e. M-1 runs) we are considering (from 0 to the max number of records in the group)

								// This should be calculated by taking into account various factors, like the number of runs, the number of pages of each run, ecc...
								// Total record number in pages of file
								let actual_total_record_number = 0;
								for (let run_number = 1; run_number <= pages_of_each_run_at_start.length; run_number++) {
									if (run_number >= runs_numbers[0]) break;
									for (let run_page_number = 1; run_page_number <= pages_of_each_run_at_start[run_number - 1].length; run_page_number++) {
										actual_total_record_number += pages_of_each_run_at_start[run_number - 1][run_page_number - 1];
									}
								}
								actual_total_record_number += i + 1;

								let actual_total_record_page_in_file = 0;
								let sum_of_records = 0;
								for (let run_number = 1; run_number <= pages_of_each_run_at_start.length; run_number++) {
									for (let run_page_number = 1; run_page_number <= pages_of_each_run_at_start[run_number - 1].length; run_page_number++) {
										sum_of_records += pages_of_each_run_at_start[run_number - 1][run_page_number - 1];
										if (sum_of_records >= actual_total_record_number) {
											actual_total_record_page_in_file = get_page_number_from_run_number_and_run_page_number(run_number, run_page_number);
											break;
										}
									}
									if (sum_of_records >= actual_total_record_number) break;
								}
								let actual_total_record_page_in_file_for_end = 0;
								let sum_of_records_for_end = 0;
								for (let run_number = 1; run_number <= pages_of_each_run_at_end.length; run_number++) {
									for (let run_page_number = 1; run_page_number <= pages_of_each_run_at_end[run_number - 1].length; run_page_number++) {
										sum_of_records_for_end += pages_of_each_run_at_end[run_number - 1][run_page_number - 1];
										if (sum_of_records_for_end >= actual_total_record_number) {
											actual_total_record_page_in_file_for_end = get_page_number_from_run_number_and_run_page_number(run_number, run_page_number, true);
											break;
										}
									}
									if (sum_of_records_for_end >= actual_total_record_number) break;
								}

								if (actual_total_record_number <= num_of_records_of_file) {

									// Last record of last run not yet reached

									actual_num_of_records_in_output_frame += 1;

									// Find record with min value among pointed records in "actual_pointed_records" list
									let sorted_actual_pointed_records_list = actual_pointed_records_for_this_runs_group.slice();
									sorted_actual_pointed_records_list.sort((a, b) => (a.value > b.value) ? 1 : -1);
									let min_record_object = { ...sorted_actual_pointed_records_list[0] };
									let next_pointed_record_object = null;

									// Update the actual pointed records list to point to the next record of its page
									let min_value_index = min_record_object.frame_number - 1;

									let pointed_record_was_last_of_its_frame = min_record_object.record_number >= num_of_records_per_page;

									let min_record_run_number = get_run_number_and_run_page_number_from_page_number(min_record_object.record_page_number)[0];
									let min_record_run_page_number = get_run_number_and_run_page_number_from_page_number(min_record_object.record_page_number)[1];
									let should_load_next_page_of_run_containing_pointed_min_record = true &&
										pointed_record_was_last_of_its_frame &&
										min_record_run_page_number < pages_of_each_run_at_start[min_record_run_number - 1].length &&	// min record's run page number is less than the number of pages of the run (hence there still is a run page to consider)
										min_record_object.record_page_number + 1 <= actual_num_of_pages_of_file;

									if (!pointed_record_was_last_of_its_frame) {
										// There is another record to point after this one in its corresponding slot

										let total_record_number_in_file = (min_record_object.record_page_number - 1) * num_of_records_per_page + min_record_object.record_number + 1;

										let new_value = -1;
										if (total_record_number_in_file - 1 < all_records.length) new_value = all_records[total_record_number_in_file - 1].value;
										if (new_value == -1) new_value = Number.MAX_SAFE_INTEGER;	// Set it like this to avoid problems with the min function

										actual_pointed_records[min_value_index].record_number += 1;
										actual_pointed_records[min_value_index].value = new_value;

										next_pointed_record_object = {
											record_page_number: min_record_object.record_page_number,
											record_number: min_record_object.record_number + 1,
											frame_number: min_record_object.frame_number,
											value: new_value
										};

									} else {
										// The pointed min record was the last of its page / frame (if we can, load the next page, otherwise set its value to MAX_SAFE_INTEGER)

										if (should_load_next_page_of_run_containing_pointed_min_record) {
											// "Load" next page of run containing pointed min record and set the pointed record of the corresponding frame to the first of this page

											let new_page_number = min_record_object.record_page_number + 1;

											let total_record_number_in_file = (new_page_number - 1) * num_of_records_per_page + 1;

											let new_value = -1;
											if (total_record_number_in_file - 1 < all_records.length) new_value = all_records[total_record_number_in_file - 1].value;
											if (new_value == -1) new_value = Number.MAX_SAFE_INTEGER;	// Set it like this to avoid problems with the min function

											// // Update pointed record to be the next record of the newly loaded page (first record of the frame now)
											actual_pointed_records[min_value_index].record_page_number = new_page_number;
											actual_pointed_records[min_value_index].record_number = 1;
											actual_pointed_records[min_value_index].value = new_value;

											next_pointed_record_object = {
												record_page_number: new_page_number,
												record_number: 1,
												frame_number: min_record_object.frame_number,
												value: new_value
											};

										} else {
											// There is no next page to load for the run containing the pointed min record, hence set its value to MAX_SAFE_INTEGER (so that it will be ignored in the next min function)

											actual_pointed_records[min_value_index].record_number = num_of_records_per_page + 1;
											actual_pointed_records[min_value_index].value = Number.MAX_SAFE_INTEGER;
										}
									}

									let actual_pointed_records_for_next_iteration = [];
									actual_pointed_records.forEach((record) => {
										actual_pointed_records_for_next_iteration.push({ ...record });
									});

									let output_frame_slot_number = output_frame_records.length + 1;

									output_frame_records.push(min_record_object);

									let should_empty_output_frame = actual_num_of_records_in_output_frame == num_of_records_per_page;

									let actually_empty_output_frame = should_empty_output_frame ||	// Output frame is actually full
										actual_total_record_number == num_of_records_of_file ||			// Last record of very last run reached
										i + 1 == total_records_in_this_runs_group;						// Last record in this group of runs reached

									let output_frame_records_copy = output_frame_records.slice();

									function undo_current_min_record_operations_phases(animate = false, skip_first = false, skip_second = false, skip_third = false) {


										if (!skip_first && pointed_record_was_last_of_its_frame && should_load_next_page_of_run_containing_pointed_min_record) {
											// Undo move of next page of min record run to the min record frame (and remove "pointed" from the first record of that page)
											// move_page_to_frame(min_record_object.record_page_number + 1, min_record_object.frame_number, 0, (animate ? undefined : 0));
											let run_number = min_record_run_number;
											let page_of_run = min_record_run_page_number + 1;
											move_page_to_run(min_record_object.record_page_number + 1, run_number, page_of_run, 0, (animate ? undefined : 0));

											let actual_next_pointed_record = get_record(next_pointed_record_object.record_page_number, next_pointed_record_object.record_number);
											$(actual_next_pointed_record).removeClass("pointed");

										} else if (!skip_first && !pointed_record_was_last_of_its_frame) {

											// Remove "pointed" class from next record
											let actual_next_pointed_record = get_record(next_pointed_record_object.record_page_number, next_pointed_record_object.record_number);
											$(actual_next_pointed_record).removeClass("pointed");

										} else {

											if (!skip_third && actually_empty_output_frame) {
												// Updo emptying of output frame
												let new_run_number = get_run_number_and_run_page_number_from_page_number(actual_total_record_page_in_file_for_end, true)[0];
												let page_of_new_run = get_run_number_and_run_page_number_from_page_number(actual_total_record_page_in_file_for_end, true)[1];

												if (!skip_second && page_of_new_run == 1) {
													// Undo showing (and setting?) of new run
													hide_single_run(new_run_number, 0, (animate ? undefined : 0), true);
												} else {
													// Undo move of records of the output frame to the page
													for (let i = 0; i < output_frame_records_copy.length; i++) {
														// move all the records in the output frame back to the output frame
														let record_object = output_frame_records_copy[i];
														// move_record_to_run(record_object.record_page_number, record_object.record_number, new_run_number, page_of_new_run, 0, (animate ? undefined : 0), true, i + 1);
														move_record_to_new_slot_in_another_frame(record_object.record_page_number, record_object.record_number, num_of_frames_in_buffer, i + 1, 0, (animate ? undefined : 0));
													}
												}
											} else {
												// Undo start of "for" loop for the next record to consider
												//	hence undo move next min r in otuput buffer and also undo remove class "pointed" to next min record (thus add the class to actually undo)
												let record_number_in_this_runs_group = i + 1;
												if (record_number_in_this_runs_group < total_records_in_this_runs_group) {
													let min_record_object_for_next_iteration = {
														...actual_pointed_records_for_next_iteration.reduce((previous, current) => {
															return current.value < previous.value ? current : previous;
														})
													};
													let next_min_record_slot_number_in_frame = min_record_object_for_next_iteration.record_number;
													move_record_to_new_slot_in_another_frame(min_record_object_for_next_iteration.record_page_number, min_record_object_for_next_iteration.record_number,
														min_record_object_for_next_iteration.frame_number, next_min_record_slot_number_in_frame, 0, (animate ? undefined : 0));
													get_record(min_record_object_for_next_iteration.record_page_number, min_record_object_for_next_iteration.record_number).addClass("pointed");
												} else {
													// This is the last record of this iteration (for this runs group)
													if (actual_total_record_number < num_of_records_of_file) {
														// Undo next runs group start phase

														let next_iteration_first_run_number = runs_numbers[runs_numbers.length - 1] + 1;
														let next_iteration_first_run_page_number = 1;
														let next_iteration_first_file_page = get_page_number_from_run_number_and_run_page_number(next_iteration_first_run_number, next_iteration_first_run_page_number);
														if (get_run_page(next_iteration_first_run_number, next_iteration_first_run_page_number) == null) {
															set_single_run(next_iteration_first_run_number, next_iteration_first_run_page_number, 0, (animate ? undefined : 0), true);
														}
														move_page_to_run(next_iteration_first_file_page, next_iteration_first_run_number, next_iteration_first_run_page_number, 0, (animate ? undefined : 0));
													} else {
														// This was the last group of runs (pass is over), undo next phase (last phase of this pass)

														for (let i = 0; i < pages_of_each_run_at_end.length; i++) {
															// Recreate pages of each run as they were at the start of the pass
															// "pages_of_each_run_at_start" may for example have the structure:  [[5,5,2], [5,2], [3], [5,3]]  (i.e. 4 runs)
															let this_run_number = i + 1;
															let num_of_pages_of_this_run = pages_of_each_run_at_end[i].length;
															set_single_run(this_run_number, num_of_pages_of_this_run, true);
															show_single_run(this_run_number, 0, (animate ? undefined : 0), true);
														}

														for (let i = 0; i < pages_of_each_run_at_start.length; i++) {
															// Recreate pages of each run as they were at the start of the pass
															// "pages_of_each_run_at_start" may for example have the structure:  [[5,5,2], [5,2], [3], [5,3]]  (i.e. 4 runs)
															let this_run_number = i + 1;
															let num_of_pages_of_this_run = pages_of_each_run_at_start[i].length;
															set_single_run(this_run_number, num_of_pages_of_this_run);
															show_single_run(this_run_number, 0, (animate ? undefined : 0));
														}

														// Runs container content should be restored from the records grayed copies container stored html content
														let grayed_copies_container = $("#runs-container #copies-container");
														if (grayed_copies_container.length == 0) {
															$("#runs-container").append("<div id='copies-container'></div>");
															grayed_copies_container = $("#runs-container #copies-container");
														}
														grayed_copies_container.html(records_runs_grayed_copies_container_html_content_for_this_pass);
														show_runs(0, false);
														show_runs(0, true);

														let list_of_runs_tops = [];
														let runs = $("#runs-container-next .block");
														for (let i = 0; i < actual_num_of_pages_of_file; i++) {
															let page_number = i + 1;
															let page = get_file_page(page_number);
															if (page != null) {
																list_of_runs_tops.push($(runs[i]).offset().top - page.offset().top);
															} else {
															}
														}

														reparent_all_records_based_on_given_list(all_records_list_at_start_of_this_pass, list_of_runs_tops, runs_created_at_end_of_this_pass);

														// Should then reorder records based on the order of the "all_records_list_at_end_of_this_pass" list

														for (let i = 0; i < all_records_list_at_end_of_this_pass.length; i++) {
															let record_object = all_records_list_at_end_of_this_pass[i];

															if (record_object.value == -1) continue;

															let corresponding_record_object_of_end_record_object = { ...all_records_list_at_start_of_this_pass.find((record) => record.value == record_object.value) };

															let corresponding_run_number = get_run_number_and_run_page_number_from_page_number(record_object.page_in_file, true)[0];
															let corresponding_run_page_number = get_run_number_and_run_page_number_from_page_number(record_object.page_in_file, true)[1];
															let slot_position = i % num_of_records_per_page + 1;
															move_record_to_run(
																corresponding_record_object_of_end_record_object.page_in_file,
																corresponding_record_object_of_end_record_object.number_in_page_of_file,
																corresponding_run_number,
																corresponding_run_page_number,
																0, 0, true, slot_position
															);

														}

														// Snaps record to the runs container next position
														let pos_x = $("#runs-container-next .block").offset().left;
														snap_all_records_to_horizontal_position(pos_x, actual_num_of_pages_of_file);

													}
												}
											}
										}
									}

									// Find record with minimum value among pointed and move it to the output frame (last buffer) ========================================
									animation.push({
										play: function (animate = true) {

											let actual_min_record = get_record(min_record_object.record_page_number, min_record_object.record_number);
											$(actual_min_record).removeClass("pointed");

											scroll_to_focused_element(get_frame(1));

											if (LOG_DEBUG) console.log("> Actual total record number: " + actual_total_record_number + " (page " + actual_total_record_page_in_file + ") | Min record: " + min_record_object.value + " (page " + min_record_object.record_page_number + ")");

											move_record_to_new_slot_in_another_frame(min_record_object.record_page_number, min_record_object.record_number, -1, output_frame_slot_number, 0, (animate ? in_buffer_normal_delay() : 0));
										},
										phase_info: {
											code_line_offset: highlight_lines_offset,
											code_line: [13, 14],
											pass_number: pass_number_to_set,
											io_operations: 0,
											description: function () {

												let actual_min_record = get_record(min_record_object.record_page_number, min_record_object.record_number);

												let append_string = "";
												if (pointed_record_was_last_of_its_frame && !should_load_next_page_of_run_containing_pointed_min_record) append_string = " (<b>r</b> was the last record of its frame, but its associated run <b>R" + min_record_run_number + "</b> has no more pages to load)";

												return "Record with min value among pointed records is " + get_record_description_string(actual_min_record) + " (in frame <b>F" + min_record_object.frame_number + "</b>): moving it to the output frame" + append_string + ".";

											}
										},
										rollback: function (animate = false) {

											// Undo next phase:
											undo_current_min_record_operations_phases(animate);

											// Redo this phase's "play" function
											let actual_min_record = get_record(min_record_object.record_page_number, min_record_object.record_number);
											$(actual_min_record).removeClass("pointed");
											move_record_to_new_slot_in_another_frame(min_record_object.record_page_number, min_record_object.record_number, -1, output_frame_slot_number, 0, (animate ? in_buffer_normal_delay() : 0));

										},
										duration: function () {
											return in_buffer_normal_delay() + pause_in_between_animation_phases
										},
									});


									// The min record was the last of its page (if we can, load the next page, else poinit to next record of frame) ------------------------------------------------------------------
									if (pointed_record_was_last_of_its_frame) {

										if (should_load_next_page_of_run_containing_pointed_min_record) {
											let run_number = min_record_run_number;
											let page_of_run = min_record_run_page_number + 1;

											// Load next page of the min record's corresponding run and highlight its first record
											animation.push({
												play: function (animate = true) {

													if (LOG_DEBUG) console.log("Trying to load new page (" + (min_record_object.record_page_number + 1) + ") in frame " + min_record_object.frame_number + " (run " + min_record_object.frame_number + ") after reaching last record of this frame");

													// Scroll to page's current position of element, then move page in frame

													if (animate) {
														scroll_to_focused_element(get_run_page(run_number, page_of_run, false), STEP_DURATION * 0.8);
													}

													// Move the next run page to the frame (with a delay to allow to scroll until the page before loading it)
													move_page_to_frame(min_record_object.record_page_number + 1, min_record_object.frame_number, normal_delay(), (animate ? undefined : 0));

													// Hightlight pointed record
													let actual_next_pointed_record = get_record(next_pointed_record_object.record_page_number, next_pointed_record_object.record_number);
													$(actual_next_pointed_record).addClass("pointed");

												},
												phase_info: {
													code_line_offset: highlight_lines_offset,
													code_line: [17, 18, 19],
													pass_number: pass_number_to_set,
													io_operations: 1,
													description: function () {
														let actual_min_record = get_record(min_record_object.record_page_number, min_record_object.record_number);
														return "Minimum record " + get_record_description_string(actual_min_record) + " was the last record of its frame <b>F" + min_record_object.frame_number + "</b> and its associated run <b>R" + run_number + "</b> has more pages: loading the next page <b>P" + page_of_run + "</b> of run <b>R" + run_number + "</b> in frame <b>F" + min_record_object.frame_number + "</b> of the buffer (and pointing to its first record).";
													}
												},
												rollback: function (animate = false) {

													// Undo next phase
													undo_current_min_record_operations_phases(animate, true);

													// Redo this phase's "play" function
													// Move the next run page to the frame (with a delay to allow to scroll until the page before loading it)
													move_page_to_frame(min_record_object.record_page_number + 1, min_record_object.frame_number, 0, (animate ? undefined : 0));
													// Hightlight pointed record
													let actual_next_pointed_record = get_record(next_pointed_record_object.record_page_number, next_pointed_record_object.record_number);
													$(actual_next_pointed_record).addClass("pointed");

												},
												duration: function () {
													return normal_delay() * 2 + pause_in_between_animation_phases
												},
											});
										}

									} else {

										// Point to the next record (record was NOT the last of its frame)
										animation.push({
											play: function (animate = true) {

												let actual_next_pointed_record = get_record(next_pointed_record_object.record_page_number, next_pointed_record_object.record_number);
												if (actual_next_pointed_record != null) $(actual_next_pointed_record).addClass("pointed");
											},
											phase_info: {
												code_line_offset: highlight_lines_offset,
												code_line: [15, 16],
												pass_number: pass_number_to_set,
												io_operations: 0,
												description: function () {
													// There is actually another record to point to 
													let actual_min_record = get_record(min_record_object.record_page_number, min_record_object.record_number);
													let actual_next_pointed_record = get_record(next_pointed_record_object.record_page_number, next_pointed_record_object.record_number);
													if (actual_next_pointed_record != null) {
														return "Minimum record " + get_record_description_string(actual_min_record) + " was <b>NOT</b> the last record of its frame <b>F" + min_record_object.frame_number + "</b> pointing to next record " + get_record_description_string(actual_next_pointed_record) + ".";
													} else {
														// Record was not last of its frame, but it was indeed the last record of its page
														return "Minimum record " + get_record_description_string(actual_min_record) + " was <b>NOT</b> the last record of its frame <b>F" + min_record_object.frame_number + "</b> but there are no more records to consider for its associated run <b>R" + min_record_run_number + "</b>.";
													}
												}
											},
											rollback: function (animate = false) {

												// Undo next phase
												undo_current_min_record_operations_phases(animate, true);

												// Redo this phase's "play" function
												let actual_next_pointed_record = get_record(next_pointed_record_object.record_page_number, next_pointed_record_object.record_number);
												if (actual_next_pointed_record != null) $(actual_next_pointed_record).addClass("pointed");

											},
											duration: function () {
												return in_buffer_normal_delay() + pause_in_between_animation_phases
											},
										});

									}

									if (actually_empty_output_frame) {
										// Empty output frame (write to secondary storage) ======================================================================================

										let new_run_number = get_run_number_and_run_page_number_from_page_number(actual_total_record_page_in_file_for_end, true)[0];
										let page_of_new_run = get_run_number_and_run_page_number_from_page_number(actual_total_record_page_in_file_for_end, true)[1];

										// Show new run ------------------------------------------------------------------------------------
										if (page_of_new_run == 1) {
											animation.push({
												play: function (animate = true) {
													// move all the records currenly in the output frame to the new run
													set_single_run(new_run_number, pages_of_each_run_at_end[new_run_number - 1].length, true);
													show_single_run(new_run_number, 0, (animate ? undefined : 0), true);

												},
												phase_info: {
													code_line_offset: highlight_lines_offset,
													code_line: [20, 21],
													pass_number: pass_number_to_set,
													io_operations: 0,
													description: function () {
														return "Output frame is full: creating a new run <b>R" + new_run_number + "</b> (with <b>" + pages_of_each_run_at_end[new_run_number - 1].length + "</b> pages) in secondary storage to store the current records in the output frame.";
													}
												},
												rollback: function (animate = false) {

													// Undo next phase: undo move of records of the output frame to the page
													undo_current_min_record_operations_phases(animate, true, true);

													// Redo this phase's "play" function
													set_single_run(new_run_number, pages_of_each_run_at_end[new_run_number - 1].length, true);
													show_single_run(new_run_number, 0, (animate ? undefined : 0), true);

												},
												duration: function () {
													return normal_delay() + pause_in_between_animation_phases
												},
											});
										}

										actual_num_of_records_in_output_frame = 0;

										// Add records that are currently in output frame (plus padding if needed) to the final written records list (before emptying the output records list)
										let final_written_records_last_written_page = 0;
										if (final_written_records.length > 0) final_written_records_last_written_page = final_written_records[final_written_records.length - 1].page_in_file;
										for (let i = 0; i < num_of_records_per_page; i++) {
											let record_page_in_file = final_written_records_last_written_page + 1;
											let rec_obj = {
												value: -1,
												page_in_file: record_page_in_file,
												number_in_page_of_file: i + 1
											}
											if (i < output_frame_records_copy.length) {
												rec_obj.value = output_frame_records_copy[i].value;
											}
											final_written_records.push(rec_obj);
										}

										output_frame_records = [];

										// Empty output frame (write it in current run) -----------------------------------------------------------------------------------------------
										animation.push({
											play: function (animate = true) {
												// Scroll to the run

												scroll_to_focused_element(get_run_page(new_run_number, page_of_new_run, true), (animate ? undefined : 0));

												for (let i = 0; i < output_frame_records_copy.length; i++) {
													// move all the records in the output frame to the new run
													let record_object = output_frame_records_copy[i];
													move_record_to_run(record_object.record_page_number, record_object.record_number, new_run_number, page_of_new_run, 0, (animate ? undefined : 0), true, i + 1);
												}
											},
											phase_info: {
												code_line_offset: highlight_lines_offset,
												code_line: [20, 21],
												pass_number: pass_number_to_set,
												io_operations: 1,
												description: function () {
													return "Output frame is full: writing its records in run <b>R" + new_run_number + "</b> (in secondary storage).";
												}
											},
											rollback: function (animate = false) {
												// Undo next phase: Undo start of "for" loop for the next record to consider
												undo_current_min_record_operations_phases(animate, true, true, true);

												// Redo this phase's "play" function
												for (let i = 0; i < output_frame_records_copy.length; i++) {
													// move all the records in the output frame to the new run
													let record_object = output_frame_records_copy[i];
													move_record_to_run(record_object.record_page_number, record_object.record_number, new_run_number, page_of_new_run, 0, (animate ? undefined : 0), true, i + 1);
												}

											},
											duration: function () {
												return normal_delay() + pause_in_between_animation_phases
											},
										});
										new_run_page_number += 1;
									}
								}
							}
							// Group of runs is over
						}
						// PASS IS OVER: Should be resetting runs (i.e. hiding old runs, swapping old with new runs, then starting the new pass)

						created_runs_records = [];
						for (let run_number = 1; run_number <= pages_of_each_run_at_end.length; run_number++) {
							let total_records_of_this_run = 0;
							for (let page_number = 1; page_number <= pages_of_each_run_at_end[run_number - 1].length; page_number++) {
								total_records_of_this_run += pages_of_each_run_at_end[run_number - 1][page_number - 1];
							}
							created_runs_records.push(total_records_of_this_run);
						}

						let runs_created_at_end_of_this_pass = created_runs_records.slice();
						let num_of_runs_created_at_end_of_this_pass = runs_created_at_end_of_this_pass.length;

						let actual_num_of_pages_of_file_for_end = pages_of_each_run_at_end.flat().length;

						// Hide old runs
						animation.push({
							play: function (animate = true) {

								// Remove the "pointed" class from each record
								$("#file .record").removeClass("pointed");

								delete_records_grayed_copies("#runs-container");

								// Hide runs
								hide_runs((animate ? STEP_DURATION * 0.90 : 0));

								scroll_to_focused_element(get_frame(1), (animate ? STEP_DURATION * 0.90 : 0));

								// Move records to the right (to manually follow the runs container)
								for (i = 0; i < actual_num_of_pages_of_file_for_end; i++) {
									let page_number = i + 1;
									for (j = 0; j < num_of_records_per_page; j++) {
										let record_number = j + 1;
										if (get_record(page_number, record_number) != null) {
											// NOTE: should add up to: 111
											let adjustment_factor = 260.5;
											move_record_by_pixels(page_number, record_number, ($("#secondary-storage-container .content").width() / 521.625) * adjustment_factor + (111 - adjustment_factor), 0, 0, (animate ? STEP_DURATION * 0.90 : 0));
										}
									}
								}

								// Reparent records, swap old with new runs, ecc...
								setTimeout(() => {

									// Reparent records
									let list_of_runs_tops = [];
									let runs = $("#runs-container-next .block");
									for (let i = 0; i < actual_num_of_pages_of_file_for_end; i++) {
										let page_number = i + 1;
										let page = get_file_page(page_number);
										list_of_runs_tops.push($(runs[i]).offset().top - page.offset().top);
									}
									reparent_all_records_based_on_top_position(list_of_runs_tops, runs_created_at_end_of_this_pass);

									// Swap old with new runs
									$("#runs-container").html($("#runs-container-next").html());
									$("#runs-container-next").html("");

									hide_runs(0, true);
									show_runs(0, false);

									setTimeout(() => {
										// Snaps record to the runs container position
										for (i = 0; i < actual_num_of_pages_of_file_for_end; i++) {
											let page_number = i + 1;
											for (j = 0; j < num_of_records_per_page; j++) {
												let record_number = j + 1;
												if (get_record(page_number, record_number) != null) {
													let run_number = get_run_number_and_run_page_number_from_page_number(page_number, true)[0];
													let run_page_number = get_run_number_and_run_page_number_from_page_number(page_number, true)[1];
													let delta = $(get_run_page(run_number, run_page_number)).offset().left - $(get_record(page_number, record_number)).offset().left;
													move_record_by_pixels(page_number, record_number, delta, 0, 0, 0);
												}
											}
										}
									}, STEP_DURATION * 0.3);

								}, (animate ? STEP_DURATION * 0.90 : 0) + STEP_DURATION * 0.3);

							},
							phase_info: {
								code_line_offset: highlight_lines_offset,
								code_line: [22, 23],
								pass_number: pass_number_to_set,
								io_operations: 0,
								description: function () {
									let run_numbers_at_start_of_this_pass = [];
									for (let run_number = 1; run_number <= pages_of_each_run_at_start.length; run_number++) run_numbers_at_start_of_this_pass.push(run_number);
									let run_numbers_at_end_of_this_pass = [];
									for (let run_number = 1; run_number <= pages_of_each_run_at_end.length; run_number++) run_numbers_at_end_of_this_pass.push(run_number);
									let num_of_pages_of_last_run_at_end = (actual_num_of_pages_of_file_for_end - 1) % pages_of_each_run_at_end[0].length + 1;
									let str_1 = "All records of runs <b>R" + run_numbers_at_start_of_this_pass.join("</b>, <b>R") + "</b> of previous pass <b>i-1=" + (pass_i - 1) + "</b> were analyzed. " +
										"Pass <b>i=" + pass_i + "</b> is over: created run" + (run_numbers_at_end_of_this_pass.length == 1 ? "" : "s") + " <b>R" + run_numbers_at_end_of_this_pass.join("</b>, <b>R") + "</b>";
									let str_2 = " of <b>" + pages_of_each_run_at_end[0].length + "</b> page" + (pages_of_each_run_at_end[0].length == 1 ? "" : "s") + " each" +
										((num_of_pages_of_last_run_at_end != pages_of_each_run_at_end[0].length) ? (" (last run <b>R" + pages_of_each_run_at_end.length + "</b> only has <b>" +
											num_of_pages_of_last_run_at_end + "</b> page" + (num_of_pages_of_last_run_at_end == 1 ? "" : "s") + ")") : "");
									if (selected_algorithm_type == algorithm_type.two_way || selected_algorithm_type == algorithm_type.k_way) {
										return str_1 + str_2 + ".";
									} else {
										return str_1 + ".";
									}
								}
							},
							rollback: function (animate = false) {

								// Remove the "pointed" class from each record
								$("#file .record").removeClass("pointed");

								// Undo next phase (start of next pass or even end of algorithm)
								// NOTE: some of the "undoing" was actually made also in the "redo play" lines of code of this rollback function, unsoing and play of original function is mixed)
								if (pass_i <= (max_num_of_needed_passes - 1) && num_of_runs_created_at_end_of_this_pass != 1) {
									// Undo start of next pass
									// Do nothing... (?)
								} else {
									// This is the last pass, undo end of algorithm
									// ...
									$("#runs-container").removeClass("transform-to-file");

									// Reparent all records to the #runs-container
									reparent_all_runs_pages_to_file();

									// NOTE: not sure if these css styles "unsetting" work...
									$("#file").css("overflow", "");

									$("#file").css("width", "");
									$("#file").css("padding-left", "");
									$("#file").css("padding-right", "");

									stop_fireworks();
								}

								// NOTE: This should actually NOT be needed (since records grayed copies are already deleted as we are going back from
								//		a state after this actual state, which deleted the grayed copies in the "play()" function)
								delete_records_grayed_copies("#runs-container");

								// Reset all runs to the actual original number of pages and runs for each run at start
								for (let i = 0; i < pages_of_each_run_at_start.length; i++) {
									// Recreate pages of each run as they were at the start of the pass
									let this_run_number = i + 1;
									let num_of_pages_of_this_run = pages_of_each_run_at_start[i].length;
									set_single_run(this_run_number, num_of_pages_of_this_run);
									show_single_run(this_run_number, 0, (animate ? undefined : 0));
								}

								// Reset new runs container to the actual original number of pages and runs for each run at start
								for (let i = 0; i < pages_of_each_run_at_end.length; i++) {
									// Recreate pages of each run as they were at the start of the pass
									let this_run_number = i + 1;
									let num_of_pages_of_this_run = pages_of_each_run_at_end[i].length;
									set_single_run(this_run_number, num_of_pages_of_this_run, true);
									show_single_run(this_run_number, 0, (animate ? undefined : 0), true);
								}

								// Swap old with new runs
								show_runs(0, true);

								let grayed_copies_container = $("#runs-container #copies-container");
								if (grayed_copies_container.length == 0) {
									$("#runs-container").append("<div id='copies-container'></div>");
									grayed_copies_container = $("#runs-container #copies-container");
								}
								grayed_copies_container.html(records_runs_grayed_copies_container_html_content_for_this_pass);	// This includes grayed copies

								hide_runs(0, false);

								// Snaps record to the runs container position
								let pos_x = $("#runs-container-next .block").offset().left;
								snap_all_records_to_horizontal_position(pos_x, actual_num_of_pages_of_file);


							},
							duration: function () {
								return normal_delay() * 1.85 + pause_in_between_animation_phases
							},
						});

						// Update actual records list ("all_records" list)
						// i.e. copy the final_written_records list into the all_records list
						all_records = final_written_records.slice();
						if (LOG_DEBUG) console.log(" ALL RECORDS (after pass " + pass_i + " of replacement_selection) ");
						if (LOG_DEBUG) console.log(all_records);

						let all_records_list_at_end_of_this_pass = [];
						all_records.forEach(record => {
							all_records_list_at_end_of_this_pass.push({ ...record });
						});

						// Build the "sorting tree" pass i
						build_single_tree_pass(pass_i, all_records_list_at_end_of_this_pass, pages_of_each_run_at_end);

						// END OF THIS PASS (also hid "hold" runs, ecc...) -----------------------------------------------------------------------------------------------------------------------
					}
					// END OF ALL PASSES
				}
			}

			// Build pass i
			build_i_passes();

			let final_total_passes = pass_counter;

			let pass_number_to_set = -2;

			// [Phase (animation.length - 3)] Transform the actual runs container into the file container -------------------------------------------------------------------------
			animation.push({
				play: function (animate = true) {
					// Animates the border of the dashed rectangle to become invisible
					$("#runs-container").addClass("transform-to-file");
					// Reparent all records to the #runs-container
					reparent_all_file_pages_to_runs();
					$("#file").css("overflow", "hidden");
					setTimeout(() => {
						$("#file").animate({
							width: "0px",
							"padding-left": "0px",
							"padding-right": "0px"
						}, (animate ? STEP_DURATION : 0));
					}, 500);

					// Starts fireworks anyway
					let phase_at_start = current_phase;
					setTimeout(() => {
						// If we are stil in this phase (i.e. user was moving with arrows or step forward button and now stopped in this phase), start fireworks
						if (phase_at_start == current_phase) {
							start_fireworks();
						}
					}, 2750);
				},
				phase_info: {
					code_line_offset: highlight_lines_offset,
					code_line: [8],
					pass_number: pass_number_to_set,
					io_operations: 0,
					description: function () {
						return "No more runs to consider: algorithm is over after <b>" + (final_total_passes - 1) + "</b> passes<br/>(<b>excluding</b> pass 0).";
					}
				},
				rollback: function (animate = false) {
					// ...
				},
				duration: function () {
					return 3000 + pause_in_between_animation_phases
				},
			});
			// [Phase (animation.length - 2)] End of animation --------------------------------------------------------------------------------------------------------------------
			animation.push({
				play: function (animate = true) {
					scroll_to_focused_element($("#file"), (animate ? undefined : 0));
					// Set all records top position to 0
					$("#runs-container .record").css("top", "0px");
					if (LOG_DEBUG) console.log("End of animation");

					// Starts fireworks anyway
					let phase_at_start = current_phase;
					setTimeout(() => {
						// If we are stil in this phase (i.e. user was moving with arrows or step forward button and now stopped in this phase), start fireworks
						if (phase_at_start == current_phase) {
							start_fireworks();
						}
					}, normal_delay() * 1.25);

				},
				phase_info: {
					code_line_offset: highlight_lines_offset,
					code_line: [24],
					pass_number: pass_number_to_set,
					io_operations: 0,
					description: function () {
						set_rainbow_text = false;
						return "<span class=\"final-description-alternate\"><b>File is now sorted!</b></span>";
					}
				},
				rollback: function (animate = false) {
					scroll_to_focused_element($("#file"), (animate ? undefined : 0));
					if (LOG_DEBUG) console.log("End of animation");
					stop_fireworks();
				},
				duration: function () {
					return normal_delay() * 1.5 + pause_in_between_animation_phases
				},
			});
			// [Phase (animation.length - 1)] End of animation ----------------------------------------------------------------------------------------------------------------------
			animation.push({
				play: function (animate = true) {
					start_fireworks();
				},
				phase_info: {
					code_line_offset: highlight_lines_offset,
					code_line: [24],
					pass_number: pass_number_to_set,
					io_operations: 0,
					description: function () {
						return "<span class=\"final-description-alternate\"><b>File is now sorted!</b></span>";
					}
				},
				rollback: function (animate = false) { },
				duration: function () {
					return STEP_DURATION
				},
			});
		}
	</script>
	<!-- Fireworks -->
	<script id="fireworks-js">

		var canvas = document.querySelector('#canvas');
		var c = canvas.getContext('2d');
		c.clearRect(0, 0, canvas.width, canvas.height);

		let viewport_firework_spawn_width_percentage = 40;

		var colors = [
			{ red: 255, green: 0, blue: 0 },
			{ red: 0, green: 255, blue: 0 },
			{ red: 0, green: 0, blue: 255 },
			{ red: 255, green: 255, blue: 0 },
			{ red: 255, green: 0, blue: 255 },
			{ red: 0, green: 255, blue: 255 },
		];

		let fireworks = [];

		let firework_probability_percentage = 3;

		let loops_delay = 0;

		let interval;

		class Particle {
			constructor(x, y, firework, color) {
				this.x = x;
				this.y = y;
				this.gravity = 0.7 * (753 / window.innerHeight);
				this.lifeSpan = random(450, 0);
				this.firework = firework;
				this.radius = random(3, 2);
				this.color = color;
				if (this.firework) {
					this.vx = random(-3, 3);
					this.vy = random(-12, -20);
					this.gravity = 0.3 * (753 / window.innerHeight);
				} else {
					this.vx = random(3, -3); 	//firework radius on X axis
					this.vy = random(3, -3); 	// firework radius on Y axis
					this.vy = this.vy * random(6, 1);
					this.vx = this.vx * random(6, 1);
					this.gravity = 0.1 * (753 / window.innerHeight);
					if (random(600, 1) < 3) {
						this.vx *= random(2, 1);
						this.vy *= random(2, 1);
					}
				}
			}

			done() {
				if (this.lifeSpan < 0) {
					return true;
				} else {
					return false;
				}
			}

			draw() {
				if (!this.firework) {
					circle(this.x, this.y, this.radius, `rgba(${this.color.red},${this.color.green},${this.color.blue},${this.lifeSpan / 255})`);
				} else {
					let color = `rgba(${this.color.red},${this.color.green},${this.color.blue},255)`;
					circle(this.x, this.y, this.radius, color);
				}

			}

			update() {
				this.y += this.vy;
				this.x += this.vx;
				this.vy += this.gravity;
				if (this.firework) {
					this.x += random(2, -2);
					this.radius = random(4, 2);
				} else {
					this.vy *= .9;
					this.vx *= .9;
					this.lifeSpan -= 4;
					if (this.lifeSpan < 0) {
						this.done();
					}
				}
			}
		}

		class Firework {
			constructor() {
				this.color = { red: 255, green: 255, blue: 255 };
				this.rgb = this.color;
				this.firework = new Particle(random((canvas.width / 2) - (canvas.width * viewport_firework_spawn_width_percentage / 200), (canvas.width / 2) + (canvas.width * viewport_firework_spawn_width_percentage / 200)),
					canvas.height, true, { red: 255, green: 255, blue: 255 });
				this.exploded = false;
				this.particles = [];
			}
			done() {
				if (this.exploded && this.particles.length === 0) {
					return true;
				} else {
					return false;
				}
			}
			explode() {
				for (let i = 0; i < 500; i++) {
					this.particles.push(new Particle(this.firework.x, this.firework.y, false,
						(Math.random() > 0.20 ? colors[Math.floor(Math.random() * colors.length)] : { red: 255, green: 255, blue: 255 })
					));
				}
			}
			update() {
				if (!this.exploded) {
					this.firework.draw();
					this.firework.update();
					if (this.firework.vy > 0) {
						this.firework.vy = 0;
						this.exploded = true;
						this.explode();
					}
				}
				for (let i = this.particles.length - 1; i >= 0; i--) {
					this.particles[i].draw();
					this.particles[i].update();
					if (this.particles[i].done()) {
						this.particles.splice(i, 1);
					}
				}
			}
		}

		function loop() {

			c.fillStyle = "rgba(0,0,0,1)";
			c.clearRect(0, 0, canvas.width, canvas.height);

			loops_delay -= 1;

			if (loops_delay <= 0) {
				fireworks.push(new Firework());
				if (Math.random() < 0.25) loops_delay = Math.round(random(5, 15));
				else loops_delay = Math.round(random(30, 100));
			}

			for (let i = fireworks.length - 1; i >= 0; i--) {
				fireworks[i].update();
				if (fireworks[i].done()) {
				}
			}

			if (fireworks.length >= 10) {
				fireworks.splice(0, 1);
			}
		}

		window.addEventListener('resize', () => {
			init();
		});

		function random(max, min) {
			this.max = max;
			this.min = min;
			let x = Math.random() * (this.max - this.min) + this.min;
			return x;
		}

		function circle(x, y, radius, color) {
			this.radius = radius;
			this.x = x;
			this.y = y;
			this.color = color;

			c.fillStyle = this.color;

			c.beginPath();

			c.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
			c.fill();
		}

		function init() {
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;
			loops_delay = 0;
			// delete all fireworks
			fireworks = [];
		}

		var fireworks_are_playing = false;

		function start_fireworks() {
			if (!enable_fireworks) return;
			if (fireworks_are_playing) return;
			// delete all fireworks
			fireworks = [];
			init();
			fireworks_are_playing = true;
			interval = setInterval(loop, 16);
		}
		function stop_fireworks() {
			clearInterval(interval);
			fireworks_are_playing = false;
			// delete all fireworks
			fireworks = [];
			c.clearRect(0, 0, canvas.width, canvas.height);
		}

		$(document).ready(function () {
			init();
		});
	</script>
	
</body>
</html>